var er=Object.defineProperty;var tr=(i,t,e)=>t in i?er(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var u=(i,t,e)=>(tr(i,typeof t!="symbol"?t+"":t,e),e),xn=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)};var E=(i,t,e)=>(xn(i,t,"read from private field"),e?e.call(i):t.get(i)),G=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)},pe=(i,t,e,n)=>(xn(i,t,"write to private field"),n?n.call(i,e):t.set(i,e),e);var K=(i,t,e)=>(xn(i,t,"access private method"),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();var mn,U,is,Ue,oi,ss,Fn,yt={},Zn=[],nr=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Qn=Array.isArray;function je(i,t){for(var e in t)i[e]=t[e];return i}function rs(i){var t=i.parentNode;t&&t.removeChild(i)}function ir(i,t,e){var n,s,o,a={};for(o in t)o=="key"?n=t[o]:o=="ref"?s=t[o]:a[o]=t[o];if(arguments.length>2&&(a.children=arguments.length>3?mn.call(arguments,2):e),typeof i=="function"&&i.defaultProps!=null)for(o in i.defaultProps)a[o]===void 0&&(a[o]=i.defaultProps[o]);return $t(i,a,n,s,null)}function $t(i,t,e,n,s){var o={type:i,props:t,key:e,ref:n,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:s??++is,__i:-1,__u:0};return s==null&&U.vnode!=null&&U.vnode(o),o}function Pt(i){return i.children}function mt(i,t){this.props=i,this.context=t}function rt(i,t){if(t==null)return i.__?rt(i.__,i.__i+1):null;for(var e;t<i.__k.length;t++)if((e=i.__k[t])!=null&&e.__e!=null)return e.__e;return typeof i.type=="function"?rt(i):null}function sr(i,t,e){var n,s=i.__v,o=s.__e,a=i.__P;if(a)return(n=je({},s)).__v=s.__v+1,U.vnode&&U.vnode(n),Yn(a,n,s,i.__n,a.ownerSVGElement!==void 0,32&s.__u?[o]:null,t,o??rt(s),!!(32&s.__u),e),n.__.__k[n.__i]=n,n.__d=void 0,n.__e!=o&&os(n),n}function os(i){var t,e;if((i=i.__)!=null&&i.__c!=null){for(i.__e=i.__c.base=null,t=0;t<i.__k.length;t++)if((e=i.__k[t])!=null&&e.__e!=null){i.__e=i.__c.base=e.__e;break}return os(i)}}function ai(i){(!i.__d&&(i.__d=!0)&&Ue.push(i)&&!Jt.__r++||oi!==U.debounceRendering)&&((oi=U.debounceRendering)||ss)(Jt)}function Jt(){var i,t,e,n=[],s=[];for(Ue.sort(Fn);i=Ue.shift();)i.__d&&(e=Ue.length,t=sr(i,n,s)||t,e===0||Ue.length>e?(Cn(n,t,s),s.length=n.length=0,t=void 0,Ue.sort(Fn)):t&&U.__c&&U.__c(t,Zn));t&&Cn(n,t,s),Jt.__r=0}function as(i,t,e,n,s,o,a,c,_,d,p){var r,l,h,f,w,m=n&&n.__k||Zn,g=t.length;for(e.__d=_,rr(e,t,m),_=e.__d,r=0;r<g;r++)(h=e.__k[r])!=null&&typeof h!="boolean"&&typeof h!="function"&&(l=h.__i===-1?yt:m[h.__i]||yt,h.__i=r,Yn(i,h,l,s,o,a,c,_,d,p),f=h.__e,h.ref&&l.ref!=h.ref&&(l.ref&&Jn(l.ref,null,h),p.push(h.ref,h.__c||f,h)),w==null&&f!=null&&(w=f),65536&h.__u||l.__k===h.__k?_=ls(h,_,i):typeof h.type=="function"&&h.__d!==void 0?_=h.__d:f&&(_=f.nextSibling),h.__d=void 0,h.__u&=-196609);e.__d=_,e.__e=w}function rr(i,t,e){var n,s,o,a,c,_=t.length,d=e.length,p=d,r=0;for(i.__k=[],n=0;n<_;n++)(s=i.__k[n]=(s=t[n])==null||typeof s=="boolean"||typeof s=="function"?null:typeof s=="string"||typeof s=="number"||typeof s=="bigint"||s.constructor==String?$t(null,s,null,null,s):Qn(s)?$t(Pt,{children:s},null,null,null):s.constructor===void 0&&s.__b>0?$t(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):s)!=null?(s.__=i,s.__b=i.__b+1,c=or(s,e,a=n+r,p),s.__i=c,o=null,c!==-1&&(p--,(o=e[c])&&(o.__u|=131072)),o==null||o.__v===null?(c==-1&&r--,typeof s.type!="function"&&(s.__u|=65536)):c!==a&&(c===a+1?r++:c>a?p>_-a?r+=c-a:r--:r=c<a&&c==a-1?c-a:0,c!==n+r&&(s.__u|=65536))):(o=e[n])&&o.key==null&&o.__e&&(o.__e==i.__d&&(i.__d=rt(o)),En(o,o,!1),e[n]=null,p--);if(p)for(n=0;n<d;n++)(o=e[n])!=null&&!(131072&o.__u)&&(o.__e==i.__d&&(i.__d=rt(o)),En(o,o))}function ls(i,t,e){var n,s;if(typeof i.type=="function"){for(n=i.__k,s=0;n&&s<n.length;s++)n[s]&&(n[s].__=i,t=ls(n[s],t,e));return t}i.__e!=t&&(e.insertBefore(i.__e,t||null),t=i.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType===8);return t}function or(i,t,e,n){var s=i.key,o=i.type,a=e-1,c=e+1,_=t[e];if(_===null||_&&s==_.key&&o===_.type)return e;if(n>(_!=null&&!(131072&_.__u)?1:0))for(;a>=0||c<t.length;){if(a>=0){if((_=t[a])&&!(131072&_.__u)&&s==_.key&&o===_.type)return a;a--}if(c<t.length){if((_=t[c])&&!(131072&_.__u)&&s==_.key&&o===_.type)return c;c++}}return-1}function li(i,t,e){t[0]==="-"?i.setProperty(t,e??""):i[t]=e==null?"":typeof e!="number"||nr.test(t)?e:e+"px"}function Et(i,t,e,n,s){var o;e:if(t==="style")if(typeof e=="string")i.style.cssText=e;else{if(typeof n=="string"&&(i.style.cssText=n=""),n)for(t in n)e&&t in e||li(i.style,t,"");if(e)for(t in e)n&&e[t]===n[t]||li(i.style,t,e[t])}else if(t[0]==="o"&&t[1]==="n")o=t!==(t=t.replace(/(PointerCapture)$|Capture$/i,"$1")),t=t.toLowerCase()in i?t.toLowerCase().slice(2):t.slice(2),i.l||(i.l={}),i.l[t+o]=e,e?n?e.u=n.u:(e.u=Date.now(),i.addEventListener(t,o?_i:ci,o)):i.removeEventListener(t,o?_i:ci,o);else{if(s)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!=="width"&&t!=="height"&&t!=="href"&&t!=="list"&&t!=="form"&&t!=="tabIndex"&&t!=="download"&&t!=="rowSpan"&&t!=="colSpan"&&t!=="role"&&t in i)try{i[t]=e??"";break e}catch{}typeof e=="function"||(e==null||e===!1&&t[4]!=="-"?i.removeAttribute(t):i.setAttribute(t,e))}}function ci(i){if(this.l){var t=this.l[i.type+!1];if(i.t){if(i.t<=t.u)return}else i.t=Date.now();return t(U.event?U.event(i):i)}}function _i(i){if(this.l)return this.l[i.type+!0](U.event?U.event(i):i)}function Yn(i,t,e,n,s,o,a,c,_,d){var p,r,l,h,f,w,m,g,y,v,S,F,C,R,T,x=t.type;if(t.constructor!==void 0)return null;128&e.__u&&(_=!!(32&e.__u),o=[c=t.__e=e.__e]),(p=U.__b)&&p(t);e:if(typeof x=="function")try{if(g=t.props,y=(p=x.contextType)&&n[p.__c],v=p?y?y.props.value:p.__:n,e.__c?m=(r=t.__c=e.__c).__=r.__E:("prototype"in x&&x.prototype.render?t.__c=r=new x(g,v):(t.__c=r=new mt(g,v),r.constructor=x,r.render=lr),y&&y.sub(r),r.props=g,r.state||(r.state={}),r.context=v,r.__n=n,l=r.__d=!0,r.__h=[],r._sb=[]),r.__s==null&&(r.__s=r.state),x.getDerivedStateFromProps!=null&&(r.__s==r.state&&(r.__s=je({},r.__s)),je(r.__s,x.getDerivedStateFromProps(g,r.__s))),h=r.props,f=r.state,r.__v=t,l)x.getDerivedStateFromProps==null&&r.componentWillMount!=null&&r.componentWillMount(),r.componentDidMount!=null&&r.__h.push(r.componentDidMount);else{if(x.getDerivedStateFromProps==null&&g!==h&&r.componentWillReceiveProps!=null&&r.componentWillReceiveProps(g,v),!r.__e&&(r.shouldComponentUpdate!=null&&r.shouldComponentUpdate(g,r.__s,v)===!1||t.__v===e.__v)){for(t.__v!==e.__v&&(r.props=g,r.state=r.__s,r.__d=!1),t.__e=e.__e,t.__k=e.__k,t.__k.forEach(function(A){A&&(A.__=t)}),S=0;S<r._sb.length;S++)r.__h.push(r._sb[S]);r._sb=[],r.__h.length&&a.push(r);break e}r.componentWillUpdate!=null&&r.componentWillUpdate(g,r.__s,v),r.componentDidUpdate!=null&&r.__h.push(function(){r.componentDidUpdate(h,f,w)})}if(r.context=v,r.props=g,r.__P=i,r.__e=!1,F=U.__r,C=0,"prototype"in x&&x.prototype.render){for(r.state=r.__s,r.__d=!1,F&&F(t),p=r.render(r.props,r.state,r.context),R=0;R<r._sb.length;R++)r.__h.push(r._sb[R]);r._sb=[]}else do r.__d=!1,F&&F(t),p=r.render(r.props,r.state,r.context),r.state=r.__s;while(r.__d&&++C<25);r.state=r.__s,r.getChildContext!=null&&(n=je(je({},n),r.getChildContext())),l||r.getSnapshotBeforeUpdate==null||(w=r.getSnapshotBeforeUpdate(h,f)),as(i,Qn(T=p!=null&&p.type===Pt&&p.key==null?p.props.children:p)?T:[T],t,e,n,s,o,a,c,_,d),r.base=t.__e,t.__u&=-161,r.__h.length&&a.push(r),m&&(r.__E=r.__=null)}catch(A){t.__v=null,_||o!=null?(t.__e=c,t.__u|=_?160:32,o[o.indexOf(c)]=null):(t.__e=e.__e,t.__k=e.__k),U.__e(A,t,e)}else o==null&&t.__v===e.__v?(t.__k=e.__k,t.__e=e.__e):t.__e=ar(e.__e,t,e,n,s,o,a,_,d);(p=U.diffed)&&p(t)}function Cn(i,t,e){for(var n=0;n<e.length;n++)Jn(e[n],e[++n],e[++n]);U.__c&&U.__c(t,i),i.some(function(s){try{i=s.__h,s.__h=[],i.some(function(o){o.call(s)})}catch(o){U.__e(o,s.__v)}})}function ar(i,t,e,n,s,o,a,c,_){var d,p,r,l,h,f,w,m=e.props,g=t.props,y=t.type;if(y==="svg"&&(s=!0),o!=null){for(d=0;d<o.length;d++)if((h=o[d])&&"setAttribute"in h==!!y&&(y?h.localName===y:h.nodeType===3)){i=h,o[d]=null;break}}if(i==null){if(y===null)return document.createTextNode(g);i=s?document.createElementNS("http://www.w3.org/2000/svg",y):document.createElement(y,g.is&&g),o=null,c=!1}if(y===null)m===g||c&&i.data===g||(i.data=g);else{if(o=o&&mn.call(i.childNodes),m=e.props||yt,!c&&o!=null)for(m={},d=0;d<i.attributes.length;d++)m[(h=i.attributes[d]).name]=h.value;for(d in m)h=m[d],d=="children"||(d=="dangerouslySetInnerHTML"?r=h:d==="key"||d in g||Et(i,d,null,h,s));for(d in g)h=g[d],d=="children"?l=h:d=="dangerouslySetInnerHTML"?p=h:d=="value"?f=h:d=="checked"?w=h:d==="key"||c&&typeof h!="function"||m[d]===h||Et(i,d,h,m[d],s);if(p)c||r&&(p.__html===r.__html||p.__html===i.innerHTML)||(i.innerHTML=p.__html),t.__k=[];else if(r&&(i.innerHTML=""),as(i,Qn(l)?l:[l],t,e,n,s&&y!=="foreignObject",o,a,o?o[0]:e.__k&&rt(e,0),c,_),o!=null)for(d=o.length;d--;)o[d]!=null&&rs(o[d]);c||(d="value",f!==void 0&&(f!==i[d]||y==="progress"&&!f||y==="option"&&f!==m[d])&&Et(i,d,f,m[d],!1),d="checked",w!==void 0&&w!==i[d]&&Et(i,d,w,m[d],!1))}return i}function Jn(i,t,e){try{typeof i=="function"?i(t):i.current=t}catch(n){U.__e(n,e)}}function En(i,t,e){var n,s;if(U.unmount&&U.unmount(i),(n=i.ref)&&(n.current&&n.current!==i.__e||Jn(n,null,t)),(n=i.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(o){U.__e(o,t)}n.base=n.__P=null,i.__c=void 0}if(n=i.__k)for(s=0;s<n.length;s++)n[s]&&En(n[s],t,e||typeof i.type!="function");e||i.__e==null||rs(i.__e),i.__=i.__e=i.__d=void 0}function lr(i,t,e){return this.constructor(i,e)}function cr(i,t,e){var n,s,o,a;U.__&&U.__(i,t),s=(n=typeof e=="function")?null:e&&e.__k||t.__k,o=[],a=[],Yn(t,i=(!n&&e||t).__k=ir(Pt,null,[i]),s||yt,yt,t.ownerSVGElement!==void 0,!n&&e?[e]:s?null:t.firstChild?mn.call(t.childNodes):null,o,!n&&e?e:s?s.__e:t.firstChild,n,a),i.__d=void 0,Cn(o,i,a)}mn=Zn.slice,U={__e:function(i,t,e,n){for(var s,o,a;t=t.__;)if((s=t.__c)&&!s.__)try{if((o=s.constructor)&&o.getDerivedStateFromError!=null&&(s.setState(o.getDerivedStateFromError(i)),a=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(i,n||{}),a=s.__d),a)return s.__E=s}catch(c){i=c}throw i}},is=0,mt.prototype.setState=function(i,t){var e;e=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=je({},this.state),typeof i=="function"&&(i=i(je({},e),this.props)),i&&je(e,i),i!=null&&this.__v&&(t&&this._sb.push(t),ai(this))},mt.prototype.forceUpdate=function(i){this.__v&&(this.__e=!0,i&&this.__h.push(i),ai(this))},mt.prototype.render=Pt,Ue=[],ss=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Fn=function(i,t){return i.__v.__b-t.__v.__b},Jt.__r=0;var jn,q,An,hi,Rn=0,cs=[],zt=[],Z=U,ui=Z.__b,di=Z.__r,pi=Z.diffed,fi=Z.__c,mi=Z.unmount,gi=Z.__;function _r(i,t){Z.__h&&Z.__h(q,i,Rn||t),Rn=0;var e=q.__H||(q.__H={__:[],__h:[]});return i>=e.__.length&&e.__.push({__V:zt}),e.__[i]}function hr(i){return Rn=1,ur(_s,i)}function ur(i,t,e){var n=_r(jn++,2);if(n.t=i,!n.__c&&(n.__=[e?e(t):_s(void 0,t),function(c){var _=n.__N?n.__N[0]:n.__[0],d=n.t(_,c);_!==d&&(n.__N=[d,n.__[1]],n.__c.setState({}))}],n.__c=q,!q.u)){var s=function(c,_,d){if(!n.__c.__H)return!0;var p=n.__c.__H.__.filter(function(l){return!!l.__c});if(p.every(function(l){return!l.__N}))return!o||o.call(this,c,_,d);var r=!1;return p.forEach(function(l){if(l.__N){var h=l.__[0];l.__=l.__N,l.__N=void 0,h!==l.__[0]&&(r=!0)}}),!(!r&&n.__c.props===c)&&(!o||o.call(this,c,_,d))};q.u=!0;var o=q.shouldComponentUpdate,a=q.componentWillUpdate;q.componentWillUpdate=function(c,_,d){if(this.__e){var p=o;o=void 0,s(c,_,d),o=p}a&&a.call(this,c,_,d)},q.shouldComponentUpdate=s}return n.__N||n.__}function dr(){for(var i;i=cs.shift();)if(i.__P&&i.__H)try{i.__H.__h.forEach(Xt),i.__H.__h.forEach(kn),i.__H.__h=[]}catch(t){i.__H.__h=[],Z.__e(t,i.__v)}}Z.__b=function(i){q=null,ui&&ui(i)},Z.__=function(i,t){t.__k&&t.__k.__m&&(i.__m=t.__k.__m),gi&&gi(i,t)},Z.__r=function(i){di&&di(i),jn=0;var t=(q=i.__c).__H;t&&(An===q?(t.__h=[],q.__h=[],t.__.forEach(function(e){e.__N&&(e.__=e.__N),e.__V=zt,e.__N=e.i=void 0})):(t.__h.forEach(Xt),t.__h.forEach(kn),t.__h=[],jn=0)),An=q},Z.diffed=function(i){pi&&pi(i);var t=i.__c;t&&t.__H&&(t.__H.__h.length&&(cs.push(t)!==1&&hi===Z.requestAnimationFrame||((hi=Z.requestAnimationFrame)||pr)(dr)),t.__H.__.forEach(function(e){e.i&&(e.__H=e.i),e.__V!==zt&&(e.__=e.__V),e.i=void 0,e.__V=zt})),An=q=null},Z.__c=function(i,t){t.some(function(e){try{e.__h.forEach(Xt),e.__h=e.__h.filter(function(n){return!n.__||kn(n)})}catch(n){t.some(function(s){s.__h&&(s.__h=[])}),t=[],Z.__e(n,e.__v)}}),fi&&fi(i,t)},Z.unmount=function(i){mi&&mi(i);var t,e=i.__c;e&&e.__H&&(e.__H.__.forEach(function(n){try{Xt(n)}catch(s){t=s}}),e.__H=void 0,t&&Z.__e(t,e.__v))};var wi=typeof requestAnimationFrame=="function";function pr(i){var t,e=function(){clearTimeout(n),wi&&cancelAnimationFrame(t),setTimeout(i)},n=setTimeout(e,100);wi&&(t=requestAnimationFrame(e))}function Xt(i){var t=q,e=i.__c;typeof e=="function"&&(i.__c=void 0,e()),q=t}function kn(i){var t=q;i.__c=i.__(),q=t}function _s(i,t){return typeof t=="function"?t(i):t}const fr="/assets/wonderland-horizontal-reversed-Bw06uarI.svg",mr=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),gr=()=>(async i=>{try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(i)}catch{return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]));var b;(function(i){i[i.Native=0]="Native",i[i.Bool=1]="Bool",i[i.Int=2]="Int",i[i.Float=3]="Float",i[i.String=4]="String",i[i.Enum=5]="Enum",i[i.Object=6]="Object",i[i.Mesh=7]="Mesh",i[i.Texture=8]="Texture",i[i.Material=9]="Material",i[i.Animation=10]="Animation",i[i.Skin=11]="Skin",i[i.Color=12]="Color",i[i.Vector2=13]="Vector2",i[i.Vector3=14]="Vector3",i[i.Vector4=15]="Vector4"})(b||(b={}));class hs{clone(t,e){switch(t){case b.Color:case b.Vector2:case b.Vector3:case b.Vector4:return e.slice();default:return e}}}const tt=new hs,Y={bool(i=!1){return{type:b.Bool,default:i}},int(i=0){return{type:b.Int,default:i}},float(i=0){return{type:b.Float,default:i}},string(i=""){return{type:b.String,default:i}},enum(i,t){return{type:b.Enum,values:i,default:t}},object(i){return{type:b.Object,default:null,required:(i==null?void 0:i.required)??!1}},mesh(i){return{type:b.Mesh,default:null,required:(i==null?void 0:i.required)??!1}},texture(i){return{type:b.Texture,default:null,required:(i==null?void 0:i.required)??!1}},material(i){return{type:b.Material,default:null,required:(i==null?void 0:i.required)??!1}},animation(i){return{type:b.Animation,default:null,required:(i==null?void 0:i.required)??!1}},skin(i){return{type:b.Skin,default:null,required:(i==null?void 0:i.required)??!1}},color(i=0,t=0,e=0,n=1){return{type:b.Color,default:[i,t,e,n]}},vector2(i=0,t=0){return{type:b.Vector2,default:[i,t]}},vector3(i=0,t=0,e=0){return{type:b.Vector3,default:[i,t,e]}},vector4(i=0,t=0,e=0,n=0){return{type:b.Vector4,default:[i,t,e,n]}}};function us(i){return function(t,e){const n=t.constructor;n.Properties=n.hasOwnProperty("Properties")?n.Properties:{},n.Properties[e]=i}}function Ft(){return function(i,t,e){e.enumerable=!0}}function P(){return function(i,t,e){Ft()(i,t,e),us({type:b.Native})(i,t)}}const j={};for(const i in Y)j[i]=(...t)=>{const e=Y[i];return us(e(...t))};function fe(i){return i===""?!0:i&&(typeof i=="string"||i.constructor===String)}function wr(i){return i==null?!1:typeof i=="number"||i.constructor===Number}function yr(i){return i instanceof HTMLImageElement||i instanceof HTMLVideoElement||i instanceof HTMLCanvasElement}var gt;(function(i){i[i.Addition=1]="Addition",i[i.Removal=2]="Removal"})(gt||(gt={}));class H{constructor(){u(this,"_listeners",[]);u(this,"_notifying",!1);u(this,"_transactions",[])}add(t,e={}){const{once:n=!1,id:s=void 0}=e,o={id:s,once:n,callback:t};return this._notifying?(this._transactions.push({type:gt.Addition,data:o}),this):(this._listeners.push(o),this)}push(...t){for(const e of t)this.add(e);return this}once(t){return this.add(t,{once:!0})}remove(t){if(this._notifying)return this._transactions.push({type:gt.Removal,data:t}),this;const e=this._listeners;for(let n=0;n<e.length;++n){const s=e[n];(s.callback===t||s.id===t)&&e.splice(n--,1)}return this}has(t){const e=this._listeners;for(let n=0;n<e.length;++n){const s=e[n];if(s.callback===t||s.id===t)return!0}return!1}notify(...t){const e=this._listeners;this._notifying=!0;for(let n=0;n<e.length;++n){const s=e[n];s.once&&e.splice(n--,1);try{s.callback(...t)}catch(o){console.error(o)}}this._notifying=!1,this._flushTransactions()}notifyUnsafe(...t){const e=this._listeners;for(let n=0;n<e.length;++n){const s=e[n];s.once&&e.splice(n--,1),s.callback(...t)}this._flushTransactions()}promise(){return new Promise((t,e)=>{this.once((...n)=>{n.length>1?t(n):t(n[0])})})}get listenerCount(){return this._listeners.length}get isEmpty(){return this.listenerCount===0}_flushTransactions(){const t=this._listeners;for(const e of this._transactions)e.type===gt.Addition?t.push(e.data):this.remove(e.data);this._transactions.length=0}}const jt={};class Kt extends H{constructor(){super(...arguments);u(this,"_event",jt);u(this,"_reset")}add(e,n){const s=(n==null?void 0:n.immediate)??!0;return this._event!==jt&&s&&e(...this._event),super.add(e,n),this}once(e,n){return this.add(e,{once:!0,immediate:n})}notify(...e){this._event=e,super.notify(...e)}notifyUnsafe(...e){this._event=e,super.notifyUnsafe(...e)}reset(){return this._event=jt,this}get data(){return this.isDataRetained?this._event:void 0}get isDataRetained(){return this._event!==jt}}function vr(i,t){return new Proxy({},{get(e,n){if(n==="isDestroyed")return!0;throw new Error(`Cannot read '${n}' of destroyed '${t.name}' resource from ${i}`)},set(e,n){throw new Error(`Cannot write '${n}' of destroyed '${t.name}' resource from ${i}`)}})}class at{constructor(t,e){u(this,"_index",-1);u(this,"_id",-1);u(this,"_engine");this._engine=t,this._index=e,this._id=e}get engine(){return this._engine}get index(){return this._index}equals(t){return t?this._index===t._index:!1}get isDestroyed(){return this._index<=0}}class Ct{constructor(t,e){u(this,"_index",-1);u(this,"_id",-1);u(this,"_scene");this._scene=t,this._index=e,this._id=Ct._pack(t._index,e)}static _pack(t,e){return t<<22|e}equals(t){return t?this._id===t._id:!1}get scene(){return this._scene}get engine(){return this._scene.engine}get index(){return this._index}get isDestroyed(){return this._id<=0}}class Le{constructor(t,e){u(this,"_host");u(this,"_cache",[]);u(this,"_template");u(this,"_destructor",null);u(this,"_engine");this._host=t,this._template=e,this._engine=t.engine??t}wrap(t){return t<=0?null:this._cache[t]??(this._cache[t]=new this._template(this._host,t))}get(t){return this._cache[t]??null}get allocatedCount(){return this._cache.length}get count(){let t=0;for(const e of this._cache)e&&e.index>=0&&++t;return t}get engine(){return this._engine}_destroy(t){const e=t.index;t._index=-1,t._id=-1,this._cache[e]=null,this.engine.erasePrototypeOnDestroy&&(this._destructor||(this._destructor=vr(this._host,this._template)),Object.setPrototypeOf(t,this._destructor))}_clear(){if(this.engine.erasePrototypeOnDestroy){for(let t=0;t<this._cache.length;++t){const e=this._cache[t];e&&this._destroy(e)}this._cache.length=0}}}class br{constructor(t){u(this,"animation",-1);u(this,"collision",-1);u(this,"js",-1);u(this,"physx",-1);u(this,"view",-1);u(this,"_cache",[]);u(this,"_constructors");u(this,"_nativeManagers",new Map);u(this,"_scene");this._scene=t;const e=this._scene.engine.wasm,n=[Ie,Oe,lt,ee,_e,V,ue,Te];this._cache=new Array(n.length),this._constructors=new Array(n.length);for(const o of n){const a=e.tempUTF8(o.TypeName),c=e._wl_scene_get_component_manager_index(t._index,a);this._constructors,this._constructors[c]=o,this._cache[c]=[],this._nativeManagers.set(o.TypeName,c)}this.animation=this._nativeManagers.get(Ie.TypeName),this.collision=this._nativeManagers.get(Oe.TypeName),this.physx=this._nativeManagers.get(V.TypeName),this.view=this._nativeManagers.get(Te.TypeName);const s=e.tempUTF8("js");this.js=e._wl_scene_get_component_manager_index(t._index,s),this._cache[this.js]=[]}createJs(t,e,n,s){const a=this._scene.engine.wasm._componentTypes[n];if(!a)throw new Error(`Type index ${n} isn't registered`);const c=this._scene.engine.log;let _=null;try{_=new a(this._scene,this.js,e)}catch(d){c.error(I.Component,`Exception during instantiation of component ${a.TypeName}`),c.error(I.Component,d),_=new Ae(this._scene)}_._object=this._scene.wrap(s);try{_.resetProperties()}catch(d){c.error(I.Component,`Exception during ${_.type} resetProperties() on object ${_.object.name}`),c.error(I.Component,d)}return this._scene._jsComponents[t]=_,this._cache[this.js][e]=_,_}get(t,e){return this._cache[t][e]??null}wrapAnimation(t){return this.wrapNative(this.animation,t)}wrapCollision(t){return this.wrapNative(this.collision,t)}wrapView(t){return this.wrapNative(this.view,t)}wrapPhysx(t){return this.wrapNative(this.physx,t)}wrapNative(t,e){if(e<0)return null;const n=this._cache[t];if(n[e])return n[e];const s=this._scene,o=this._constructors[t],a=new o(s,t,e);return n[e]=a,a}wrapAny(t,e){if(e<0)return null;if(t===this.js){const n=this._cache[this.js][e];if(!n)throw new Error("JS components must always be cached");return n.constructor!==Ae?n:null}return this.wrapNative(t,e)}getNativeManager(t){const e=this._nativeManagers.get(t);return e!==void 0?e:null}destroy(t){const e=t._localId,n=t._manager;t._id=-1,t._localId=-1,t._manager=-1,this._scene.engine.erasePrototypeOnDestroy&&t&&Object.setPrototypeOf(t,ps),this._cache[n][e]=null}get managersCount(){return this._nativeManagers.size+1}}function Ln(i,t){return new Promise((e,n)=>{const s=new XMLHttpRequest;s.open("GET",i),s.responseType="arraybuffer",s.onprogress=o=>{o.lengthComputable&&(t==null||t(o.loaded,o.total))},s.onload=()=>{if(s.status>=200&&s.status<300){const o=s.response;t==null||t(o.byteLength,o.byteLength),e(o)}else n(s.statusText)},s.onerror=()=>n(s.statusText),s.send()})}function Kn(i){return i.substring(0,i.lastIndexOf("/"))}function xr(i){i.endsWith("/")&&(i=i.substring(0,i.lastIndexOf("/")));const t=i.lastIndexOf("/");return t<0?i:i.substring(t+1)}function Ar(i){return new Promise((t,e)=>{if(i instanceof HTMLCanvasElement)t(i);else if(i instanceof HTMLVideoElement){if(i.readyState>=2){t(i);return}i.addEventListener("loadeddata",()=>{i.readyState>=2&&t(i)},{once:!0});return}else if(i.complete){t(i);return}i.addEventListener("load",()=>t(i),{once:!0}),i.addEventListener("error",e,{once:!0})})}class ze{constructor(t,e){u(this,"_index");u(this,"_engine");u(this,"_components");u(this,"_jsComponents",[]);u(this,"_animations");u(this,"_skins");u(this,"_objectCache",[]);this._engine=t,this._index=e,this._components=new br(this),this._animations=new Le(this,ys),this._skins=new Le(this,ti)}static async loadBuffer(t,e){const n=fe(t)?t:t.url,s=await Ln(n,e),o=Kn(n),a=xr(n);return{buffer:s,baseURL:o,filename:a}}static validateBufferOptions(t){const{buffer:e,baseURL:n,filename:s="scene.bin"}=t;if(!e)throw new Error("missing 'buffer' in options");if(!fe(n))throw new Error("missing 'baseURL' in options");const o=n?`${n}/${s}`:s;return{buffer:e,baseURL:n,url:o}}addObject(t=null){this.assertOrigin(t);const e=t?t._id:0,n=this.engine.wasm._wl_scene_add_object(this._index,e);return this.wrap(n)}addObjects(t,e=null,n=0){const s=e?e._id:0;this.engine.wasm.requireTempMem(t*2);const o=this.engine.wasm._wl_scene_add_objects(this._index,s,t,n||0,this.engine.wasm._tempMem,this.engine.wasm._tempMemSize>>1),a=this.engine.wasm._tempMemUint16.subarray(0,o),c=this.wrap.bind(this);return Array.from(a,c)}reserveObjects(t,e){const n=this.engine.wasm;e=e||{};const s=Object.keys(e),o=n._tempMemInt;for(let a=0;a<this._components.managersCount;++a)o[a]=0;for(const a of s){const c=e[a],_=this._components.getNativeManager(a);o[_!==null?_:this._components.js]+=c}n._wl_scene_reserve_objects(this._index,t,n._tempMem)}getChildren(t=new Array(this.childrenCount)){return this.wrap(0).getChildren(t)}get children(){return this.wrap(0).children}get childrenCount(){return this.engine.wasm._wl_object_get_children_count(0)}findByName(t,e=!1){return this.wrap(0).findByName(t,e)}findByNameDirect(t){return this.wrap(0).findByNameDirect(t)}findByNameRecursive(t){return this.wrap(0).findByNameRecursive(t)}wrap(t){const e=this._objectCache;return e[t]||(e[t]=new Vn(this,t))}destroy(){this.engine._destroyScene(this)}get isActive(){return!!this.engine.wasm._wl_scene_active(this._index)}get baseURL(){const t=this.engine.wasm,e=t._wl_scene_get_baseURL(this._index);return e?t.UTF8ToString(e):""}get filename(){const t=this.engine.wasm,e=t._wl_scene_get_filename(this._index);return e?t.UTF8ToString(e):""}get animations(){return this._animations}get skins(){return this._skins}get engine(){return this._engine}get isDestroyed(){return this._index<0}toString(){return this.isDestroyed?"Scene(destroyed)":`Scene('${this.filename}', ${this._index})`}assertOrigin(t){if(t&&t.scene!==this)throw new Error(`Attempt to use ${t} from ${t.scene} in ${this}`)}_initialize(){this.engine.wasm._wl_scene_initialize(this._index)}_destroyObject(t){const e=this._objectCache[t];e&&(e._id=-1,e._localId=-1,this.engine.erasePrototypeOnDestroy&&e&&Object.setPrototypeOf(e,ds),this._objectCache[t]=null)}}function Sr(i,t,e){return Math.max(Math.min(e,i),t)}function Sn(i){return`${i[0].toUpperCase()}${i.substring(1)}`}function gn(i){return new Proxy({},{get(t,e){if(e==="isDestroyed")return!0;throw new Error(`Cannot read '${e}' of destroyed ${i}`)},set(t,e){throw new Error(`Cannot write '${e}' of destroyed ${i}`)}})}var M=function(i,t,e,n){var s=arguments.length,o=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,t,e,n);else for(var c=i.length-1;c>=0;c--)(a=i[c])&&(o=(s<3?a(o):s>3?a(t,e,o):a(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},I;(function(i){i[i.Engine=0]="Engine",i[i.Scene=1]="Scene",i[i.Component=2]="Component"})(I||(I={}));var ot;(function(i){i[i.Sphere=0]="Sphere",i[i.AxisAlignedBox=1]="AxisAlignedBox",i[i.Box=2]="Box"})(ot||(ot={}));var On;(function(i){i[i.Left=0]="Left",i[i.Center=1]="Center",i[i.Right=2]="Right"})(On||(On={}));var en;(function(i){i[i.Line=0]="Line",i[i.Middle=1]="Middle",i[i.Top=2]="Top",i[i.Bottom=3]="Bottom"})(en||(en={}));const Tr=en;var In;(function(i){i[i.None=0]="None",i[i.Outline=1]="Outline"})(In||(In={}));var ve;(function(i){i[i.Head=0]="Head",i[i.EyeLeft=1]="EyeLeft",i[i.EyeRight=2]="EyeRight",i[i.ControllerLeft=3]="ControllerLeft",i[i.ControllerRight=4]="ControllerRight",i[i.RayLeft=5]="RayLeft",i[i.RayRight=6]="RayRight"})(ve||(ve={}));var Dn;(function(i){i[i.Point=0]="Point",i[i.Spot=1]="Spot",i[i.Sun=2]="Sun"})(Dn||(Dn={}));var Hn;(function(i){i[i.Playing=0]="Playing",i[i.Paused=1]="Paused",i[i.Stopped=2]="Stopped"})(Hn||(Hn={}));var vt;(function(i){i[i.Force=0]="Force",i[i.Impulse=1]="Impulse",i[i.VelocityChange=2]="VelocityChange",i[i.Acceleration=3]="Acceleration"})(vt||(vt={}));var Bn;(function(i){i[i.Touch=0]="Touch",i[i.TouchLost=1]="TouchLost",i[i.TriggerTouch=2]="TriggerTouch",i[i.TriggerTouchLost=3]="TriggerTouchLost"})(Bn||(Bn={}));var bt;(function(i){i[i.None=0]="None",i[i.Sphere=1]="Sphere",i[i.Capsule=2]="Capsule",i[i.Box=3]="Box",i[i.Plane=4]="Plane",i[i.ConvexMesh=5]="ConvexMesh",i[i.TriangleMesh=6]="TriangleMesh"})(bt||(bt={}));var me;(function(i){i[i.Position=0]="Position",i[i.Tangent=1]="Tangent",i[i.Normal=2]="Normal",i[i.TextureCoordinate=3]="TextureCoordinate",i[i.Color=4]="Color",i[i.JointId=5]="JointId",i[i.JointWeight=6]="JointWeight"})(me||(me={}));const ds=gn("object"),ps=gn("component"),fs=gn("prefab/scene");function yi(i){return i===bt.ConvexMesh||i===bt.TriangleMesh}function Mr(i){return!!i&&i.hasOwnProperty("_isBaseComponent")&&i._isBaseComponent}const Pr=[0,1,0],Fr=Math.sqrt(3),ye=class ye{constructor(t,e=-1,n=-1){u(this,"_manager");u(this,"_id");u(this,"_localId");u(this,"_object");u(this,"_scene");this._scene=t,this._manager=e,this._localId=n,this._id=ye._pack(t._index,n),this._object=null}static _pack(t,e){return t<<22|e}static _inheritProperties(){ei(this)}get scene(){return this._scene}get engine(){return this._scene.engine}get type(){return this.constructor.TypeName}get object(){if(!this._object){const t=this.engine.wasm._wl_component_get_object(this._manager,this._id);this._object=this._scene.wrap(t)}return this._object}set active(t){this.engine.wasm._wl_component_setActive(this._manager,this._id,t)}get active(){return this.markedActive&&this._scene.isActive}get markedActive(){return this.engine.wasm._wl_component_isActive(this._manager,this._id)!=0}copy(t){const n=this.constructor.Properties;if(!n)return this;for(const s in n){const o=n[s],a=t[s];if(a===void 0)continue;const c=o.cloner??tt;this[s]=c.clone(o.type,a)}return this}destroy(){const t=this._manager;t<0||this._id<0||this.engine.wasm._wl_component_remove(t,this._id)}equals(t){return t?this._manager===t._manager&&this._id===t._id:!1}resetProperties(){const e=this.constructor.Properties;if(!e)return this;for(const n in e){const s=e[n],o=s.cloner??tt;this[n]=o.clone(s.type,s.default)}return this}reset(){return this.resetProperties()}validateProperties(){const t=this.constructor;if(t.Properties){for(const e in t.Properties)if(t.Properties[e].required&&!this[e])throw new Error(`Property '${e}' is required but was not initialized`)}}toString(){return this.isDestroyed?"Component(destroyed)":`Component('${this.type}', ${this._localId})`}get isDestroyed(){return this._id<0}_copy(t,e){const n=this.engine.wasm,s=n.HEAPU32,o=e>>>2,a=this._scene,c=this.constructor;for(const _ in c.Properties){const d=t[_];if(d===null){this[_]=null;continue}const p=c.Properties[_],r=s[o+p.type];let l;switch(p.type){case b.Object:{const f=n._wl_object_index(d._id),w=n._wl_object_id(a._index,f+r);l=a.wrap(w);break}case b.Animation:l=a.animations.wrap(r+d._index);break;case b.Skin:l=a.skins.wrap(r+d._index);break;default:l=(p.cloner??tt).clone(p.type,d);break}this[_]=l}return this}_triggerInit(){if(this.init)try{this.init()}catch(e){this.engine.log.error(I.Component,`Exception during ${this.type} init() on object ${this.object.name}`),this.engine.log.error(I.Component,e)}const t=this.onActivate;this.onActivate=function(){var n;this.onActivate=t;let e=!1;try{this.validateProperties()}catch(s){this.engine.log.error(I.Component,`Exception during ${this.type} validateProperties() on object ${this.object.name}`),this.engine.log.error(I.Component,s),e=!0}try{(n=this.start)==null||n.call(this)}catch(s){this.engine.log.error(I.Component,`Exception during ${this.type} start() on object ${this.object.name}`),this.engine.log.error(I.Component,s),e=!0}if(e){this.active=!1;return}if(this.onActivate)try{this.onActivate()}catch(s){this.engine.log.error(I.Component,`Exception during ${this.type} onActivate() on object ${this.object.name}`),this.engine.log.error(I.Component,s)}}}_triggerUpdate(t){if(this.update)try{this.update(t)}catch(e){this.engine.log.error(I.Component,`Exception during ${this.type} update() on object ${this.object.name}`),this.engine.log.error(I.Component,e),this.engine.wasm._deactivate_component_on_error&&(this.active=!1)}}_triggerOnActivate(){if(this.onActivate)try{this.onActivate()}catch(t){this.engine.log.error(I.Component,`Exception during ${this.type} onActivate() on object ${this.object.name}`),this.engine.log.error(I.Component,t)}}_triggerOnDeactivate(){if(this.onDeactivate)try{this.onDeactivate()}catch(t){this.engine.log.error(I.Component,`Exception during ${this.type} onDeactivate() on object ${this.object.name}`),this.engine.log.error(I.Component,t)}}_triggerOnDestroy(){try{this.onDestroy&&this.onDestroy()}catch(t){this.engine.log.error(I.Component,`Exception during ${this.type} onDestroy() on object ${this.object.name}`),this.engine.log.error(I.Component,t)}this._scene._components.destroy(this)}};u(ye,"_isBaseComponent",!0),u(ye,"_propertyOrder",[]),u(ye,"TypeName"),u(ye,"Properties"),u(ye,"InheritProperties"),u(ye,"onRegister");let k=ye;class Ae extends k{}u(Ae,"TypeName","__broken-component__");function ei(i){if(!i.TypeName)return;const t=[];let e=i;for(;e&&!Mr(e);){const s=e;if(!(s.hasOwnProperty("InheritProperties")?s.InheritProperties:!0))break;s.TypeName&&s.hasOwnProperty("Properties")&&t.push(s),e=Object.getPrototypeOf(e)}if(!t.length||t.length===1&&t[0]===i)return;const n={};for(let s=t.length-1;s>=0;--s)Object.assign(n,t[s].Properties);i.Properties=n}class Oe extends k{getExtents(t=new Float32Array(3)){const e=this.engine.wasm,n=e._wl_collision_component_get_extents(this._id)/4;return t[0]=e.HEAPF32[n],t[1]=e.HEAPF32[n+1],t[2]=e.HEAPF32[n+2],t}get collider(){return this.engine.wasm._wl_collision_component_get_collider(this._id)}set collider(t){this.engine.wasm._wl_collision_component_set_collider(this._id,t)}get extents(){const t=this.engine.wasm;return new Float32Array(t.HEAPF32.buffer,t._wl_collision_component_get_extents(this._id),3)}set extents(t){const e=this.engine.wasm,n=e._wl_collision_component_get_extents(this._id)/4;e.HEAPF32[n]=t[0],e.HEAPF32[n+1]=t[1],e.HEAPF32[n+2]=t[2]}get radius(){const t=this.engine.wasm;if(this.collider===ot.Sphere)return t.HEAPF32[t._wl_collision_component_get_extents(this._id)>>2];const e=new Float32Array(t.HEAPF32.buffer,t._wl_collision_component_get_extents(this._id),3),n=e[0]*e[0],s=e[1]*e[1],o=e[2]*e[2];return Math.sqrt(n+s+o)/2}set radius(t){const e=this.collider===ot.Sphere?t:2*t/Fr;this.extents.set([e,e,e])}get group(){return this.engine.wasm._wl_collision_component_get_group(this._id)}set group(t){this.engine.wasm._wl_collision_component_set_group(this._id,t)}queryOverlaps(){const t=this.engine.wasm._wl_collision_component_query_overlaps(this._id,this.engine.wasm._tempMem,this.engine.wasm._tempMemSize>>1),e=new Array(t);for(let n=0;n<t;++n){const s=this.engine.wasm._tempMemUint16[n];e[n]=this._scene._components.wrapCollision(s)}return e}}u(Oe,"TypeName","collision");M([P()],Oe.prototype,"collider",null);M([P()],Oe.prototype,"extents",null);M([P()],Oe.prototype,"group",null);class ue extends k{get alignment(){return this.engine.wasm._wl_text_component_get_horizontal_alignment(this._id)}set alignment(t){this.engine.wasm._wl_text_component_set_horizontal_alignment(this._id,t)}get verticalAlignment(){return this.engine.wasm._wl_text_component_get_vertical_alignment(this._id)}set verticalAlignment(t){this.engine.wasm._wl_text_component_set_vertical_alignment(this._id,t)}get justification(){return this.verticalAlignment}set justification(t){this.verticalAlignment=t}get characterSpacing(){return this.engine.wasm._wl_text_component_get_character_spacing(this._id)}set characterSpacing(t){this.engine.wasm._wl_text_component_set_character_spacing(this._id,t)}get lineSpacing(){return this.engine.wasm._wl_text_component_get_line_spacing(this._id)}set lineSpacing(t){this.engine.wasm._wl_text_component_set_line_spacing(this._id,t)}get effect(){return this.engine.wasm._wl_text_component_get_effect(this._id)}set effect(t){this.engine.wasm._wl_text_component_set_effect(this._id,t)}get text(){const t=this.engine.wasm,e=t._wl_text_component_get_text(this._id);return t.UTF8ToString(e)}set text(t){const e=this.engine.wasm;e._wl_text_component_set_text(this._id,e.tempUTF8(t.toString()))}set material(t){const e=t?t._id:0;this.engine.wasm._wl_text_component_set_material(this._id,e)}get material(){const t=this.engine.wasm._wl_text_component_get_material(this._id);return this.engine.materials.wrap(t)}getBoundingBoxForText(t,e=new Float32Array(4)){const n=this.engine.wasm,s=n.tempUTF8(t,4*4);return this.engine.wasm._wl_text_component_get_boundingBox(this._id,s,n._tempMem),e[0]=n._tempMemFloat[0],e[1]=n._tempMemFloat[1],e[2]=n._tempMemFloat[2],e[3]=n._tempMemFloat[3],e}getBoundingBox(t=new Float32Array(4)){const e=this.engine.wasm;return this.engine.wasm._wl_text_component_get_boundingBox(this._id,0,e._tempMem),t[0]=e._tempMemFloat[0],t[1]=e._tempMemFloat[1],t[2]=e._tempMemFloat[2],t[3]=e._tempMemFloat[3],t}}u(ue,"TypeName","text");M([P()],ue.prototype,"alignment",null);M([P()],ue.prototype,"verticalAlignment",null);M([P()],ue.prototype,"justification",null);M([P()],ue.prototype,"characterSpacing",null);M([P()],ue.prototype,"lineSpacing",null);M([P()],ue.prototype,"effect",null);M([P()],ue.prototype,"text",null);M([P()],ue.prototype,"material",null);class Te extends k{getProjectionMatrix(t=new Float32Array(16)){const e=this.engine.wasm,n=e._wl_view_component_get_projection_matrix(this._id)/4;for(let s=0;s<16;++s)t[s]=e.HEAPF32[n+s];return t}get projectionMatrix(){const t=this.engine.wasm;return new Float32Array(t.HEAPF32.buffer,t._wl_view_component_get_projection_matrix(this._id),16)}get near(){return this.engine.wasm._wl_view_component_get_near(this._id)}set near(t){this.engine.wasm._wl_view_component_set_near(this._id,t)}get far(){return this.engine.wasm._wl_view_component_get_far(this._id)}set far(t){this.engine.wasm._wl_view_component_set_far(this._id,t)}get fov(){return this.engine.wasm._wl_view_component_get_fov(this._id)}set fov(t){this.engine.wasm._wl_view_component_set_fov(this._id,t)}}u(Te,"TypeName","view");M([Ft()],Te.prototype,"projectionMatrix",null);M([P()],Te.prototype,"near",null);M([P()],Te.prototype,"far",null);M([P()],Te.prototype,"fov",null);class lt extends k{get inputType(){return this.engine.wasm._wl_input_component_get_type(this._id)}set inputType(t){this.engine.wasm._wl_input_component_set_type(this._id,t)}get xrInputSource(){const t=this.engine.xr;if(!t)return null;for(let e of t.session.inputSources)if(e.handedness==this.handedness)return e;return null}get handedness(){const t=this.inputType;return t==ve.ControllerRight||t==ve.RayRight||t==ve.EyeRight?"right":t==ve.ControllerLeft||t==ve.RayLeft||t==ve.EyeLeft?"left":null}}u(lt,"TypeName","input");M([P()],lt.prototype,"inputType",null);M([Ft()],lt.prototype,"xrInputSource",null);M([Ft()],lt.prototype,"handedness",null);class ee extends k{getColor(t=new Float32Array(3)){const e=this.engine.wasm,n=e._wl_light_component_get_color(this._id)/4;return t[0]=e.HEAPF32[n],t[1]=e.HEAPF32[n+1],t[2]=e.HEAPF32[n+2],t}setColor(t){const e=this.engine.wasm,n=e._wl_light_component_get_color(this._id)/4;e.HEAPF32[n]=t[0],e.HEAPF32[n+1]=t[1],e.HEAPF32[n+2]=t[2]}get color(){const t=this.engine.wasm;return new Float32Array(t.HEAPF32.buffer,t._wl_light_component_get_color(this._id),3)}set color(t){this.color.set(t)}get lightType(){return this.engine.wasm._wl_light_component_get_type(this._id)}set lightType(t){this.engine.wasm._wl_light_component_set_type(this._id,t)}get intensity(){return this.engine.wasm._wl_light_component_get_intensity(this._id)}set intensity(t){this.engine.wasm._wl_light_component_set_intensity(this._id,t)}get outerAngle(){return this.engine.wasm._wl_light_component_get_outerAngle(this._id)}set outerAngle(t){this.engine.wasm._wl_light_component_set_outerAngle(this._id,t)}get innerAngle(){return this.engine.wasm._wl_light_component_get_innerAngle(this._id)}set innerAngle(t){this.engine.wasm._wl_light_component_set_innerAngle(this._id,t)}get shadows(){return!!this.engine.wasm._wl_light_component_get_shadows(this._id)}set shadows(t){this.engine.wasm._wl_light_component_set_shadows(this._id,t)}get shadowRange(){return this.engine.wasm._wl_light_component_get_shadowRange(this._id)}set shadowRange(t){this.engine.wasm._wl_light_component_set_shadowRange(this._id,t)}get shadowBias(){return this.engine.wasm._wl_light_component_get_shadowBias(this._id)}set shadowBias(t){this.engine.wasm._wl_light_component_set_shadowBias(this._id,t)}get shadowNormalBias(){return this.engine.wasm._wl_light_component_get_shadowNormalBias(this._id)}set shadowNormalBias(t){this.engine.wasm._wl_light_component_set_shadowNormalBias(this._id,t)}get shadowTexelSize(){return this.engine.wasm._wl_light_component_get_shadowTexelSize(this._id)}set shadowTexelSize(t){this.engine.wasm._wl_light_component_set_shadowTexelSize(this._id,t)}get cascadeCount(){return this.engine.wasm._wl_light_component_get_cascadeCount(this._id)}set cascadeCount(t){this.engine.wasm._wl_light_component_set_cascadeCount(this._id,t)}}u(ee,"TypeName","light");M([P()],ee.prototype,"color",null);M([P()],ee.prototype,"lightType",null);M([P()],ee.prototype,"intensity",null);M([P()],ee.prototype,"outerAngle",null);M([P()],ee.prototype,"innerAngle",null);M([P()],ee.prototype,"shadows",null);M([P()],ee.prototype,"shadowRange",null);M([P()],ee.prototype,"shadowBias",null);M([P()],ee.prototype,"shadowNormalBias",null);M([P()],ee.prototype,"shadowTexelSize",null);M([P()],ee.prototype,"cascadeCount",null);class Ie extends k{constructor(){super(...arguments);u(this,"onEvent",new H)}set animation(e){this.scene.assertOrigin(e),this.engine.wasm._wl_animation_component_set_animation(this._id,e?e._id:0)}get animation(){const e=this.engine.wasm._wl_animation_component_get_animation(this._id);return this._scene.animations.wrap(e)}set playCount(e){this.engine.wasm._wl_animation_component_set_playCount(this._id,e)}get playCount(){return this.engine.wasm._wl_animation_component_get_playCount(this._id)}set speed(e){this.engine.wasm._wl_animation_component_set_speed(this._id,e)}get speed(){return this.engine.wasm._wl_animation_component_get_speed(this._id)}get state(){return this.engine.wasm._wl_animation_component_state(this._id)}play(){this.engine.wasm._wl_animation_component_play(this._id)}stop(){this.engine.wasm._wl_animation_component_stop(this._id)}pause(){this.engine.wasm._wl_animation_component_pause(this._id)}getFloatParameter(e){const n=this.engine.wasm,s=n._wl_animation_component_getGraphParamIndex(this._id,n.tempUTF8(e));if(s===-1)throw Error(`Missing parameter '${e}'`);return n._wl_animation_component_getGraphParamValue(this._id,s,n._tempMem),n._tempMemFloat[0]}setFloatParameter(e,n){const s=this.engine.wasm,o=s._wl_animation_component_getGraphParamIndex(this._id,s.tempUTF8(e));if(o===-1)throw Error(`Missing parameter '${e}'`);s._tempMemFloat[0]=n,s._wl_animation_component_setGraphParamValue(this._id,o,s._tempMem)}}u(Ie,"TypeName","animation");M([P()],Ie.prototype,"animation",null);M([P()],Ie.prototype,"playCount",null);M([P()],Ie.prototype,"speed",null);M([Ft()],Ie.prototype,"state",null);class _e extends k{set material(t){this.engine.wasm._wl_mesh_component_set_material(this._id,t?t._id:0)}get material(){const t=this.engine.wasm._wl_mesh_component_get_material(this._id);return this.engine.materials.wrap(t)}get mesh(){const t=this.engine.wasm._wl_mesh_component_get_mesh(this._id);return this.engine.meshes.wrap(t)}set mesh(t){this.engine.wasm._wl_mesh_component_set_mesh(this._id,(t==null?void 0:t._id)??0)}get skin(){const t=this.engine.wasm._wl_mesh_component_get_skin(this._id);return this._scene.skins.wrap(t)}set skin(t){this.scene.assertOrigin(t),this.engine.wasm._wl_mesh_component_set_skin(this._id,t?t._id:0)}get morphTargets(){const t=this.engine.wasm._wl_mesh_component_get_morph_targets(this._id);return this.engine.morphTargets.wrap(t)}set morphTargets(t){this.engine.wasm._wl_mesh_component_set_morph_targets(this._id,(t==null?void 0:t._id)??0)}get morphTargetWeights(){return this.getMorphTargetWeights()}set morphTargetWeights(t){this.setMorphTargetWeights(t)}getMorphTargetWeights(t){const e=this.engine.wasm,n=e._wl_mesh_component_get_morph_target_weights(this._id,e._tempMem);t||(t=new Float32Array(n));for(let s=0;s<n;++s)t[s]=e._tempMemFloat[s];return t}getMorphTargetWeight(t){var n;const e=((n=this.morphTargets)==null?void 0:n.count)??0;if(t>=e)throw new Error(`Index ${t} is out of bounds for ${e} targets`);return this.engine.wasm._wl_mesh_component_get_morph_target_weight(this._id,t)}setMorphTargetWeights(t){var s;const e=((s=this.morphTargets)==null?void 0:s.count)??0;if(t.length!==e)throw new Error(`Expected ${e} weights but got ${t.length}`);const n=this.engine.wasm;n._tempMemFloat.set(t),n._wl_mesh_component_set_morph_target_weights(this._id,n._tempMem,t.length)}setMorphTargetWeight(t,e){var s;const n=((s=this.morphTargets)==null?void 0:s.count)??0;if(t>=n)throw new Error(`Index ${t} is out of bounds for ${n} targets`);this.engine.wasm._wl_mesh_component_set_morph_target_weight(this._id,t,e)}}u(_e,"TypeName","mesh");M([P()],_e.prototype,"material",null);M([P()],_e.prototype,"mesh",null);M([P()],_e.prototype,"skin",null);M([P()],_e.prototype,"morphTargets",null);M([P()],_e.prototype,"morphTargetWeights",null);var Un;(function(i){i[i.None=0]="None",i[i.X=1]="X",i[i.Y=2]="Y",i[i.Z=4]="Z"})(Un||(Un={}));class V extends k{getTranslationOffset(t=new Float32Array(3)){const e=this.engine.wasm;return e._wl_physx_component_get_offsetTranslation(this._id,e._tempMem),t[0]=e._tempMemFloat[0],t[1]=e._tempMemFloat[1],t[2]=e._tempMemFloat[2],t}getRotationOffset(t=new Float32Array(4)){const e=this.engine.wasm,n=e._wl_physx_component_get_offsetTransform(this._id)>>2;return t[0]=e.HEAPF32[n],t[1]=e.HEAPF32[n+1],t[2]=e.HEAPF32[n+2],t[3]=e.HEAPF32[n+3],t}getExtents(t=new Float32Array(3)){const e=this.engine.wasm,n=e._wl_physx_component_get_extents(this._id)/4;return t[0]=e.HEAPF32[n],t[1]=e.HEAPF32[n+1],t[2]=e.HEAPF32[n+2],t}getLinearVelocity(t=new Float32Array(3)){const e=this.engine.wasm,n=e._tempMemFloat;return e._wl_physx_component_get_linearVelocity(this._id,e._tempMem),t[0]=n[0],t[1]=n[1],t[2]=n[2],t}getAngularVelocity(t=new Float32Array(3)){const e=this.engine.wasm,n=e._tempMemFloat;return e._wl_physx_component_get_angularVelocity(this._id,e._tempMem),t[0]=n[0],t[1]=n[1],t[2]=n[2],t}set static(t){this.engine.wasm._wl_physx_component_set_static(this._id,t)}get static(){return!!this.engine.wasm._wl_physx_component_get_static(this._id)}get translationOffset(){return this.getTranslationOffset()}set translationOffset(t){this.engine.wasm._wl_physx_component_set_offsetTranslation(this._id,t[0],t[1],t[2])}get rotationOffset(){return this.getRotationOffset()}set rotationOffset(t){this.engine.wasm._wl_physx_component_set_offsetRotation(this._id,t[0],t[1],t[2],t[3])}set kinematic(t){this.engine.wasm._wl_physx_component_set_kinematic(this._id,t)}get kinematic(){return!!this.engine.wasm._wl_physx_component_get_kinematic(this._id)}set gravity(t){this.engine.wasm._wl_physx_component_set_gravity(this._id,t)}get gravity(){return!!this.engine.wasm._wl_physx_component_get_gravity(this._id)}set simulate(t){this.engine.wasm._wl_physx_component_set_simulate(this._id,t)}get simulate(){return!!this.engine.wasm._wl_physx_component_get_simulate(this._id)}set allowSimulation(t){this.engine.wasm._wl_physx_component_set_allowSimulation(this._id,t)}get allowSimulation(){return!!this.engine.wasm._wl_physx_component_get_allowSimulation(this._id)}set allowQuery(t){this.engine.wasm._wl_physx_component_set_allowQuery(this._id,t)}get allowQuery(){return!!this.engine.wasm._wl_physx_component_get_allowQuery(this._id)}set trigger(t){this.engine.wasm._wl_physx_component_set_trigger(this._id,t)}get trigger(){return!!this.engine.wasm._wl_physx_component_get_trigger(this._id)}set shape(t){this.engine.wasm._wl_physx_component_set_shape(this._id,t)}get shape(){return this.engine.wasm._wl_physx_component_get_shape(this._id)}set shapeData(t){t==null||!yi(this.shape)||this.engine.wasm._wl_physx_component_set_shape_data(this._id,t.index)}get shapeData(){return yi(this.shape)?{index:this.engine.wasm._wl_physx_component_get_shape_data(this._id)}:null}set extents(t){this.extents.set(t)}get extents(){const t=this.engine.wasm,e=t._wl_physx_component_get_extents(this._id);return new Float32Array(t.HEAPF32.buffer,e,3)}get staticFriction(){return this.engine.wasm._wl_physx_component_get_staticFriction(this._id)}set staticFriction(t){this.engine.wasm._wl_physx_component_set_staticFriction(this._id,t)}get dynamicFriction(){return this.engine.wasm._wl_physx_component_get_dynamicFriction(this._id)}set dynamicFriction(t){this.engine.wasm._wl_physx_component_set_dynamicFriction(this._id,t)}get bounciness(){return this.engine.wasm._wl_physx_component_get_bounciness(this._id)}set bounciness(t){this.engine.wasm._wl_physx_component_set_bounciness(this._id,t)}get linearDamping(){return this.engine.wasm._wl_physx_component_get_linearDamping(this._id)}set linearDamping(t){this.engine.wasm._wl_physx_component_set_linearDamping(this._id,t)}get angularDamping(){return this.engine.wasm._wl_physx_component_get_angularDamping(this._id)}set angularDamping(t){this.engine.wasm._wl_physx_component_set_angularDamping(this._id,t)}set linearVelocity(t){this.engine.wasm._wl_physx_component_set_linearVelocity(this._id,t[0],t[1],t[2])}get linearVelocity(){const t=this.engine.wasm;return t._wl_physx_component_get_linearVelocity(this._id,t._tempMem),new Float32Array(t.HEAPF32.buffer,t._tempMem,3)}set angularVelocity(t){this.engine.wasm._wl_physx_component_set_angularVelocity(this._id,t[0],t[1],t[2])}get angularVelocity(){const t=this.engine.wasm;return t._wl_physx_component_get_angularVelocity(this._id,t._tempMem),new Float32Array(t.HEAPF32.buffer,t._tempMem,3)}set groupsMask(t){this.engine.wasm._wl_physx_component_set_groupsMask(this._id,t)}get groupsMask(){return this.engine.wasm._wl_physx_component_get_groupsMask(this._id)}set blocksMask(t){this.engine.wasm._wl_physx_component_set_blocksMask(this._id,t)}get blocksMask(){return this.engine.wasm._wl_physx_component_get_blocksMask(this._id)}set linearLockAxis(t){this.engine.wasm._wl_physx_component_set_linearLockAxis(this._id,t)}get linearLockAxis(){return this.engine.wasm._wl_physx_component_get_linearLockAxis(this._id)}set angularLockAxis(t){this.engine.wasm._wl_physx_component_set_angularLockAxis(this._id,t)}get angularLockAxis(){return this.engine.wasm._wl_physx_component_get_angularLockAxis(this._id)}set mass(t){this.engine.wasm._wl_physx_component_set_mass(this._id,t)}get mass(){return this.engine.wasm._wl_physx_component_get_mass(this._id)}set massSpaceInteriaTensor(t){this.engine.wasm._wl_physx_component_set_massSpaceInertiaTensor(this._id,t[0],t[1],t[2])}set sleepOnActivate(t){this.engine.wasm._wl_physx_component_set_sleepOnActivate(this._id,t)}get sleepOnActivate(){return!!this.engine.wasm._wl_physx_component_get_sleepOnActivate(this._id)}addForce(t,e=vt.Force,n=!1,s,o=!1){const a=this.engine.wasm;if(!s){a._wl_physx_component_addForce(this._id,t[0],t[1],t[2],e,n);return}a._wl_physx_component_addForceAt(this._id,t[0],t[1],t[2],e,n,s[0],s[1],s[2],o)}addTorque(t,e=vt.Force){this.engine.wasm._wl_physx_component_addTorque(this._id,t[0],t[1],t[2],e)}onCollision(t){return this.onCollisionWith(this,t)}onCollisionWith(t,e){const n=this.engine.physics;return n._callbacks[this._id]=n._callbacks[this._id]||[],n._callbacks[this._id].push(e),this.engine.wasm._wl_physx_component_addCallback(this._id,t._id||this._id)}removeCollisionCallback(t){const e=this.engine.physics,n=this.engine.wasm._wl_physx_component_removeCallback(this._id,t);n&&e._callbacks[this._id].splice(-n)}}u(V,"TypeName","physx");M([P()],V.prototype,"static",null);M([P()],V.prototype,"translationOffset",null);M([P()],V.prototype,"rotationOffset",null);M([P()],V.prototype,"kinematic",null);M([P()],V.prototype,"gravity",null);M([P()],V.prototype,"simulate",null);M([P()],V.prototype,"allowSimulation",null);M([P()],V.prototype,"allowQuery",null);M([P()],V.prototype,"trigger",null);M([P()],V.prototype,"shape",null);M([P()],V.prototype,"shapeData",null);M([P()],V.prototype,"extents",null);M([P()],V.prototype,"staticFriction",null);M([P()],V.prototype,"dynamicFriction",null);M([P()],V.prototype,"bounciness",null);M([P()],V.prototype,"linearDamping",null);M([P()],V.prototype,"angularDamping",null);M([P()],V.prototype,"linearVelocity",null);M([P()],V.prototype,"angularVelocity",null);M([P()],V.prototype,"groupsMask",null);M([P()],V.prototype,"blocksMask",null);M([P()],V.prototype,"linearLockAxis",null);M([P()],V.prototype,"angularLockAxis",null);M([P()],V.prototype,"mass",null);M([P()],V.prototype,"sleepOnActivate",null);class ms{constructor(t){u(this,"_callbacks");u(this,"_hit");u(this,"_engine");u(this,"_rayHit");this._engine=t,this._rayHit=t.wasm._malloc(4*(3*4+3*4+4+2)+4),this._hit=new ni(t.scene,this._rayHit),this._callbacks={}}rayCast(t,e,n,s=100){const o=this._engine.scene._index;return this._engine.wasm._wl_physx_ray_cast(o,t[0],t[1],t[2],e[0],e[1],e[2],n,s,this._rayHit),this._hit}get engine(){return this._engine}}var le;(function(i){i[i.UnsignedByte=1]="UnsignedByte",i[i.UnsignedShort=2]="UnsignedShort",i[i.UnsignedInt=4]="UnsignedInt"})(le||(le={}));var tn;(function(i){i[i.None=0]="None",i[i.FourJoints=1]="FourJoints",i[i.EightJoints=2]="EightJoints"})(tn||(tn={}));class xt extends at{constructor(t,e){if(!wr(e)){const n=t.meshes.create(e);return super(t,n._index),n}super(t,e)}get vertexCount(){return this.engine.wasm._wl_mesh_get_vertexCount(this._id)}get indexData(){const t=this.engine.wasm,e=t._tempMem,n=t._wl_mesh_get_indexData(this._id,e,e+4);if(n===null)return null;const s=t.HEAPU32[e/4];switch(t.HEAPU32[e/4+1]){case le.UnsignedByte:return new Uint8Array(t.HEAPU8.buffer,n,s);case le.UnsignedShort:return new Uint16Array(t.HEAPU16.buffer,n,s);case le.UnsignedInt:return new Uint32Array(t.HEAPU32.buffer,n,s)}return null}update(){this.engine.wasm._wl_mesh_update(this._id)}getBoundingSphere(t=new Float32Array(4)){const e=this.engine.wasm;return this.engine.wasm._wl_mesh_get_boundingSphere(this._id,e._tempMem),t[0]=e._tempMemFloat[0],t[1]=e._tempMemFloat[1],t[2]=e._tempMemFloat[2],t[3]=e._tempMemFloat[3],t}attribute(t){if(typeof t!="number")throw new TypeError("Expected number, but got "+typeof t);const e=this.engine.wasm,n=e._tempMemUint32;if(e._wl_mesh_get_attribute(this._id,t,e._tempMem),n[0]==255)return null;const s=n[5];return new gs(this.engine,{attribute:n[0],offset:n[1],stride:n[2],formatSize:n[3],componentCount:n[4],arraySize:s||1,length:this.vertexCount,bufferType:t!==me.JointId?Float32Array:Uint16Array})}destroy(){this.engine.wasm._wl_mesh_destroy(this._id),this.engine.meshes._destroy(this)}toString(){return this.isDestroyed?"Mesh(destroyed)":`Mesh(${this._index})`}}class gs{constructor(t,e){u(this,"length",0);u(this,"_engine");u(this,"_attribute",-1);u(this,"_offset",0);u(this,"_stride",0);u(this,"_formatSize",0);u(this,"_componentCount",0);u(this,"_arraySize",1);u(this,"_bufferType");u(this,"_tempBufferGetter");this._engine=t;const n=this._engine.wasm;this._attribute=e.attribute,this._offset=e.offset,this._stride=e.stride,this._formatSize=e.formatSize,this._componentCount=e.componentCount,this._arraySize=e.arraySize,this._bufferType=e.bufferType,this.length=e.length,this._tempBufferGetter=this._bufferType===Float32Array?n.getTempBufferF32.bind(n):n.getTempBufferU16.bind(n)}createArray(t=1){return t=t>this.length?this.length:t,new this._bufferType(t*this._componentCount*this._arraySize)}get(t,e=this.createArray()){if(e.length%this._componentCount!==0)throw new Error(`out.length, ${e.length} is not a multiple of the attribute vector components, ${this._componentCount}`);const n=this._tempBufferGetter(e.length),s=this._bufferType.BYTES_PER_ELEMENT,o=s*e.length,a=this._formatSize*this._arraySize,c=this._componentCount*s*this._arraySize;this._engine.wasm._wl_mesh_get_attribute_values(this._attribute,a,this._offset+t*this._stride,this._stride,c,n.byteOffset,o);for(let _=0;_<e.length;++_)e[_]=n[_];return e}set(t,e){if(e.length%this._componentCount!==0)throw new Error(`out.length, ${e.length} is not a multiple of the attribute vector components, ${this._componentCount}`);const n=this._bufferType.BYTES_PER_ELEMENT,s=n*e.length,o=this._componentCount*n*this._arraySize,a=this._formatSize*this._arraySize,c=this._engine.wasm;if(e.buffer!=c.HEAPU8.buffer){const _=this._tempBufferGetter(e.length);_.set(e),e=_}return c._wl_mesh_set_attribute_values(this._attribute,o,e.byteOffset,s,a,this._offset+t*this._stride,this._stride),this}get engine(){return this._engine}}class ws extends at{get emHeight(){return this.engine.wasm._wl_font_get_emHeight(this._id)}get capHeight(){return this.engine.wasm._wl_font_get_capHeight(this._id)}get xHeight(){return this.engine.wasm._wl_font_get_xHeight(this._id)}}let Ge=null;class nn extends at{constructor(t,e){if(yr(e)){const n=t.textures.create(e);return super(t,n._index),n}super(t,e)}get valid(){return!this.isDestroyed}get id(){return this.index}update(){const t=this._imageIndex;!this.valid||!t||this.engine.wasm._wl_renderer_updateImage(t)}get width(){const t=this.htmlElement;if(t)return t.width;const e=this.engine.wasm;return e._wl_image_size(this._imageIndex,e._tempMem),e._tempMemUint32[0]}get height(){const t=this.htmlElement;if(t)return t.height;const e=this.engine.wasm;return e._wl_image_size(this._imageIndex,e._tempMem),e._tempMemUint32[1]}get htmlElement(){const t=this._imageIndex;if(!t)return null;const e=this.engine.wasm,n=e._wl_image_get_jsImage_index(t);return e._images[n]}updateSubImage(t,e,n,s){if(this.isDestroyed)return;const o=this._imageIndex;if(!o)return;const a=this.engine.wasm,c=a._wl_image_get_jsImage_index(o);if(!Ge){const p=document.createElement("canvas"),r=p.getContext("2d");if(!r)throw new Error("Texture.updateSubImage(): Failed to obtain CanvasRenderingContext2D.");Ge={canvas:p,ctx:r}}const _=a._images[c];if(!_)return;Ge.canvas.width=n,Ge.canvas.height=s,Ge.ctx.drawImage(_,t,e,n,s,0,0,n,s);const d=(_.videoHeight??_.height)-e-s;a._images[c]=Ge.canvas,a._wl_renderer_updateImage(o,t,d),a._images[c]=_}destroy(){this.engine.wasm._wl_texture_destroy(this._id),this.engine.textures._destroy(this)}toString(){return this.isDestroyed?"Texture(destroyed)":`Texture(${this._index})`}get _imageIndex(){return this.engine.wasm._wl_texture_get_image_index(this._id)}}class ys extends Ct{constructor(t=WL,e){const n=t instanceof ze?t:t.scene;super(n,e)}get duration(){return this.engine.wasm._wl_animation_get_duration(this._id)}get trackCount(){return this.engine.wasm._wl_animation_get_trackCount(this._id)}retarget(t){const e=this.engine.wasm;if(t instanceof ti){const o=e._wl_animation_retargetToSkin(this._id,t._id);return this._scene.animations.wrap(o)}if(t.length!=this.trackCount)throw Error("Expected "+this.trackCount.toString()+" targets, but got "+t.length.toString());const n=e._malloc(2*t.length);for(let o=0;o<t.length;++o){const a=t[o];this.scene.assertOrigin(a),e.HEAPU16[n>>1+o]=t[o].objectId}const s=e._wl_animation_retarget(this._id,n);return e._free(n),this._scene.animations.wrap(s)}toString(){return this.isDestroyed?"Animation(destroyed)":`Animation(${this._index})`}}class Vn{constructor(t,e){u(this,"_id",-1);u(this,"_localId",-1);u(this,"_scene");u(this,"_engine");t=t instanceof ze?t:t.scene,this._localId=e,this._id=t._index<<22|e,this._scene=t,this._engine=t.engine}get name(){const t=this._engine.wasm;return t.UTF8ToString(t._wl_object_name(this._id))}set name(t){const e=this._engine.wasm;e._wl_object_set_name(this._id,e.tempUTF8(t))}get parent(){const t=this._engine.wasm._wl_object_parent(this._id);return t===0?null:this._scene.wrap(t)}get children(){return this.getChildren()}get childrenCount(){return this._engine.wasm._wl_object_get_children_count(this._id)}set parent(t){this.scene.assertOrigin(t),this._engine.wasm._wl_object_set_parent(this._id,t==null?0:t._id)}get objectId(){return this._localId}get scene(){return this._scene}get engine(){return this._engine}clone(t=null){this.scene.assertOrigin(t);const n=this._engine.wasm._wl_object_clone(this._id,t?t._id:0);return this._scene.wrap(n)}getChildren(t=new Array(this.childrenCount)){const e=this.childrenCount;if(e===0)return t;const n=this._engine.wasm;n.requireTempMem(e*2),this._engine.wasm._wl_object_get_children(this._id,n._tempMem,n._tempMemSize>>1);for(let s=0;s<e;++s)t[s]=this._scene.wrap(n._tempMemUint16[s]);return t}resetTransform(){return this._engine.wasm._wl_object_reset_translation_rotation(this._id),this._engine.wasm._wl_object_reset_scaling(this._id),this}resetPositionRotation(){return this._engine.wasm._wl_object_reset_translation_rotation(this._id),this}resetTranslationRotation(){return this.resetPositionRotation()}resetRotation(){return this._engine.wasm._wl_object_reset_rotation(this._id),this}resetPosition(){return this._engine.wasm._wl_object_reset_translation(this._id),this}resetTranslation(){return this.resetPosition()}resetScaling(){return this._engine.wasm._wl_object_reset_scaling(this._id),this}translate(t){return this.translateLocal(t)}translateLocal(t){return this._engine.wasm._wl_object_translate(this._id,t[0],t[1],t[2]),this}translateObject(t){return this._engine.wasm._wl_object_translate_obj(this._id,t[0],t[1],t[2]),this}translateWorld(t){return this._engine.wasm._wl_object_translate_world(this._id,t[0],t[1],t[2]),this}rotateAxisAngleDeg(t,e){return this.rotateAxisAngleDegLocal(t,e),this}rotateAxisAngleDegLocal(t,e){return this._engine.wasm._wl_object_rotate_axis_angle(this._id,t[0],t[1],t[2],e),this}rotateAxisAngleRad(t,e){return this.rotateAxisAngleRadLocal(t,e)}rotateAxisAngleRadLocal(t,e){return this._engine.wasm._wl_object_rotate_axis_angle_rad(this._id,t[0],t[1],t[2],e),this}rotateAxisAngleDegObject(t,e){return this._engine.wasm._wl_object_rotate_axis_angle_obj(this._id,t[0],t[1],t[2],e),this}rotateAxisAngleRadObject(t,e){return this._engine.wasm._wl_object_rotate_axis_angle_rad_obj(this._id,t[0],t[1],t[2],e),this}rotate(t){return this.rotateLocal(t),this}rotateLocal(t){return this._engine.wasm._wl_object_rotate_quat(this._id,t[0],t[1],t[2],t[3]),this}rotateObject(t){return this._engine.wasm._wl_object_rotate_quat_obj(this._id,t[0],t[1],t[2],t[3]),this}scale(t){return this.scaleLocal(t),this}scaleLocal(t){return this._engine.wasm._wl_object_scale(this._id,t[0],t[1],t[2]),this}getPositionLocal(t=new Float32Array(3)){const e=this._engine.wasm;return e._wl_object_get_translation_local(this._id,e._tempMem),t[0]=e._tempMemFloat[0],t[1]=e._tempMemFloat[1],t[2]=e._tempMemFloat[2],t}getTranslationLocal(t=new Float32Array(3)){return this.getPositionLocal(t)}getPositionWorld(t=new Float32Array(3)){const e=this._engine.wasm;return e._wl_object_get_translation_world(this._id,e._tempMem),t[0]=e._tempMemFloat[0],t[1]=e._tempMemFloat[1],t[2]=e._tempMemFloat[2],t}getTranslationWorld(t=new Float32Array(3)){return this.getPositionWorld(t)}setPositionLocal(t){return this._engine.wasm._wl_object_set_translation_local(this._id,t[0],t[1],t[2]),this}setTranslationLocal(t){return this.setPositionLocal(t)}setPositionWorld(t){return this._engine.wasm._wl_object_set_translation_world(this._id,t[0],t[1],t[2]),this}setTranslationWorld(t){return this.setPositionWorld(t)}getScalingLocal(t=new Float32Array(3)){const e=this._engine.wasm,n=e._wl_object_scaling_local(this._id)/4;return t[0]=e.HEAPF32[n],t[1]=e.HEAPF32[n+1],t[2]=e.HEAPF32[n+2],t}setScalingLocal(t){return this._engine.wasm._wl_object_set_scaling_local(this._id,t[0],t[1],t[2]),this}getScalingWorld(t=new Float32Array(3)){const e=this._engine.wasm,n=e._wl_object_scaling_world(this._id)/4;return t[0]=e.HEAPF32[n],t[1]=e.HEAPF32[n+1],t[2]=e.HEAPF32[n+2],t}setScalingWorld(t){return this._engine.wasm._wl_object_set_scaling_world(this._id,t[0],t[1],t[2]),this}getRotationLocal(t=new Float32Array(4)){const e=this._engine.wasm,n=e._wl_object_trans_local(this._id)/4;return t[0]=e.HEAPF32[n],t[1]=e.HEAPF32[n+1],t[2]=e.HEAPF32[n+2],t[3]=e.HEAPF32[n+3],t}setRotationLocal(t){return this._engine.wasm._wl_object_set_rotation_local(this._id,t[0],t[1],t[2],t[3]),this}getRotationWorld(t=new Float32Array(4)){const e=this._engine.wasm,n=e._wl_object_trans_world(this._id)/4;return t[0]=e.HEAPF32[n],t[1]=e.HEAPF32[n+1],t[2]=e.HEAPF32[n+2],t[3]=e.HEAPF32[n+3],t}setRotationWorld(t){return this._engine.wasm._wl_object_set_rotation_world(this._id,t[0],t[1],t[2],t[3]),this}getTransformLocal(t=new Float32Array(8)){const e=this._engine.wasm,n=e._wl_object_trans_local(this._id)/4;return t[0]=e.HEAPF32[n],t[1]=e.HEAPF32[n+1],t[2]=e.HEAPF32[n+2],t[3]=e.HEAPF32[n+3],t[4]=e.HEAPF32[n+4],t[5]=e.HEAPF32[n+5],t[6]=e.HEAPF32[n+6],t[7]=e.HEAPF32[n+7],t}setTransformLocal(t){const e=this._engine.wasm,n=e._wl_object_trans_local(this._id)/4;return e.HEAPF32[n]=t[0],e.HEAPF32[n+1]=t[1],e.HEAPF32[n+2]=t[2],e.HEAPF32[n+3]=t[3],e.HEAPF32[n+4]=t[4],e.HEAPF32[n+5]=t[5],e.HEAPF32[n+6]=t[6],e.HEAPF32[n+7]=t[7],this.setDirty(),this}getTransformWorld(t=new Float32Array(8)){const e=this._engine.wasm,n=e._wl_object_trans_world(this._id)/4;return t[0]=e.HEAPF32[n],t[1]=e.HEAPF32[n+1],t[2]=e.HEAPF32[n+2],t[3]=e.HEAPF32[n+3],t[4]=e.HEAPF32[n+4],t[5]=e.HEAPF32[n+5],t[6]=e.HEAPF32[n+6],t[7]=e.HEAPF32[n+7],t}setTransformWorld(t){const e=this._engine.wasm,n=e._wl_object_trans_world(this._id)/4;return e.HEAPF32[n]=t[0],e.HEAPF32[n+1]=t[1],e.HEAPF32[n+2]=t[2],e.HEAPF32[n+3]=t[3],e.HEAPF32[n+4]=t[4],e.HEAPF32[n+5]=t[5],e.HEAPF32[n+6]=t[6],e.HEAPF32[n+7]=t[7],this._engine.wasm._wl_object_trans_world_to_local(this._id),this}get transformLocal(){const t=this._engine.wasm;return new Float32Array(t.HEAPF32.buffer,t._wl_object_trans_local(this._id),8)}set transformLocal(t){this.transformLocal.set(t),this.setDirty()}get transformWorld(){const t=this._engine.wasm;return new Float32Array(t.HEAPF32.buffer,t._wl_object_trans_world(this._id),8)}set transformWorld(t){this.transformWorld.set(t),this._engine.wasm._wl_object_trans_world_to_local(this._id)}get scalingLocal(){const t=this._engine.wasm;return new Float32Array(t.HEAPF32.buffer,t._wl_object_scaling_local(this._id),3)}set scalingLocal(t){this.scalingLocal.set(t),this.setDirty()}get scalingWorld(){const t=this._engine.wasm;return new Float32Array(t.HEAPF32.buffer,t._wl_object_scaling_world(this._id),3)}set scalingWorld(t){this.scalingWorld.set(t),this._engine.wasm._wl_object_scaling_world_to_local(this._id)}get rotationLocal(){return this.transformLocal.subarray(0,4)}get rotationWorld(){return this.transformWorld.subarray(0,4)}set rotationLocal(t){this._engine.wasm._wl_object_set_rotation_local(this._id,t[0],t[1],t[2],t[3])}set rotationWorld(t){this._engine.wasm._wl_object_set_rotation_world(this._id,t[0],t[1],t[2],t[3])}getForward(t){return this.getForwardWorld(t)}getForwardWorld(t){return t[0]=0,t[1]=0,t[2]=-1,this.transformVectorWorld(t),t}getUp(t){return this.getUpWorld(t)}getUpWorld(t){return t[0]=0,t[1]=1,t[2]=0,this.transformVectorWorld(t),t}getRight(t){return this.getRightWorld(t)}getRightWorld(t){return t[0]=1,t[1]=0,t[2]=0,this.transformVectorWorld(t),t}transformVectorWorld(t,e=t){const n=this._engine.wasm;return n._tempMemFloat[0]=e[0],n._tempMemFloat[1]=e[1],n._tempMemFloat[2]=e[2],n._wl_object_transformVectorWorld(this._id,n._tempMem),t[0]=n._tempMemFloat[0],t[1]=n._tempMemFloat[1],t[2]=n._tempMemFloat[2],t}transformVectorLocal(t,e=t){const n=this._engine.wasm;return n._tempMemFloat[0]=e[0],n._tempMemFloat[1]=e[1],n._tempMemFloat[2]=e[2],n._wl_object_transformVectorLocal(this._id,n._tempMem),t[0]=n._tempMemFloat[0],t[1]=n._tempMemFloat[1],t[2]=n._tempMemFloat[2],t}transformPointWorld(t,e=t){const n=this._engine.wasm;return n._tempMemFloat[0]=e[0],n._tempMemFloat[1]=e[1],n._tempMemFloat[2]=e[2],n._wl_object_transformPointWorld(this._id,n._tempMem),t[0]=n._tempMemFloat[0],t[1]=n._tempMemFloat[1],t[2]=n._tempMemFloat[2],t}transformPointLocal(t,e=t){const n=this._engine.wasm;return n._tempMemFloat[0]=e[0],n._tempMemFloat[1]=e[1],n._tempMemFloat[2]=e[2],n._wl_object_transformPointLocal(this._id,n._tempMem),t[0]=n._tempMemFloat[0],t[1]=n._tempMemFloat[1],t[2]=n._tempMemFloat[2],t}transformVectorInverseWorld(t,e=t){const n=this._engine.wasm;return n._tempMemFloat[0]=e[0],n._tempMemFloat[1]=e[1],n._tempMemFloat[2]=e[2],n._wl_object_transformVectorInverseWorld(this._id,n._tempMem),t[0]=n._tempMemFloat[0],t[1]=n._tempMemFloat[1],t[2]=n._tempMemFloat[2],t}transformVectorInverseLocal(t,e=t){const n=this._engine.wasm;return n._tempMemFloat[0]=e[0],n._tempMemFloat[1]=e[1],n._tempMemFloat[2]=e[2],n._wl_object_transformVectorInverseLocal(this._id,n._tempMem),t[0]=n._tempMemFloat[0],t[1]=n._tempMemFloat[1],t[2]=n._tempMemFloat[2],t}transformPointInverseWorld(t,e=t){const n=this._engine.wasm;return n._tempMemFloat[0]=e[0],n._tempMemFloat[1]=e[1],n._tempMemFloat[2]=e[2],n._wl_object_transformPointInverseWorld(this._id,n._tempMem),t[0]=n._tempMemFloat[0],t[1]=n._tempMemFloat[1],t[2]=n._tempMemFloat[2],t}transformPointInverseLocal(t,e=t){const n=this._engine.wasm;return n._tempMemFloat.set(e),n._wl_object_transformPointInverseLocal(this._id,n._tempMem),t[0]=n._tempMemFloat[0],t[1]=n._tempMemFloat[1],t[2]=n._tempMemFloat[2],t}toWorldSpaceTransform(t,e=t){const n=this._engine.wasm;return n._tempMemFloat.set(e),n._wl_object_toWorldSpaceTransform(this._id,n._tempMem),t[0]=n._tempMemFloat[0],t[1]=n._tempMemFloat[1],t[2]=n._tempMemFloat[2],t[3]=n._tempMemFloat[3],t[4]=n._tempMemFloat[4],t[5]=n._tempMemFloat[5],t[6]=n._tempMemFloat[6],t[7]=n._tempMemFloat[7],t}toLocalSpaceTransform(t,e=t){const n=this.parent;return n?(n.toObjectSpaceTransform(t,e),t):(t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7]),t)}toObjectSpaceTransform(t,e=t){const n=this._engine.wasm;return n._tempMemFloat.set(e),n._wl_object_toObjectSpaceTransform(this._id,n._tempMem),t[0]=n._tempMemFloat[0],t[1]=n._tempMemFloat[1],t[2]=n._tempMemFloat[2],t[3]=n._tempMemFloat[3],t[4]=n._tempMemFloat[4],t[5]=n._tempMemFloat[5],t[6]=n._tempMemFloat[6],t[7]=n._tempMemFloat[7],t}lookAt(t,e=Pr){return this._engine.wasm._wl_object_lookAt(this._id,t[0],t[1],t[2],e[0],e[1],e[2]),this}destroy(){this._id<0||this.engine.wasm._wl_object_remove(this._id)}setDirty(){this._engine.wasm._wl_object_set_dirty(this._id)}set active(t){const e=this.getComponents();for(let n of e)n.active=t}getComponent(t,e=0){const n=this._engine.wasm,s=fe(t)?t:t.TypeName,o=this._scene,a=n._wl_scene_get_component_manager_index(o._index,n.tempUTF8(s));if(a<0){const _=n._componentTypeIndices[s];if(_===void 0)return null;const d=n._wl_get_js_component_index(this._id,_,e);if(d<0)return null;const p=this._scene._jsComponents[d];return p.constructor!==Ae?p:null}const c=n._wl_get_component_id(this._id,a,e);return o._components.wrapNative(a,c)}getComponents(t){const e=this._engine.wasm,n=this._scene;let s=null,o=null;if(t){o=fe(t)?t:t.TypeName;const p=n._components.getNativeManager(o);s=p!==null?p:n._components.js}const a=[],c=Math.floor(e._tempMemSize/3*2),_=e._wl_object_get_components(this._id,e._tempMem,c),d=2*_;e._wl_object_get_component_types(this._id,e._tempMem+d,c);for(let p=0;p<_;++p){const r=e._tempMemUint8[p+d],l=e._tempMemUint16[p];if(s!==null&&r!==s)continue;const h=this._scene._components.wrapAny(r,l);h&&(o&&o!==h.constructor.TypeName||a.push(h))}return a}addComponent(t,e){const n=this._engine.wasm,s=fe(t)?t:t.TypeName,o=this._scene._components.getNativeManager(s),a=o!==null,c=a?o:this._scene._components.js;let _=-1;if(a)_=n._wl_object_add_component(this._id,c);else{if(!(s in n._componentTypeIndices))throw new TypeError("Unknown component type '"+s+"'");_=n._wl_object_add_js_component(this._id,n._componentTypeIndices[s])}const d=this._scene._components.wrapAny(c,_);return e!==void 0&&d.copy(e),a||d._triggerInit(),(!e||!("active"in e&&!e.active))&&(d.active=!0),d}findByName(t,e=!1){return e?this.findByNameRecursive(t):this.findByNameDirect(t)}findByNameDirect(t){const e=this._engine.wasm,n=this._id,o=(e._tempMemSize>>2)-2,a=e._tempMemUint16;a[o]=0,a[o+1]=0;const c=e._tempMem,_=c+o*2,d=c+o*2+2,p=e.tempUTF8(t,(o+2)*2),r=[];let l=0;for(;l=e._wl_object_findByName(n,p,_,d,c,o);)for(let h=0;h<l;++h)r.push(this._scene.wrap(a[h]));return r}findByNameRecursive(t){const e=this._engine.wasm,n=this._id,o=(e._tempMemSize>>2)-1,a=e._tempMemUint16;a[o]=0;const c=e._tempMem,_=c+o*2,d=e.tempUTF8(t,(o+1)*2);let p=0;const r=[];for(;p=e._wl_object_findByNameRecursive(n,d,_,c,o);)for(let l=0;l<p;++l)r.push(this._scene.wrap(a[l]));return r}get changed(){return!!this._engine.wasm._wl_object_is_changed(this._id)}get isDestroyed(){return this._id<0}equals(t){return t?this._id==t._id:!1}toString(){return this.isDestroyed?"Object3D(destroyed)":`Object3D('${this.name}', ${this._localId})`}}class ti extends Ct{get jointCount(){return this.engine.wasm._wl_skin_get_joint_count(this._id)}get jointIds(){const t=this.engine.wasm;return new Uint16Array(t.HEAPU16.buffer,t._wl_skin_joint_ids(this._id),this.jointCount)}get inverseBindTransforms(){const t=this.engine.wasm;return new Float32Array(t.HEAPF32.buffer,t._wl_skin_inverse_bind_transforms(this._id),8*this.jointCount)}get inverseBindScalings(){const t=this.engine.wasm;return new Float32Array(t.HEAPF32.buffer,t._wl_skin_inverse_bind_scalings(this._id),3*this.jointCount)}}class vs extends at{get count(){return this.engine.wasm._wl_morph_targets_get_target_count(this._id)}getTargetName(t){if(t>=this.count)throw new Error(`Index ${t} is out of bounds for ${this.count} targets`);const e=this.engine.wasm;return e.UTF8ToString(e._wl_morph_targets_get_target_name(this._id,t))}getTargetIndex(t){const e=this.engine.wasm,n=e._wl_morph_targets_get_target_index(this._id,e.tempUTF8(t));if(n===-1)throw Error(`Missing target '${t}'`);return n}}class ni{constructor(t,e){u(this,"_scene");u(this,"_ptr");if(e&3)throw new Error("Misaligned pointer: please report a bug");this._scene=t,this._ptr=e}getLocations(t){t=t??Array.from({length:this.hitCount},()=>new Float32Array(3));const e=this.engine.wasm,n=this._ptr/4;for(let s=0;s<this.hitCount;++s){const o=n+3*s;t[s][0]=e.HEAPF32[o],t[s][1]=e.HEAPF32[o+1],t[s][2]=e.HEAPF32[o+2]}return t}getNormals(t){t=t??Array.from({length:this.hitCount},()=>new Float32Array(3));const e=this.engine.wasm,n=(this._ptr+48)/4;for(let s=0;s<this.hitCount;++s){const o=n+3*s;t[s][0]=e.HEAPF32[o],t[s][1]=e.HEAPF32[o+1],t[s][2]=e.HEAPF32[o+2]}return t}getDistances(t=new Float32Array(this.hitCount)){const e=this.engine.wasm,n=(this._ptr+48*2)/4;for(let s=0;s<this.hitCount;++s){const o=n+s;t[s]=e.HEAPF32[o]}return t}getObjects(t=new Array(this.hitCount)){const e=this.engine.wasm.HEAPU16,n=this._ptr+(48*2+16)>>1;for(let s=0;s<this.hitCount;++s)t[s]=this._scene.wrap(e[n+s]);return t}get engine(){return this._scene.engine}get locations(){return this.getLocations()}get normals(){return this.getNormals()}get distances(){return this.getDistances()}get objects(){const t=[null,null,null,null];return this.getObjects(t)}get hitCount(){return Math.min(this.engine.wasm.HEAPU32[this._ptr/4+30],4)}}class Cr{static cubicHermite(t,e,n,s,o,a,c=WL){const _=c.wasm;_._tempMemFloat.subarray(0).set(e),_._tempMemFloat.subarray(4).set(n),_._tempMemFloat.subarray(8).set(s),_._tempMemFloat.subarray(12).set(o);const d=e.length==4;return _._wl_math_cubicHermite(_._tempMem+4*16,_._tempMem+4*0,_._tempMem+4*4,_._tempMem+4*8,_._tempMem+4*12,a,d),t[0]=_._tempMemFloat[16],t[1]=_._tempMemFloat[17],t[2]=_._tempMemFloat[18],d&&(t[3]=_._tempMemFloat[19]),t}}class bs{constructor(t){u(this,"onLanguageChanged",new H);u(this,"_engine");u(this,"_prevLanguageIndex",-1);this._engine=t}set language(t){this.setLanguage(t)}get language(){const t=this._engine.wasm,e=t._wl_i18n_currentLanguage();return e===0?null:t.UTF8ToString(e)}get currentIndex(){return this._engine.wasm._wl_i18n_currentLanguageIndex()}get previousIndex(){return this._prevLanguageIndex}async setLanguage(t){if(t==null)return Promise.resolve(this.currentIndex);const e=this._engine.wasm;this._prevLanguageIndex=this.currentIndex,e._wl_i18n_setLanguage(e.tempUTF8(t));const n=this.engine.scene,s=e.UTF8ToString(e._wl_i18n_languageFile(this.currentIndex)),o=`${n.baseURL}/locale/${s}`;return await n._downloadDependency(o),this.onLanguageChanged.notify(this._prevLanguageIndex,this.currentIndex),this.currentIndex}translate(t){const e=this._engine.wasm,n=e._wl_i18n_translate(e.tempUTF8(t));return n===0?null:e.UTF8ToString(n)}languageCount(){return this._engine.wasm._wl_i18n_languageCount()}languageIndex(t){const e=this._engine.wasm;return e._wl_i18n_languageIndex(e.tempUTF8(t))}languageCode(t){const e=this._engine.wasm,n=e._wl_i18n_languageCode(t);return n===0?null:e.UTF8ToString(n)}languageName(t){const e=this._engine.wasm,n=e._wl_i18n_languageName(t);return n===0?null:e.UTF8ToString(n)}get engine(){return this._engine}}var X,Mt;class xs{constructor(t,e){G(this,X,void 0);G(this,Mt,void 0);pe(this,X,t),pe(this,Mt,e)}get sessionMode(){return E(this,Mt)}get session(){return E(this,X).webxr_session}get frame(){return E(this,X).webxr_frame}referenceSpaceForType(t){return E(this,X).webxr_refSpaces[t]??null}set currentReferenceSpace(t){E(this,X).webxr_refSpace=t,E(this,X).webxr_refSpaceType=null;for(const e of Object.keys(E(this,X).webxr_refSpaces))E(this,X).webxr_refSpaces[e]===t&&(E(this,X).webxr_refSpaceType=e)}get currentReferenceSpace(){return E(this,X).webxr_refSpace}get currentReferenceSpaceType(){return E(this,X).webxr_refSpaceType}get baseLayer(){return E(this,X).webxr_baseLayer}get framebuffers(){return Array.isArray(E(this,X).webxr_fbo)?E(this,X).webxr_fbo.map(t=>E(this,X).GL.framebuffers[t]):[E(this,X).GL.framebuffers[E(this,X).webxr_fbo]]}}X=new WeakMap,Mt=new WeakMap;var be;(function(i){i[i.UnsignedInt=0]="UnsignedInt",i[i.Int=1]="Int",i[i.HalfFloat=2]="HalfFloat",i[i.Float=3]="Float",i[i.Sampler=4]="Sampler",i[i.Font=5]="Font"})(be||(be={}));class sn extends at{constructor(t,e){if(typeof e!="number"){if(!(e!=null&&e.pipeline))throw new Error("Missing parameter 'pipeline'");const n=t.materials.getTemplate(e.pipeline),s=new n;return super(t,s._index),s}super(t,e)}hasParameter(t){const e=this.constructor.Parameters;return e&&e.has(t)}get shader(){return this.pipeline}get pipeline(){const t=this.engine.wasm;return t.UTF8ToString(t._wl_material_get_pipeline(this._id))}clone(){const t=this.engine.wasm._wl_material_clone(this._id);return this.engine.materials.wrap(t)}toString(){return this.isDestroyed?"Material(destroyed)":`Material('${this.pipeline}', ${this._index})`}static wrap(t,e){return t.materials.wrap(e)}}u(sn,"_destroyedPrototype",gn("material"));class As extends Le{constructor(e){super(e,sn);u(this,"_materialTemplates",[]);this._cacheDefinitions()}wrap(e){if(e<=0)return null;const n=this._cache[e];if(n)return n;const o=this.engine.wasm._wl_material_get_definition(e),a=this._materialTemplates[o],c=new a(e);return this._wrapInstance(c)}getTemplate(e){const n=this.engine.wasm,s=n._wl_get_material_definition_index(n.tempUTF8(e));if(!s)throw new Error(`Pipeline '${e}' doesn't exist in the scene`);return this._materialTemplates[s]}_wrapInstance(e){if(this._cache[e.index]=e,!this.engine.legacyMaterialSupport)return e;const n=new Proxy(e,{get(s,o){if(!s.hasParameter(o))return s[o];const a=`get${Sn(o)}`;return s[a]()},set(s,o,a){if(!s.hasParameter(o))return s[o]=a,!0;const c=`set${Sn(o)}`;return s[c](a),!0}});return this._cache[e.index]=n,n}_cacheDefinitions(){const n=this.engine.wasm._wl_get_material_definition_count();for(let s=0;s<n;++s)this._materialTemplates[s]=this._createMaterialTemplate(s)}_createMaterialTemplate(e){var c;const n=this.engine,s=(c=class extends sn{constructor(d){return d=d??n.wasm._wl_material_create(e),super(n,d),n.materials._wrapInstance(this)}},u(c,"Parameters",new Set),c),o=this.engine.wasm,a=o._wl_material_definition_get_param_count(e);for(let _=0;_<a;++_){const d=o.UTF8ToString(o._wl_material_definition_get_param_name(e,_));s.Parameters.add(d);const p=o._wl_material_definition_get_param_type(e,_),r=p&255,l=p>>8&255,h=Sn(d),f=`get${h}`,w=`set${h}`,m=s.prototype;switch(r){case be.UnsignedInt:m[f]=Er(_,l),m[w]=vi(_);break;case be.Int:m[f]=jr(_,l),m[w]=vi(_);break;case be.HalfFloat:case be.Float:m[f]=Rr(_,l),m[w]=kr(_);break;case be.Sampler:m[f]=Lr(_),m[w]=Or(_);break;case be.Font:m[f]=Ir(_);break}}return s}}function Er(i,t){return t===1?function(){const e=this.engine.wasm;return e._wl_material_get_param_value(this._id,i,e._tempMem),e._tempMemUint32[0]}:function(e=new Uint32Array(t)){const n=this.engine.wasm;n._wl_material_get_param_value(this._id,i,n._tempMem);for(let s=0;s<e.length;++s)e[s]=n._tempMemUint32[s];return e}}function vi(i){return function(t){this.engine.wasm._wl_material_set_param_value_uint(this._id,i,t)}}function jr(i,t){return t===1?function(){const e=this.engine.wasm;return e._wl_material_get_param_value(this._id,i,e._tempMem),e._tempMemInt[0]}:function(e=new Int32Array(t)){const n=this.engine.wasm;n._wl_material_get_param_value(this._id,i,n._tempMem);for(let s=0;s<e.length;++s)e[s]=n._tempMemInt[s];return e}}function Rr(i,t){return t===1?function(){const e=this.engine.wasm;return e._wl_material_get_param_value(this._id,i,e._tempMem),e._tempMemFloat[0]}:function(e=new Float32Array(t)){const n=this.engine.wasm;n._wl_material_get_param_value(this._id,i,n._tempMem);for(let s=0;s<e.length;++s)e[s]=n._tempMemFloat[s];return e}}function kr(i){return function(t){const e=this.engine.wasm;let n=1;if(typeof t=="number")e._tempMemFloat[0]=t;else{n=t.length;for(let s=0;s<n;++s)e._tempMemFloat[s]=t[s]}e._wl_material_set_param_value_float(this._id,i,e._tempMem,n)}}function Lr(i){return function(){const t=this.engine.wasm;return t._wl_material_get_param_value(this._id,i,t._tempMem),this.engine.textures.wrap(t._tempMemInt[0])}}function Or(i){return function(t){this.engine.wasm._wl_material_set_param_value_uint(this._id,i,t._id)}}function Ir(i){return function(){const t=this.engine.wasm;return t._wl_material_get_param_value(this._id,i,t._tempMem),this.engine.fonts.wrap(t._tempMemInt[0])}}class Ss extends Le{constructor(t){super(t,xt)}create(t){if(!t.vertexCount)throw new Error("Missing parameter 'vertexCount'");const e=this.engine.wasm;let n=0,s=0,o=0;if(t.indexData)switch(s=t.indexType||le.UnsignedShort,o=t.indexData.length*s,n=e._malloc(o),s){case le.UnsignedByte:e.HEAPU8.set(t.indexData,n);break;case le.UnsignedShort:e.HEAPU16.set(t.indexData,n>>1);break;case le.UnsignedInt:e.HEAPU32.set(t.indexData,n>>2);break}const{skinningType:a=tn.None}=t,c=e._wl_mesh_create(n,o,s,t.vertexCount,a),_=new xt(this._host,c);return this._cache[_.index]=_,_}}class Ts extends Le{constructor(t){super(t,nn)}create(t){const e=this.engine.wasm,n=e._images.length;if(e._images.push(t),t instanceof HTMLImageElement&&!t.complete)throw new Error("image must be ready to create a texture");const s=t.videoWidth??t.width,o=t.videoHeight??t.height,a=e._wl_image_create(n,s,o),c=e._wl_texture_create(a),_=new nn(this.engine,c);return this._cache[_.index]=_,_}load(t,e){let n=new Image;return n.crossOrigin=e??n.crossOrigin,n.src=t,new Promise((s,o)=>{n.onload=()=>{s(this.create(n))},n.onerror=function(){o("Failed to load image. Not found or no read access")}})}}class Ms{constructor(t){u(this,"objectCount");u(this,"root",{});u(this,"mesh",{});u(this,"node",{});this.objectCount=t}}class rn extends ze{constructor(e,n){super(e,n);u(this,"extensions",null);this.extensions=this._readExtensions()}_processInstantiaton(e,n,s){if(!this.extensions)return null;const o=this.engine.wasm,a=this.extensions.objectCount,c=new Array(a),_=o._wl_object_index(n._id);for(let p=0;p<a;++p){const r=o._wl_glTF_scene_extensions_gltfIndex_to_id(this._index,e._index,_,p);c[p]=r}const d={mesh:{},node:{},idMapping:c};for(const p in this.extensions.mesh){const r=c[p];d.mesh[r]=this.extensions.mesh[p]}for(const p in this.extensions.node){const r=c[p];d.node[r]=this.extensions.node[p]}s.extensions=d}_readExtensions(){const e=this.engine.wasm,n=e._wl_glTF_scene_get_extensions(this._index);if(!n)return null;let s=n/4;const o=e.HEAPU32,a=()=>{const l=o[s++],h=o[s++];return e.UTF8ViewToString(l,l+h)},c=o[s++],_=new Ms(c),d=o[s++];for(let l=0;l<d;++l){const h=o[s++];_.mesh[h]=JSON.parse(a())}const p=o[s++];for(let l=0;l<p;++l){const h=o[s++];_.node[h]=JSON.parse(a())}const r=a();return r&&(_.root=JSON.parse(r)),_}}const Tn="WLEV";class ae extends ze{constructor(e,n){var s;super(e,n);u(this,"onPreRender",new H);u(this,"onPostRender",new H);u(this,"_rayHit");u(this,"_hit");this._rayHit=(s=this.engine)==null?void 0:s.wasm._malloc(4*(3*4+3*4+4+2)+4),this._hit=new ni(this,this._rayHit)}instantiate(e){const s=this.engine.wasm._wl_scene_instantiate(e._index,this._index),o={root:this.wrap(s)};if(e instanceof rn){const a=this.wrap(s);e._processInstantiaton(this,a,o)}return o}destroy(){if(this.isActive)throw new Error(`Attempt to destroy ${this}, but destroying the active scene is not supported`);const e=this.engine.wasm,n=this._rayHit;super.destroy(),e._free(n)}get activeViews(){const e=this.engine.wasm,n=e._wl_scene_get_active_views(this._index,e._tempMem,16),s=[];for(let o=0;o<n;++o){const a=e._tempMemInt[o];s.push(this._components.wrapView(a))}return s}rayCast(e,n,s,o=100){return this.engine.wasm._wl_scene_ray_cast(this._index,e[0],e[1],e[2],n[0],n[1],n[2],s,this._rayHit,o),this._hit}set clearColor(e){this.engine.wasm._wl_scene_set_clearColor(e[0],e[1],e[2],e[3])}set colorClearEnabled(e){this.engine.wasm._wl_scene_enableColorClear(e)}async load(e){let n=!1,s;fe(e)?s=await ae.loadBuffer(e,(a,c)=>{this.engine.log.info(I.Scene,`Scene downloading: ${a} / ${c}`),this.setLoadingProgress(a/c)}):(s=e,n=e.dispatchReadyEvent??!1);const o=await this.engine.loadMainSceneFromBuffer({...s,dispatchReadyEvent:n});return this.engine.onSceneLoaded.notify(),o}async append(e,n={}){const{baseURL:s=fe(e)?Kn(e):this.baseURL}=n,o=fe(e)?await Ln(e):e,a=new Uint8Array(o),_=a.byteLength>Tn.length&&a.subarray(0,Tn.length).every((p,r)=>p===Tn.charCodeAt(r))?this.engine.loadPrefabFromBuffer({buffer:o,baseURL:s}):this.engine.loadGLTFFromBuffer({buffer:o,baseURL:s,extensions:n.loadGltfExtensions}),d=this.instantiate(_);return _ instanceof rn&&_.extensions?{root:d.root,extensions:{...d.extensions,root:_.extensions.root}}:d.root}setLoadingProgress(e){this.engine.wasm._wl_set_loading_screen_progress(Sr(e,0,1))}dispatchReadyEvent(){document.dispatchEvent(new CustomEvent("wle-scene-ready",{detail:{filename:this.filename}}))}set skyMaterial(e){this.engine.wasm._wl_scene_set_sky_material(this._index,(e==null?void 0:e._id)??0)}get skyMaterial(){const e=this.engine.wasm._wl_scene_get_sky_material(this._index);return this.engine.materials.wrap(e)}reset(){}async _downloadDependency(e){const n=this.engine.wasm,s=await Ln(e),o=n.copyBufferToHeap(s);try{n._wl_scene_load_queued_bin(this._index,o,s.byteLength)}finally{n._free(o)}}async _downloadDependencies(){const e=this.engine.wasm,n=e._wl_scene_queued_bin_count(this._index);if(!n)return Promise.resolve();const s=new Array(n).fill(0).map((o,a)=>{const c=e._wl_scene_queued_bin_path(this._index,a);return e.UTF8ToString(c)});return e._wl_scene_clear_queued_bin_list(this._index),Promise.all(s.map(o=>this._downloadDependency(o)))}}function bi(){if(!navigator.xr){const i=location.hostname==="localhost"||location.hostname==="127.0.0.1",t=location.protocol!=="https:"&&!i;return Promise.reject(t?"WebXR is only supported with HTTPS or on localhost!":"WebXR unsupported in this browser.")}return Promise.resolve()}var W,nt,xe,Ve;class Ps{constructor(t,e){u(this,"onXRSessionEnd",new H);u(this,"onXRSessionStart",new Kt);u(this,"onResize",new H);u(this,"arSupported",!1);u(this,"vrSupported",!1);u(this,"onLoadingScreenEnd",new Kt);u(this,"onSceneLoaded",new H);u(this,"onSceneActivated",new H);u(this,"i18n",new bs(this));u(this,"xr",null);u(this,"erasePrototypeOnDestroy",!1);u(this,"legacyMaterialSupport",!0);u(this,"_scenes",[]);u(this,"_scene",null);u(this,"_textures",null);u(this,"_materials",null);u(this,"_meshes",null);u(this,"_morphTargets",null);u(this,"_fonts",null);G(this,W,void 0);G(this,nt,null);G(this,xe,null);G(this,Ve,null);pe(this,W,t),E(this,W)._setEngine(this),E(this,W)._loadingScreen=e,this.canvas.addEventListener("webglcontextlost",n=>this.log.error(I.Engine,"Context lost:",n),!1)}start(){this.wasm._wl_application_start()}registerComponent(...t){for(const e of t)this.wasm._registerComponent(e)}async switchTo(t,e={}){this.wasm._wl_deactivate_activeScene();const n=this.scene;this._scene=t,this.wasm._wl_scene_activate(t._index),this.onLoadingScreenEnd.isDataRetained||this.onLoadingScreenEnd.notify(),t._downloadDependencies(),this.physics&&(this.physics._hit._scene=t),await this.i18n.setLanguage(this.i18n.languageCode(0));const{dispatchReadyEvent:s=!1}=e;this.onSceneActivated.notify(n,t),s&&t.dispatchReadyEvent()}async loadMainScene(t,e=()=>{}){const n=await ae.loadBuffer(t,e);return this.loadMainSceneFromBuffer(n)}async loadMainSceneFromBuffer(t){const{buffer:e,url:n}=ze.validateBufferOptions(t),s=E(this,W);s._wl_deactivate_activeScene();for(let d=this._scenes.length-1;d>=0;--d){const p=this._scenes[d];p&&p.destroy()}this._textures._clear(),this._materials._clear(),this._meshes._clear(),this._morphTargets._clear();const o=s.copyBufferToHeap(e);let a=-1;try{a=s._wl_load_main_scene(o,e.byteLength,s.tempUTF8(n))}finally{s._free(o)}if(a===-1)throw new Error("Failed to load main scene");const c=this._reload(a);let _=this.scene;return this._scene=c,c._initialize(),this._scene=_,await this.switchTo(c,t),c}async loadPrefab(t,e=()=>{}){const n=await ae.loadBuffer(t,e);return this.loadPrefabFromBuffer(n)}loadPrefabFromBuffer(t){const e=this._loadSceneFromBuffer(ze,t);if(this.wasm._wl_scene_activatable(e._index))throw this.wasm._wl_scene_destroy(e._index),new Error("File is not a prefab. To load a scene, use loadScene() instead");return e._initialize(),e}async loadScene(t,e=()=>{}){const n=await ae.loadBuffer(t,e);return this.loadSceneFromBuffer(n)}async loadGLTF(t,e=()=>{}){const n=await ae.loadBuffer(t,e),s=fe(t)?n:{...t,...n};return this.loadGLTFFromBuffer(s)}loadSceneFromBuffer(t){const e=this._loadSceneFromBuffer(ae,t);if(!this.wasm._wl_scene_activatable(e._index))throw this.wasm._wl_scene_destroy(e._index),new Error("File is not a scene. To load a prefab, use loadPrefab() instead");return e._initialize(),e}loadGLTFFromBuffer(t){ae.validateBufferOptions(t);const{buffer:e,extensions:n=!1}=t,s=this.wasm,o=s.copyBufferToHeap(e);try{const a=s._wl_glTF_scene_create(n,o,e.byteLength),c=new rn(this,a);return this._scenes[c._index]=c,c}finally{s._free(o)}}isRegistered(t){return E(this,W).isRegistered(fe(t)?t:t.TypeName)}resize(t,e,n=window.devicePixelRatio){t=t*n,e=e*n,this.canvas.width=t,this.canvas.height=e,this.wasm._wl_application_resize(t,e),this.onResize.notify()}nextFrame(t=0){E(this,W)._wl_nextFrame(t)}requestXRSession(t,e,n=[]){return bi().then(()=>E(this,W).webxr_requestSession(t,e,n))}offerXRSession(t,e,n=[]){return bi().then(()=>E(this,W).webxr_offerSession(t,e,n))}wrapObject(t){return this.scene.wrap(t)}toString(){return"engine"}get scene(){return this._scene}get wasm(){return E(this,W)}get canvas(){return E(this,W).canvas}get xrSession(){var t;return((t=this.xr)==null?void 0:t.session)??null}get xrFrame(){var t;return((t=this.xr)==null?void 0:t.frame)??null}get xrBaseLayer(){var t;return((t=this.xr)==null?void 0:t.baseLayer)??null}get xrFramebuffer(){var t;return((t=this.xr)==null?void 0:t.framebuffers[0])??null}get xrFramebufferScaleFactor(){return E(this,W).webxr_framebufferScaleFactor}set xrFramebufferScaleFactor(t){E(this,W).webxr_framebufferScaleFactor=t}get physics(){return E(this,nt)}get textures(){return this._textures}get materials(){return this._materials}get meshes(){return this._meshes}get morphTargets(){return this._morphTargets}get fonts(){return this._fonts}get images(){const t=this.wasm,e=t._tempMemSize>>1,n=t._wl_get_images(t._tempMem,e),s=new Array(n);for(let o=0;o<n;++o){const a=t._tempMemUint16[o];s[o]=t._images[a]}return s}get imagesPromise(){const t=this.images.map(e=>Ar(e));return Promise.all(t)}set autoResizeCanvas(t){var n;if(!!E(this,xe)!==t){if(!t){(n=E(this,xe))==null||n.unobserve(this.canvas),pe(this,xe,null);return}pe(this,xe,new ResizeObserver(s=>{for(const o of s)o.target===this.canvas&&this.resize(o.contentRect.width,o.contentRect.height)})),E(this,xe).observe(this.canvas)}}get autoResizeCanvas(){return E(this,xe)!==null}get runtimeVersion(){const t=E(this,W);return t._wl_application_version(t._tempMem),{major:t._tempMemUint16[0],minor:t._tempMemUint16[1],patch:t._tempMemUint16[2],rc:t._tempMemUint16[3]}}get log(){return E(this,W)._log}_init(){const t=()=>{pe(this,Ve,this.xr.currentReferenceSpaceType);const e=this.xr.referenceSpaceForType("local")??this.xr.referenceSpaceForType("viewer");this.xr.currentReferenceSpace=e};if(this.onXRSessionStart.add(t),this.onLoadingScreenEnd.once(()=>{this.onXRSessionStart.remove(t),!(!this.xr||!E(this,Ve))&&(this.xr.currentReferenceSpace=this.xr.referenceSpaceForType(E(this,Ve))??this.xr.referenceSpaceForType("viewer"),pe(this,Ve,null))}),E(this,W)._wl_set_error_callback(E(this,W).addFunction(e=>{throw new Error(E(this,W).UTF8ToString(e))},"vi")),pe(this,nt,null),E(this,W).withPhysX){const e=new ms(this);E(this,W)._wl_physx_set_collision_callback(E(this,W).addFunction((n,s,o,a)=>{const c=this.scene._components.wrapPhysx(n),_=this.scene._components.wrapPhysx(a),d=e._callbacks[c._id][s];d(o,_)},"viiii")),pe(this,nt,e)}this.resize(this.canvas.clientWidth,this.canvas.clientHeight),this._scene=this._reload(0)}_reset(){this.wasm.reset(),this._scenes.length=0,this._scene=this._reload(0),this.switchTo(this._scene)}_createEmpty(){const e=this.wasm._wl_scene_create_empty(),n=new ae(this,e);return this._scenes[e]=n,n}_destroyScene(t){this.wasm._wl_scene_destroy(t._index);const n=t._index;t._index=-1,this.erasePrototypeOnDestroy&&Object.setPrototypeOf(t,fs),this._scenes[n]=null}_reload(t){const e=new ae(this,t);return this._scenes[t]=e,this._textures=new Ts(this),this._materials=new As(this),this._meshes=new Ss(this),this._morphTargets=new Le(this,vs),this._fonts=new Le(this,ws),e}_loadSceneFromBuffer(t,e){const{buffer:n,url:s}=ae.validateBufferOptions(e),o=this.wasm,a=o.copyBufferToHeap(n);let c=-1;try{c=o._wl_scene_create(a,n.byteLength,o.tempUTF8(s))}finally{o._free(a)}if(!c)throw new Error("Failed to parse scene");const _=new t(this,c);return this._scenes[c]=_,_}}W=new WeakMap,nt=new WeakMap,xe=new WeakMap,Ve=new WeakMap;function xi(i){if(i>=32)throw new Error(`BitSet.enable(): Value ${i} is over 31`)}class Nn{constructor(){u(this,"_bits",0)}enable(...t){for(const e of t)xi(e),this._bits|=1<<e>>>0;return this}enableAll(){return this._bits=-1,this}disable(...t){for(const e of t)xi(e),this._bits&=~(1<<e>>>0);return this}disableAll(){return this._bits=0,this}enabled(t){return!!(this._bits&1<<t>>>0)}}var Se;(function(i){i[i.Info=0]="Info",i[i.Warn=1]="Warn",i[i.Error=2]="Error"})(Se||(Se={}));class Fs{constructor(...t){u(this,"levels",new Nn);u(this,"tags",new Nn().enableAll());this.levels.enable(...t)}info(t,...e){return this.levels.enabled(Se.Info)&&this.tags.enabled(t)&&console.log(...e),this}warn(t,...e){return this.levels.enabled(Se.Warn)&&this.tags.enabled(t)&&console.warn(...e),this}error(t,...e){return this.levels.enabled(Se.Error)&&this.tags.enabled(t)&&console.error(...e),this}}const Dr=2,Ai=3,Hr=64,Br=69,Ur=70,Vr=71,Nr=72,Wr=77,$r=78,zr=79,Xr=85,qr=86;function Gr(i,t=(n,s)=>s,e={}){const{dictionary:n="object"}=e,s=new DataView(i.buffer,i.byteOffset,i.byteLength);let o=0;function a(F,C){return o+=F,C}function c(F){return a(F,i.subarray(o,o+F))}function _(){const F=5960464477539063e-23,C=new ArrayBuffer(4),R=new DataView(C),T=l(),x=T&32768;let A=T&31744;const O=T&1023;if(A===31744)A=261120;else if(A!==0)A+=114688;else if(O!==0)return(x?-1:1)*O*F;return R.setUint32(0,x<<16|A<<13|O<<13),R.getFloat32(0)}function d(){return a(4,s.getFloat32(o))}function p(){return a(8,s.getFloat64(o))}function r(){return a(1,i[o])}function l(){return a(2,s.getUint16(o))}function h(){return a(4,s.getUint32(o))}function f(){return a(8,s.getBigUint64(o))}function w(){return i[o]!==255?!1:(o+=1,!0)}function m(F){if(F<24)return F;if(F===24)return r();if(F===25)return l();if(F===26)return h();if(F===27){const C=f();return C<=Number.MAX_SAFE_INTEGER?Number(C):C}if(F===31)return-1;throw new Error("CBORError: Invalid length encoding")}function g(F){const C=r();if(C===255)return-1;const R=m(C&31);if(R<0||C>>5!==F)throw new Error("CBORError: Invalid indefinite length element");return Number(R)}function y(F,C){for(let R=0;R<C;++R){let T=r();T&128&&(T<224?(T=(T&31)<<6|r()&63,C-=1):T<240?(T=(T&15)<<12|(r()&63)<<6|r()&63,C-=2):(T=(T&7)<<18|(r()&63)<<12|(r()&63)<<6|r()&63,C-=3)),T<65536?F.push(T):(T-=65536,F.push(55296|T>>10),F.push(56320|T&1023))}}function v(){const F=r(),C=F>>5,R=F&31;let T,x;if(C===7)switch(R){case 25:return _();case 26:return d();case 27:return p()}if(x=m(R),x<0&&(C<2||6<C))throw new Error("CBORError: Invalid length");switch(C){case 0:return x;case 1:return typeof x=="number"?-1-x:-1n-x;case 2:{if(x<0){const A=[];let O=0;for(;(x=g(C))>=0;)O+=x,A.push(c(x));const D=new Uint8Array(O);let z=0;for(T=0;T<A.length;++T)D.set(A[T],z),z+=A[T].length;return D}return c(x).slice()}case 3:{const A=[];if(x<0)for(;(x=g(C))>=0;)y(A,x);else y(A,x);let O="";const D=8192;for(T=0;T<A.length;T+=D)O+=String.fromCharCode.apply(null,A.slice(T,T+D));return O}case 4:{let A;if(x<0)for(A=[];!w();)A.push(v());else for(A=new Array(x),T=0;T<x;++T)A[T]=v();return A}case 5:{if(n==="map"){const O=new Map;for(T=0;T<x||x<0&&!w();++T){const D=v();if(O.has(D))throw new Error("CBORError: Duplicate key encountered");O.set(D,v())}return O}const A={};for(T=0;T<x||x<0&&!w();++T){const O=v();if(Object.prototype.hasOwnProperty.call(A,O))throw new Error("CBORError: Duplicate key encountered");A[O]=v()}return A}case 6:{const A=v(),O=x;if(A instanceof Uint8Array)switch(O){case Dr:case Ai:let D=A.reduce((z,L)=>(z<<8n)+BigInt(L),0n);return O==Ai&&(D=-1n-D),D;case Hr:return A;case Nr:return new Int8Array(A.buffer);case Br:return new Uint16Array(A.buffer);case Wr:return new Int16Array(A.buffer);case Ur:return new Uint32Array(A.buffer);case $r:return new Int32Array(A.buffer);case Vr:return new BigUint64Array(A.buffer);case zr:return new BigInt64Array(A.buffer);case Xr:return new Float32Array(A.buffer);case qr:return new Float64Array(A.buffer)}return t(O,A)}case 7:switch(x){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;default:return x}}}const S=v();if(o!==i.byteLength)throw new Error("CBORError: Remaining bytes");return S}const Zr={decode:Gr},Qr=new Map([[b.Bool,!1],[b.Int,0],[b.Float,0],[b.String,""],[b.Enum,void 0],[b.Object,null],[b.Mesh,null],[b.Texture,null],[b.Material,null],[b.Animation,null],[b.Skin,null],[b.Color,Float32Array.from([0,0,0,1])],[b.Vector2,Float32Array.from([0,0])],[b.Vector3,Float32Array.from([0,0,0])],[b.Vector4,Float32Array.from([0,0,0,0])]]);function Yr(i){var t;for(const e in i.Properties){const n=i.Properties[e];if(n.type===b.Enum)(t=n.values)!=null&&t.length?(typeof n.default!="number"&&(n.default=n.values.indexOf(n.default)),(n.default<0||n.default>=n.values.length)&&(n.default=0)):n.default=void 0;else if((n.type===b.Color||n.type===b.Vector2||n.type===b.Vector3||n.type===b.Vector4)&&Array.isArray(n.default))n.default=Float32Array.from(n.default);else if(n.default===void 0){const s=n.cloner??tt;n.default=s.clone(n.type,Qr.get(n.type))}i.prototype[e]=n.default}}function Jr(i){i._propertyOrder=i.hasOwnProperty("Properties")?Object.keys(i.Properties).sort():[]}class Cs{constructor(t){u(this,"worker","");u(this,"wasm",null);u(this,"canvas",null);u(this,"preinitializedWebGPUDevice",null);u(this,"webxr_session",null);u(this,"webxr_requestSession",null);u(this,"webxr_offerSession",null);u(this,"webxr_frame",null);u(this,"webxr_refSpace",null);u(this,"webxr_refSpaces",null);u(this,"webxr_refSpaceType",null);u(this,"webxr_baseLayer",null);u(this,"webxr_framebufferScaleFactor",1);u(this,"webxr_fbo",0);u(this,"UTF8ViewToString");u(this,"_log",new Fs);u(this,"_deactivate_component_on_error",!1);u(this,"_tempMem",null);u(this,"_tempMemSize",0);u(this,"_tempMemFloat",null);u(this,"_tempMemInt",null);u(this,"_tempMemUint8",null);u(this,"_tempMemUint32",null);u(this,"_tempMemUint16",null);u(this,"_loadingScreen",null);u(this,"_sceneLoadedCallback",[]);u(this,"_images",[null]);u(this,"_components",null);u(this,"_componentTypes",[]);u(this,"_componentTypeIndices",{});u(this,"_engine",null);u(this,"_withPhysX",!1);u(this,"_utf8Decoder",new TextDecoder("utf8"));u(this,"_brokenComponentIndex",0);t?this.UTF8ViewToString=(e,n)=>e?this._utf8Decoder.decode(this.HEAPU8.slice(e,n)):"":this.UTF8ViewToString=(e,n)=>e?this._utf8Decoder.decode(this.HEAPU8.subarray(e,n)):"",this._brokenComponentIndex=this._registerComponent(Ae)}reset(){this._wl_reset(),this._components=null,this._images.length=1,this.allocateTempMemory(1024),this._componentTypes=[],this._componentTypeIndices={},this._brokenComponentIndex=this._registerComponent(Ae)}isRegistered(t){return t in this._componentTypeIndices}_registerComponentLegacy(t,e,n){const s=class extends k{};return s.TypeName=t,s.Properties=e,Object.assign(s.prototype,n),this._registerComponent(s)}_registerComponent(t){if(!t.TypeName)throw new Error("no name provided for component.");if(!t.prototype._triggerInit)throw new Error(`registerComponent(): Component ${t.TypeName} must extend Component`);ei(t),Yr(t),Jr(t);const e=t.TypeName in this._componentTypeIndices?this._componentTypeIndices[t.TypeName]:this._componentTypes.length;return this._componentTypes[e]=t,this._componentTypeIndices[t.TypeName]=e,t===Ae||(this._log.info(I.Engine,"Registered component",t.TypeName,`(class ${t.name})`,"with index",e),t.onRegister&&t.onRegister(this._engine)),e}allocateTempMemory(t){this._log.info(I.Engine,"Allocating temp mem:",t),this._tempMemSize=t,this._tempMem&&this._free(this._tempMem),this._tempMem=this._malloc(this._tempMemSize),this.updateTempMemory()}requireTempMem(t){this._tempMemSize>=t||this.allocateTempMemory(Math.ceil(t/1024)*1024)}updateTempMemory(){this._tempMemFloat=new Float32Array(this.HEAP8.buffer,this._tempMem,this._tempMemSize>>2),this._tempMemInt=new Int32Array(this.HEAP8.buffer,this._tempMem,this._tempMemSize>>2),this._tempMemUint32=new Uint32Array(this.HEAP8.buffer,this._tempMem,this._tempMemSize>>2),this._tempMemUint16=new Uint16Array(this.HEAP8.buffer,this._tempMem,this._tempMemSize>>1),this._tempMemUint8=new Uint8Array(this.HEAP8.buffer,this._tempMem,this._tempMemSize)}getTempBufferU8(t){return this.requireTempMem(t),this._tempMemUint8}getTempBufferU16(t){return this.requireTempMem(t*2),this._tempMemUint16}getTempBufferU32(t){return this.requireTempMem(t*4),this._tempMemUint32}getTempBufferI32(t){return this.requireTempMem(t*4),this._tempMemInt}getTempBufferF32(t){return this.requireTempMem(t*4),this._tempMemFloat}tempUTF8(t,e=0){const n=this.lengthBytesUTF8(t)+1;this.requireTempMem(n+e);const s=this._tempMem+e;return this.stringToUTF8(t,s,n),s}copyBufferToHeap(t){const e=t.byteLength,n=this._malloc(e);return this.HEAPU8.set(new Uint8Array(t),n),n}get withPhysX(){return this._withPhysX}_setEngine(t){this._engine=t}_wljs_xr_session_start(t){this._engine.xr===null&&(this._engine.xr=new xs(this,t),this._engine.onXRSessionStart.notify(this.webxr_session,t))}_wljs_xr_session_end(){const t=this._engine.onXRSessionStart;t instanceof Kt&&t.reset(),this._engine.onXRSessionEnd.notify(),this._engine.xr=null}_wljs_xr_disable(){this._engine.arSupported=!1,this._engine.vrSupported=!1}_wljs_init(t){this._withPhysX=t,this.allocateTempMemory(1024)}_wljs_scene_switch(t){const e=this._engine._scenes[t];this._components=(e==null?void 0:e._jsComponents)??null}_wljs_destroy_image(t){const e=this._images[t];e&&(this._images[t]=null,e.src!==void 0&&(e.src=""),e.onload!==void 0&&(e.onload=null),e.onerror!==void 0&&(e.onerror=null))}_wljs_objects_markDestroyed(t,e,n){const s=this._engine._scenes[t],o=e>>>1;for(let a=0;a<n;++a){const c=this.HEAPU16[o+a];s._destroyObject(c)}}_wljs_scene_initialize(t,e,n,s,o,a,c){const _=this.HEAPU8.subarray(s,o),d=this.HEAPU32.subarray(a>>>2,c>>>2),p=this.HEAPU16.subarray(e>>>1,n>>>1),r=this._engine,l=r._scenes[t],h=l._jsComponents;let f;try{f=Zr.decode(_)}catch(w){this._log.error(I.Engine,"Exception during component parameter decoding"),this._log.error(I.Component,w);return}if(!Array.isArray(f)){this._log.error(I.Engine,"Parameter data must be an array");return}if(f.length!==p.length){this._log.error(I.Engine,`Parameter data has size ${f.length} but expected ${p.length}`);return}for(let w=0;w<f.length;++w){const m=k._pack(t,p[w]),g=this._wl_get_js_component_index_for_id(m),y=h[g],v=y.constructor;if(v==Ae)continue;const S=v._propertyOrder,F=f[w];if(!Array.isArray(F)){this._log.error(I.Engine,"Component parameter data must be an array");continue}if(F.length!==S.length){this._log.error(I.Engine,`Component parameter data has size ${F.length} but expected ${S.length}`);continue}for(let C=0;C<F.length;++C){const R=S[C],T=v.Properties[R],x=T.type;let A=F[C];if(A===void 0){A=(T.cloner??tt).clone(x,T.default),y[R]=A;continue}switch(typeof A=="number"&&(A+=d[x]),x){case b.Bool:case b.Int:case b.Float:case b.String:case b.Enum:case b.Vector2:case b.Vector3:case b.Vector4:break;case b.Object:A=A?l.wrap(this._wl_object_id(l._index,A)):null;break;case b.Mesh:A=r.meshes.wrap(A);break;case b.Texture:A=r.textures.wrap(A);break;case b.Material:A=r.materials.wrap(A);break;case b.Animation:A=l.animations.wrap(A);break;case b.Skin:A=l.skins.wrap(A);break;case b.Color:const O=(1<<A.BYTES_PER_ELEMENT*8)-1;A=Float32Array.from(A,(D,z)=>D/O);break}y[R]=A}}}_wljs_set_component_param_translation(t,e,n,s,o){const c=this._engine._scenes[t]._jsComponents[e],_=this.UTF8ViewToString(s,o),p=c.constructor._propertyOrder[n];c[p]=_}_wljs_get_component_type_index(t,e){const n=this.UTF8ViewToString(t,e),s=this._componentTypeIndices[n];return s===void 0?this._brokenComponentIndex:s}_wljs_component_create(t,e,n,s,o){this._engine._scenes[t]._components.createJs(e,n,s,o)}_wljs_component_init(t,e){this._engine._scenes[t]._jsComponents[e]._triggerInit()}_wljs_component_update(t,e){this._components[t]._triggerUpdate(e)}_wljs_component_onActivate(t){this._components[t]._triggerOnActivate()}_wljs_component_onDeactivate(t){this._components[t]._triggerOnDeactivate()}_wljs_component_markDestroyed(t,e,n){const o=this._engine._scenes[t]._components.get(e,n);o==null||o._triggerOnDestroy()}_wljs_swap(t,e,n){const s=this._engine._scenes[t]._jsComponents,o=s[e];s[e]=s[n],s[n]=o}_wljs_copy(t,e,n,s,o){const a=this._engine._scenes[t],_=this._engine._scenes[n]._jsComponents[s],d=a._jsComponents[e];try{_._copy(d,o)}catch(p){this._log.error(I.Component,`Exception during ${_.type} copy() on object ${_.object.name}`),this._log.error(I.Component,p)}}_wljs_trigger_animationEvent(t,e,n){const o=this._engine.scene._components.wrapAnimation(t),a=this.UTF8ViewToString(e,n);o.onEvent.notify(a)}}const ft={major:1,minor:2,patch:0,rc:0},Si="WonderlandRuntime-LoadingScreen.bin";function Kr(i){return new Promise((t,e)=>{const n=document.createElement("script"),s=document.body.appendChild(n);n.onload=()=>{document.body.removeChild(s),t()},n.onerror=o=>{document.body.removeChild(s),e(o)},n.src=i})}async function eo(){let[i,t]=await Promise.all([mr(),gr()]);return i?console.log("WASM SIMD is supported"):console.warn("WASM SIMD is not supported"),t?self.crossOriginIsolated?console.log("WASM Threads is supported"):console.warn("WASM Threads is supported, but the page is not crossOriginIsolated, therefore thread support is disabled."):console.warn("WASM Threads is not supported"),t=t&&self.crossOriginIsolated,{simdSupported:i,threadsSupported:t}}const Fe={ar:null,vr:null};function to(){if(typeof navigator>"u"||!navigator.xr)return Fe.vr=!1,Fe.ar=!1,Promise.resolve(Fe);const i=Fe.vr!==null?Promise.resolve():navigator.xr.isSessionSupported("immersive-vr").then(e=>Fe.vr=e),t=Fe.ar!==null?Promise.resolve():navigator.xr.isSessionSupported("immersive-ar").then(e=>Fe.ar=e);return Promise.all([i,t]).then(()=>Fe)}function Es(i){const{major:t,minor:e}=i;let n=t-ft.major,s=e-ft.minor;if(!n&&!s)return;const o=`checkRuntimeCompatibility(): Version compatibility mismatch:
	 API and runtime compatibility is enforced on a patch level (versions x.y.*)
`;throw n<0||!n&&s<0?new Error(`${o}	 Please use a Wonderland Engine editor version >= ${ft.major}.${ft.minor}.*`):new Error(`${o}	 Please use a new API version >= ${i.major}.${i.minor}.*`)}async function js(i,t={}){const e=to(),n=Kn(i),{simdSupported:s,threadsSupported:o}=await eo(),{simd:a=s,threads:c=o,webgpu:_=!1,physx:d=!1,loader:p=!1,xrFramebufferScaleFactor:r=1,xrOfferSession:l=null,loadingScreen:h=n?`${n}/${Si}`:Si,canvas:f="canvas",logs:w=[Se.Info,Se.Warn,Se.Error]}=t,m=[];_&&m.push("webgpu"),p&&m.push("loader"),d&&m.push("physx"),a&&m.push("simd"),c&&m.push("threads");const g=m.join("-");let y=i;g&&(y=`${y}-${g}`);const v=function(D,z){return fetch(D).then(L=>L.ok?L.arrayBuffer():Promise.reject(z)).catch(L=>Promise.reject(z))},[S,F]=await Promise.all([v(`${y}.wasm`,"Failed to fetch runtime .wasm file"),v(h,"Failed to fetch loading screen file")]),C=document.getElementById(f);if(!C)throw new Error(`loadRuntime(): Failed to find canvas with id '${f}'`);if(!(C instanceof HTMLCanvasElement))throw new Error(`loadRuntime(): HTML element '${f}' must be a canvas`);const R=new Cs(c);if(R.worker=`${y}.worker.js`,R.wasm=S,R.canvas=C,R._log.levels.enable(...w),_){const D=await navigator.gpu.requestAdapter(),z={requiredFeatures:["texture-compression-bc"]},L=await D.requestDevice(z);R.preinitializedWebGPUDevice=L}const T=new Ps(R,F);window._WL||(window._WL={runtimes:{}});const x=window._WL.runtimes,A=g||"default";x[A]||(await Kr(`${y}.js`),x[A]=window.instantiateWonderlandRuntime,window.instantiateWonderlandRuntime=void 0),await x[A](R),T._init(),Es(T.runtimeVersion);const O=await e;if(T.arSupported=O.ar,T.vrSupported=O.vr,T.xrFramebufferScaleFactor=r,T.autoResizeCanvas=!0,T.start(),l!==null){let D=l.mode;D=="auto"&&(T.vrSupported?D="immersive-vr":T.arSupported?D="immersive-ar":D="inline");const z=function(){T.offerXRSession(D,l.features,l.optionalFeatures).then(L=>L.addEventListener("end",z)).catch(console.warn)};z()}return T}const no=Object.freeze(Object.defineProperty({__proto__:null,APIVersion:ft,get Alignment(){return On},Animation:ys,AnimationComponent:Ie,get AnimationState(){return Hn},BitSet:Nn,BrokenComponent:Ae,get Collider(){return ot},CollisionComponent:Oe,get CollisionEventType(){return Bn},Component:k,DefaultPropertyCloner:hs,DestroyedComponentInstance:ps,DestroyedObjectInstance:ds,DestroyedPrefabInstance:fs,Emitter:H,Font:ws,get ForceMode(){return vt},GLTFExtensions:Ms,I18N:bs,InputComponent:lt,get InputType(){return ve},Justification:Tr,LightComponent:ee,get LightType(){return Dn},get LockAxis(){return Un},get LogLevel(){return Se},get LogTag(){return I},Logger:Fs,Material:sn,MaterialManager:As,get MaterialParamType(){return be},Mesh:xt,get MeshAttribute(){return me},MeshAttributeAccessor:gs,MeshComponent:_e,get MeshIndexType(){return le},MeshManager:Ss,get MeshSkinningType(){return tn},MorphTargets:vs,Object:Vn,Object3D:Vn,PhysXComponent:V,Physics:ms,Prefab:ze,PrefabGLTF:rn,Property:Y,RayHit:ni,Resource:at,ResourceManager:Le,RetainEmitter:Kt,Scene:ae,SceneResource:Ct,get Shape(){return bt},Skin:ti,TextComponent:ue,get TextEffect(){return In},Texture:nn,TextureManager:Ts,get Type(){return b},get VerticalAlignment(){return en},ViewComponent:Te,WASM:Cs,WonderlandEngine:Ps,XR:xs,checkRuntimeCompatibility:Es,defaultPropertyCloner:tt,inheritProperties:ei,loadRuntime:js,math:Cr},Symbol.toStringTag,{value:"Module"}));class Ti extends k{constructor(){super(...arguments);u(this,"name","wonderland-engine-8thwall-camera");u(this,"started",!1);u(this,"view",null);u(this,"position",[0,0,0]);u(this,"rotation",[0,0,0,-1]);u(this,"glTextureRenderer",null)}promptForDeviceMotion(){return new Promise(async(e,n)=>{window.dispatchEvent(new Event("8thwall-request-user-interaction")),window.addEventListener("8thwall-safe-to-request-permissions",async()=>{try{const s=await DeviceMotionEvent.requestPermission();e(s)}catch(s){n(s)}})})}async getPermissions(){if(DeviceMotionEvent&&DeviceMotionEvent.requestPermission)try{if(await DeviceMotionEvent.requestPermission()!=="granted")throw new Error("MotionEvent")}catch(e){if(e.name==="NotAllowedError"){if(await this.promptForDeviceMotion()!=="granted")throw new Error("MotionEvent")}else throw new Error("MotionEvent")}try{(await navigator.mediaDevices.getUserMedia({video:!0,audio:!0})).getTracks().forEach(n=>{n.stop()})}catch{throw new Error("Camera")}}init(){this.view=this.object.getComponent("view"),this.onUpdate=this.onUpdate.bind(this),this.onAttach=this.onAttach.bind(this),this.onException=this.onException.bind(this),this.onCameraStatusChange=this.onCameraStatusChange.bind(this)}async start(){this.view=this.object.getComponent("view"),this.useCustomUIOverlays||io.init();try{await this.getPermissions()}catch(n){window.dispatchEvent(new CustomEvent("8thwall-permission-fail",{detail:n}));return}await this.waitForXR8(),XR8.XrController.configure({disableWorldTracking:!1}),this.glTextureRenderer=XR8.GlTextureRenderer.pipelineModule(),XR8.addCameraPipelineModules([this.glTextureRenderer,XR8.XrController.pipelineModule(),this]);const e={cameraConfig:{direction:XR8.XrConfig.camera().BACK},canvas:Module.canvas,allowedDevices:XR8.XrConfig.device().ANY,ownRunLoop:!1};XR8.run(e)}onAttach(e){this.started=!0,this.engine.scene.colorClearEnabled=!1;const n=Module.ctx,s=this.object.rotationWorld,o=this.object.getTranslationWorld([]);this.position=Array.from(o),this.rotation=Array.from(s),XR8.XrController.updateCameraProjectionMatrix({origin:{x:o[0],y:o[1],z:o[2]},facing:{x:s[0],y:s[1],z:s[2],w:s[3]},cam:{pixelRectWidth:Module.canvas.width,pixelRectHeight:Module.canvas.height,nearClipPlane:this.view.near,farClipPlane:this.view.far}}),this.engine.scene.onPreRender.push(()=>{n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),XR8.runPreRender(Date.now()),XR8.runRender()}),this.engine.scene.onPostRender.push(()=>{XR8.runPostRender(Date.now())})}onCameraStatusChange(e){e&&e.status==="failed"&&this.onException(new Error(`Camera failed with status: ${e.status}`))}onUpdate(e){if(!e.processCpuResult.reality)return;const{rotation:n,position:s,intrinsics:o}=e.processCpuResult.reality;if(this.rotation[0]=n.x,this.rotation[1]=n.y,this.rotation[2]=n.z,this.rotation[3]=n.w,this.position[0]=s.x,this.position[1]=s.y,this.position[2]=s.z,o){const a=this.view.projectionMatrix;for(let c=0;c<16;c++)Number.isFinite(o[c])&&(a[c]=o[c])}s&&n&&(this.object.rotationWorld=this.rotation,this.object.setTranslationWorld(this.position))}onException(e){console.error("8thwall exception:",e),window.dispatchEvent(new CustomEvent("8thwall-error",{detail:e}))}waitForXR8(){return new Promise((e,n)=>{window.XR8?e():window.addEventListener("xrloaded",()=>e())})}}u(Ti,"TypeName","8thwall-camera"),u(Ti,"Properties",{useCustomUIOverlays:{type:b.Bool,default:!1}});const io={init:function(){this.handleRequestUserInteraction=this.handleRequestUserInteraction.bind(this),this.handlePermissionFail=this.handlePermissionFail.bind(this),this.handleError=this.handleError.bind(this),window.addEventListener("8thwall-request-user-interaction",this.handleRequestUserInteraction),window.addEventListener("8thwall-permission-fail",this.handlePermissionFail),window.addEventListener("8thwall-error",this.handleError)},handleRequestUserInteraction:function(){const i=this.showOverlay(so);window.addEventListener("8thwall-safe-to-request-permissions",()=>{i.remove()})},handlePermissionFail:function(i){this.showOverlay(ro)},handleError:function(i){this.showOverlay(oo)},showOverlay:function(i){const t=document.createElement("div");return t.innerHTML=i,document.body.appendChild(t),t}},so=`
<style>
  #request-permission-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 999;
    color: #fff;
    background-color: rgba(0, 0, 0, 0.5);
    text-align: center;
    font-family: sans-serif;
  }

  .request-permission-overlay_title {
    margin: 30px;
    font-size: 32px;
  }

  .request-permission-overlay_button {
    background-color: #e80086;
    font-size: 22px;
    padding: 10px 30px;
    color: #fff;
    border-radius: 15px;
    border: none;
  }
</style>

<div id="request-permission-overlay">
  <div class="request-permission-overlay_title">This app requires to use your camera and motion sensors</div>

  <button class="request-permission-overlay_button" onclick="window.dispatchEvent(new Event('8thwall-safe-to-request-permissions'))">OK</button>
</div>`,ro=`
<style>
  #failed-permission-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 999;
    color: #fff;
    background-color: rgba(0, 0, 0, 0.5);
    text-align: center;
    font-family: sans-serif;
  }

  .failed-permission-overlay_title {
    margin: 30px;
    font-size: 32px;
  }

  .failed-permission-overlay_button {
    background-color: #e80086;
    font-size: 22px;
    padding: 10px 30px;
    color: #fff;
    border-radius: 15px;
    border: none;
  }
</style>

<div id="failed-permission-overlay">
  <div class="failed-permission-overlay_title">Failed to grant permissions. Reset the the permissions and refresh the page.</div>

  <button class="failed-permission-overlay_button" onclick="window.location.reload()">Refresh the page</button>
</div>`,oo=`
<style>
  #wall-error-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 999;
    color: #fff;
    background-color: rgba(0, 0, 0, 0.5);
    text-align: center;
    font-family: sans-serif;
  }

  .wall-error-overlay_title {
    margin: 30px;
    font-size: 32px;
  }

  .wall-error-overlay_button {
    background-color: #e80086;
    font-size: 22px;
    padding: 10px 30px;
    color: #fff;
    border-radius: 15px;
    border: none;
  }
</style>

<div id="wall-error-overlay">
  <div class="wall-error-overlay_title">Error has occurred. Please reload the page</div>

  <button class="wall-error-overlay_button" onclick="window.location.reload()">Reload</button>
</div>`,Rt=new Float32Array(3),ht=new Float32Array(4);function wn(i,t){const e=t.orientation;ht[0]=e.x,ht[1]=e.y,ht[2]=e.z,ht[3]=e.w;const n=t.position;Rt[0]=n.x,Rt[1]=n.y,Rt[2]=n.z,i.resetPositionRotation(),i.setRotationLocal(ht),i.translateLocal(Rt)}var Rs=function(i,t,e,n){var s=arguments.length,o=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,t,e,n);else for(var c=i.length-1;c>=0;c--)(a=i[c])&&(o=(s<3?a(o):s>3?a(t,e,o):a(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},kt=new Float32Array(3),Mi=new Float32Array(4),Ne,an,ks,ln,Ls,it,qt,cn,Os,_n,Is,hn,Ds,st,Gt;const ne=class ne extends k{constructor(){super(...arguments);G(this,it);G(this,cn);G(this,_n);G(this,hn);G(this,st);u(this,"persist",!1);u(this,"uuid",null);u(this,"xrAnchor",null);u(this,"onCreate",new H);u(this,"visible",!1);u(this,"onTrackingFound",new H);u(this,"onTrackingLost",new H);u(this,"xrFrame",null);u(this,"xrHitResult",null)}static getAllAnchors(){return E(ne,Ne)}static create(e,n,s,o){const a=e.addComponent(ne,{...n,active:!1});return a===null?null:(a.xrHitResult=o??null,a.xrFrame=s??null,a.onCreate.once(()=>(a.xrFrame=null,a.xrHitResult=null)),a.active=!0,a.onCreate.promise())}start(){if(this.uuid&&this.engine.xr)this.persist=!0,this.engine.xr.session.restorePersistentAnchor===void 0&&console.warn("anchor: Persistent anchors are not supported by your client. Ignoring persist property."),this.engine.xr.session.restorePersistentAnchor(this.uuid).then(K(this,hn,Ds).bind(this));else if(K(this,it,qt).call(this))K(this,cn,Os).call(this).then(K(this,_n,Is).bind(this));else throw new Error("Anchors can only be created during the XR frame in an active XR session")}update(){if(!this.xrAnchor||!this.engine.xr)return;const e=this.engine.xr.frame.getPose(this.xrAnchor.anchorSpace,this.engine.xr.currentReferenceSpace),n=!!e;n!=this.visible&&(this.visible=n,(n?this.onTrackingFound:this.onTrackingLost).notify(this)),e&&wn(this.object,e.transform)}onDestroy(){var e;K(e=ne,ln,Ls).call(e,this)}};Ne=new WeakMap,an=new WeakSet,ks=function(e){E(ne,Ne).push(e)},ln=new WeakSet,Ls=function(e){const n=E(ne,Ne).indexOf(e);n<0||E(ne,Ne).splice(n,1)},it=new WeakSet,qt=function(){return this.xrFrame||this.engine.xr.frame},cn=new WeakSet,Os=async function(){var e;if(!K(this,it,qt).call(this).createAnchor)throw new Error("Cannot create anchor - anchors not supported, did you enable the 'anchors' WebXR feature?");if(this.xrHitResult){if(this.xrHitResult.createAnchor===void 0)throw new Error("Requested anchor on XRHitTestResult, but WebXR hit-test feature is not available.");return this.xrHitResult.createAnchor()}else{this.object.getTranslationWorld(kt),Mi.set(this.object.rotationWorld);const n=Mi,s=new XRRigidTransform({x:kt[0],y:kt[1],z:kt[2]},{x:n[0],y:n[1],z:n[2],w:n[3]});return(e=K(this,it,qt).call(this))==null?void 0:e.createAnchor(s,this.engine.xr.currentReferenceSpace)}},_n=new WeakSet,Is=function(e){if(e){if(this.persist)if(e.requestPersistentHandle!==void 0){e.requestPersistentHandle().then(n=>{var s;this.uuid=n,K(this,st,Gt).call(this,e),K(s=ne,an,ks).call(s,this)});return}else console.warn("anchor: Persistent anchors are not supported by your client. Ignoring persist property.");K(this,st,Gt).call(this,e)}},hn=new WeakSet,Ds=function(e){K(this,st,Gt).call(this,e)},st=new WeakSet,Gt=function(e){this.xrAnchor=e,this.onCreate.notify(this)},G(ne,an),G(ne,ln),u(ne,"TypeName","anchor"),G(ne,Ne,[]);let on=ne;Rs([j.bool(!1)],on.prototype,"persist",void 0);Rs([j.string()],on.prototype,"uuid",void 0);class Wn extends k{constructor(){super(...arguments);u(this,"onHover",new H);u(this,"onUnhover",new H);u(this,"onClick",new H);u(this,"onMove",new H);u(this,"onDown",new H);u(this,"onUp",new H)}addHoverFunction(e){this.onHover.add(e)}removeHoverFunction(e){this.onHover.remove(e)}addUnHoverFunction(e){this.onUnhover.add(e)}removeUnHoverFunction(e){this.onUnhover.remove(e)}addClickFunction(e){this.onClick.add(e)}removeClickFunction(e){this.onClick.remove(e)}addMoveFunction(e){this.onMove.add(e)}removeMoveFunction(e){this.onMove.remove(e)}addDownFunction(e){this.onDown.add(e)}removeDownFunction(e){this.onDown.remove(e)}addUpFunction(e){this.onUp.add(e)}removeUpFunction(e){this.onUp.remove(e)}}u(Wn,"TypeName","cursor-target"),u(Wn,"Properties",{});var Zt=1e-6,se=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});function ao(){var i=new se(9);return se!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function lo(){var i=new se(16);return se!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i}function co(i,t){var e=t[0],n=t[1],s=t[2],o=t[3],a=t[4],c=t[5],_=t[6],d=t[7],p=t[8],r=t[9],l=t[10],h=t[11],f=t[12],w=t[13],m=t[14],g=t[15],y=e*c-n*a,v=e*_-s*a,S=e*d-o*a,F=n*_-s*c,C=n*d-o*c,R=s*d-o*_,T=p*w-r*f,x=p*m-l*f,A=p*g-h*f,O=r*m-l*w,D=r*g-h*w,z=l*g-h*m,L=y*z-v*D+S*O+F*A-C*x+R*T;return L?(L=1/L,i[0]=(c*z-_*D+d*O)*L,i[1]=(s*D-n*z-o*O)*L,i[2]=(w*R-m*C+g*F)*L,i[3]=(l*C-r*R-h*F)*L,i[4]=(_*A-a*z-d*x)*L,i[5]=(e*z-s*A+o*x)*L,i[6]=(m*S-f*R-g*v)*L,i[7]=(p*R-l*S+h*v)*L,i[8]=(a*D-c*A+d*T)*L,i[9]=(n*A-e*D-o*T)*L,i[10]=(f*C-w*S+g*y)*L,i[11]=(r*S-p*C-h*y)*L,i[12]=(c*x-a*O-_*T)*L,i[13]=(e*O-n*x+s*T)*L,i[14]=(w*v-f*F-m*y)*L,i[15]=(p*F-r*v+l*y)*L,i):null}function B(){var i=new se(3);return se!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function We(i){var t=i[0],e=i[1],n=i[2];return Math.hypot(t,e,n)}function Pi(i,t,e){var n=new se(3);return n[0]=i,n[1]=t,n[2]=e,n}function oe(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i}function Qt(i,t,e,n){return i[0]=t,i[1]=e,i[2]=n,i}function He(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i}function Hs(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i}function _o(i,t,e){return i[0]=t[0]/e[0],i[1]=t[1]/e[1],i[2]=t[2]/e[2],i}function Re(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i}function ut(i,t,e,n){return i[0]=t[0]+e[0]*n,i[1]=t[1]+e[1]*n,i[2]=t[2]+e[2]*n,i}function Bs(i,t){var e=t[0]-i[0],n=t[1]-i[1],s=t[2]-i[2];return Math.hypot(e,n,s)}function ho(i,t){var e=t[0]-i[0],n=t[1]-i[1],s=t[2]-i[2];return e*e+n*n+s*s}function Fi(i){var t=i[0],e=i[1],n=i[2];return t*t+e*e+n*n}function N(i,t){var e=t[0],n=t[1],s=t[2],o=e*e+n*n+s*s;return o>0&&(o=1/Math.sqrt(o)),i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i}function ke(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]}function $e(i,t,e){var n=t[0],s=t[1],o=t[2],a=e[0],c=e[1],_=e[2];return i[0]=s*_-o*c,i[1]=o*a-n*_,i[2]=n*c-s*a,i}function uo(i,t,e,n){var s=t[0],o=t[1],a=t[2];return i[0]=s+n*(e[0]-s),i[1]=o+n*(e[1]-o),i[2]=a+n*(e[2]-a),i}function po(i,t,e){var n=t[0],s=t[1],o=t[2],a=e[3]*n+e[7]*s+e[11]*o+e[15];return a=a||1,i[0]=(e[0]*n+e[4]*s+e[8]*o+e[12])/a,i[1]=(e[1]*n+e[5]*s+e[9]*o+e[13])/a,i[2]=(e[2]*n+e[6]*s+e[10]*o+e[14])/a,i}function Je(i,t,e){var n=e[0],s=e[1],o=e[2],a=e[3],c=t[0],_=t[1],d=t[2],p=s*d-o*_,r=o*c-n*d,l=n*_-s*c,h=s*l-o*r,f=o*p-n*l,w=n*r-s*p,m=a*2;return p*=m,r*=m,l*=m,h*=2,f*=2,w*=2,i[0]=c+p+h,i[1]=_+r+f,i[2]=d+l+w,i}function fo(i){return i[0]=0,i[1]=0,i[2]=0,i}function Ci(i,t){var e=i[0],n=i[1],s=i[2],o=t[0],a=t[1],c=t[2];return Math.abs(e-o)<=Zt*Math.max(1,Math.abs(e),Math.abs(o))&&Math.abs(n-a)<=Zt*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(s-c)<=Zt*Math.max(1,Math.abs(s),Math.abs(c))}var Q=Hs,Ei=_o,mo=Bs,go=ho,wo=We;(function(){var i=B();return function(t,e,n,s,o,a){var c,_;for(e||(e=3),n||(n=0),s?_=Math.min(s*e+n,t.length):_=t.length,c=n;c<_;c+=e)i[0]=t[c],i[1]=t[c+1],i[2]=t[c+2],o(i,i,a),t[c]=i[0],t[c+1]=i[1],t[c+2]=i[2];return t}})();function yo(){var i=new se(4);return se!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function vo(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i}function bo(i){var t=i[0],e=i[1],n=i[2],s=i[3];return t*t+e*e+n*n+s*s}function xo(i,t){var e=t[0],n=t[1],s=t[2],o=t[3],a=e*e+n*n+s*s+o*o;return a>0&&(a=1/Math.sqrt(a)),i[0]=e*a,i[1]=n*a,i[2]=s*a,i[3]=o*a,i}function Ao(i,t,e,n){var s=t[0],o=t[1],a=t[2],c=t[3];return i[0]=s+n*(e[0]-s),i[1]=o+n*(e[1]-o),i[2]=a+n*(e[2]-a),i[3]=c+n*(e[3]-c),i}(function(){var i=yo();return function(t,e,n,s,o,a){var c,_;for(e||(e=4),n||(n=0),s?_=Math.min(s*e+n,t.length):_=t.length,c=n;c<_;c+=e)i[0]=t[c],i[1]=t[c+1],i[2]=t[c+2],i[3]=t[c+3],o(i,i,a),t[c]=i[0],t[c+1]=i[1],t[c+2]=i[2],t[c+3]=i[3];return t}})();function ie(){var i=new se(4);return se!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function ji(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function So(i,t,e){e=e*.5;var n=Math.sin(e);return i[0]=n*t[0],i[1]=n*t[1],i[2]=n*t[2],i[3]=Math.cos(e),i}function Be(i,t,e){var n=t[0],s=t[1],o=t[2],a=t[3],c=e[0],_=e[1],d=e[2],p=e[3];return i[0]=n*p+a*c+s*d-o*_,i[1]=s*p+a*_+o*c-n*d,i[2]=o*p+a*d+n*_-s*c,i[3]=a*p-n*c-s*_-o*d,i}function Yt(i,t,e,n){var s=t[0],o=t[1],a=t[2],c=t[3],_=e[0],d=e[1],p=e[2],r=e[3],l,h,f,w,m;return h=s*_+o*d+a*p+c*r,h<0&&(h=-h,_=-_,d=-d,p=-p,r=-r),1-h>Zt?(l=Math.acos(h),f=Math.sin(l),w=Math.sin((1-n)*l)/f,m=Math.sin(n*l)/f):(w=1-n,m=n),i[0]=w*s+m*_,i[1]=w*o+m*d,i[2]=w*a+m*p,i[3]=w*c+m*r,i}function Lt(i,t){var e=t[0],n=t[1],s=t[2],o=t[3],a=e*e+n*n+s*s+o*o,c=a?1/a:0;return i[0]=-e*c,i[1]=-n*c,i[2]=-s*c,i[3]=o*c,i}function To(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i[3]=t[3],i}function Mo(i,t){var e=t[0]+t[4]+t[8],n;if(e>0)n=Math.sqrt(e+1),i[3]=.5*n,n=.5/n,i[0]=(t[5]-t[7])*n,i[1]=(t[6]-t[2])*n,i[2]=(t[1]-t[3])*n;else{var s=0;t[4]>t[0]&&(s=1),t[8]>t[s*3+s]&&(s=2);var o=(s+1)%3,a=(s+2)%3;n=Math.sqrt(t[s*3+s]-t[o*3+o]-t[a*3+a]+1),i[s]=.5*n,n=.5/n,i[3]=(t[o*3+a]-t[a*3+o])*n,i[o]=(t[o*3+s]+t[s*3+o])*n,i[a]=(t[a*3+s]+t[s*3+a])*n}return i}function Ri(i,t,e,n){var s=.5*Math.PI/180;t*=s,e*=s,n*=s;var o=Math.sin(t),a=Math.cos(t),c=Math.sin(e),_=Math.cos(e),d=Math.sin(n),p=Math.cos(n);return i[0]=o*_*p-a*c*d,i[1]=a*c*p+o*_*d,i[2]=a*_*d-o*c*p,i[3]=a*_*p+o*c*d,i}var Ot=vo,we=Be,Po=Ao,Fo=bo,ii=xo,Mn=function(){var i=B(),t=Pi(1,0,0),e=Pi(0,1,0);return function(n,s,o){var a=ke(s,o);return a<-.999999?($e(i,t,s),wo(i)<1e-6&&$e(i,e,s),N(i,i),So(n,i,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):($e(i,s,o),n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=1+a,ii(n,n))}}();(function(){var i=ie(),t=ie();return function(e,n,s,o,a,c){return Yt(i,n,a,c),Yt(t,s,o,c),Yt(e,i,t,2*c*(1-c)),e}})();(function(){var i=ao();return function(t,e,n,s){return i[0]=n[0],i[3]=n[1],i[6]=n[2],i[1]=s[0],i[4]=s[1],i[7]=s[2],i[2]=-e[0],i[5]=-e[1],i[8]=-e[2],ii(t,Mo(t,i))}})();function ki(){var i=new se(8);return se!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[4]=0,i[5]=0,i[6]=0,i[7]=0),i[3]=1,i}function Co(i,t){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i[4]=t[0]*.5,i[5]=t[1]*.5,i[6]=t[2]*.5,i[7]=0,i}function Us(i,t){var e=t[4],n=t[5],s=t[6],o=t[7],a=-t[0],c=-t[1],_=-t[2],d=t[3];return i[0]=(e*d+o*a+n*_-s*c)*2,i[1]=(n*d+o*c+s*a-e*_)*2,i[2]=(s*d+o*_+e*c-n*a)*2,i}function Eo(i,t,e){var n=t[0],s=t[1],o=t[2],a=t[3],c=e[4],_=e[5],d=e[6],p=e[7],r=t[4],l=t[5],h=t[6],f=t[7],w=e[0],m=e[1],g=e[2],y=e[3];return i[0]=n*y+a*w+s*g-o*m,i[1]=s*y+a*m+o*w-n*g,i[2]=o*y+a*g+n*m-s*w,i[3]=a*y-n*w-s*m-o*g,i[4]=n*p+a*c+s*d-o*_+r*y+f*w+l*g-h*m,i[5]=s*p+a*_+o*c-n*d+l*y+f*m+h*w-r*g,i[6]=o*p+a*d+n*_-s*c+h*y+f*g+r*m-l*w,i[7]=a*p-n*c-s*_-o*d+f*y-r*w-l*m-h*g,i}function jo(i,t){var e=Ro(t);return i[0]=-t[0]/e,i[1]=-t[1]/e,i[2]=-t[2]/e,i[3]=t[3]/e,i[4]=-t[4]/e,i[5]=-t[5]/e,i[6]=-t[6]/e,i[7]=t[7]/e,i}var Ro=Fo,ko=function(i,t,e,n){var s=arguments.length,o=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,t,e,n);else for(var c=i.length-1;c>=0;c--)(a=i[c])&&(o=(s<3?a(o):s>3?a(t,e,o):a(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};class wt extends k{constructor(){super(...arguments);u(this,"tempScaling",new Float32Array(3));u(this,"visible",!1);u(this,"xrHitTestSource",null);u(this,"xrReferenceSpace",null);u(this,"scaleObject",!0);u(this,"onHitLost",new H);u(this,"onHitFound",new H);u(this,"onSessionStartCallback",null);u(this,"onSessionEndCallback",null)}start(){this.onSessionStartCallback=this.onXRSessionStart.bind(this),this.onSessionEndCallback=this.onXRSessionEnd.bind(this),this.scaleObject&&(this.tempScaling.set(this.object.scalingLocal),this.object.scale([0,0,0]),this.onHitLost.add(()=>{this.tempScaling.set(this.object.scalingLocal),this.object.scale([0,0,0])}),this.onHitFound.add(()=>{this.object.scalingLocal.set(this.tempScaling),this.object.setDirty()}))}onActivate(){this.engine.onXRSessionStart.add(this.onSessionStartCallback),this.engine.onXRSessionEnd.add(this.onSessionEndCallback)}onDeactivate(){this.engine.onXRSessionStart.remove(this.onSessionStartCallback),this.engine.onXRSessionEnd.remove(this.onSessionEndCallback)}update(){const e=this.visible;if(this.xrHitTestSource){const n=this.engine.xrFrame;if(!n)return;let s=n.getHitTestResults(this.xrHitTestSource);if(s.length>0){let o=s[0].getPose(this.engine.xr.currentReferenceSpace);this.visible=!!o,o&&wn(this.object,o.transform)}else this.visible=!1}this.visible!=e&&(this.visible?this.onHitFound:this.onHitLost).notify(this)}getHitTestResults(e=(n=>(n=this.engine.xr)==null?void 0:n.frame)()??null){return e?this.xrHitTestSource?e.getHitTestResults(this.xrHitTestSource):[]:[]}onXRSessionStart(e){if(e.requestHitTestSource===void 0){console.error("hit-test-location: hit test feature not available. Deactivating component."),this.active=!1;return}e.requestHitTestSource({space:this.xrReferenceSpace??this.engine.xr.referenceSpaceForType("viewer")}).then(n=>{this.xrHitTestSource=n}).catch(console.error)}onXRSessionEnd(){this.xrHitTestSource&&(this.xrHitTestSource.cancel(),this.xrHitTestSource=null)}}u(wt,"TypeName","hit-test-location");ko([j.bool(!0)],wt.prototype,"scaleObject",void 0);var Pe=function(i,t,e,n){var s=arguments.length,o=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,t,e,n);else for(var c=i.length-1;c>=0;c--)(a=i[c])&&(o=(s<3?a(o):s>3?a(t,e,o):a(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};const Ce=new Float32Array(3),Lo=[0,0,0];class Li{constructor(){u(this,"onHover",new H);u(this,"onUnhover",new H);u(this,"onClick",new H);u(this,"onMove",new H);u(this,"onDown",new H);u(this,"onUp",new H)}}class he extends k{constructor(){super(...arguments);u(this,"_collisionMask",0);u(this,"_onDeactivateCallbacks",[]);u(this,"_input",null);u(this,"_origin",new Float32Array(3));u(this,"_cursorObjScale",new Float32Array(3));u(this,"_direction",new Float32Array(3));u(this,"_projectionMatrix",new Float32Array(16));u(this,"_viewComponent",null);u(this,"_isDown",!1);u(this,"_lastIsDown",!1);u(this,"_arTouchDown",!1);u(this,"_lastPointerPos",new Float32Array(2));u(this,"_lastCursorPosOnTarget",new Float32Array(3));u(this,"_hitTestLocation",null);u(this,"_hitTestObject",null);u(this,"_onSessionStartCallback",null);u(this,"visible",!0);u(this,"hoveringObject",null);u(this,"hoveringObjectTarget",null);u(this,"hoveringReality",!1);u(this,"globalTarget",new Li);u(this,"hitTestTarget",new Li);u(this,"cursorPos",new Float32Array(3));u(this,"collisionGroup",1);u(this,"cursorRayObject",null);u(this,"cursorRayScalingAxis",2);u(this,"cursorObject",null);u(this,"handedness",0);u(this,"rayCastMode",0);u(this,"maxDistance",100);u(this,"styleCursor",!0);u(this,"useWebXRHitTest",!1);u(this,"_onViewportResize",()=>{this._viewComponent&&co(this._projectionMatrix,this._viewComponent.projectionMatrix)})}static onRegister(e){e.registerComponent(wt)}start(){if(this._collisionMask=1<<this.collisionGroup,this.handedness==0){const e=this.object.getComponent("input");e?(this.handedness=e.handedness||"none",this._input=e):console.warn("cursor component on object",this.object.name,'was configured with handedness "input component", but object has no input component.')}else this.handedness=["left","right","none"][this.handedness-1];this._viewComponent=this.object.getComponent(Te),this.useWebXRHitTest&&(this._hitTestObject=this.engine.scene.addObject(this.object),this._hitTestLocation=this._hitTestObject.addComponent(wt,{scaleObject:!1})??null),this._onSessionStartCallback=this.setupVREvents.bind(this)}onActivate(){if(this.engine.onXRSessionStart.add(this._onSessionStartCallback),this.engine.onResize.add(this._onViewportResize),this._setCursorVisibility(!0),this._viewComponent!=null){const e=this.engine.canvas,n=this.onClick.bind(this),s=this.onPointerMove.bind(this),o=this.onPointerDown.bind(this),a=this.onPointerUp.bind(this);e.addEventListener("click",n),e.addEventListener("pointermove",s),e.addEventListener("pointerdown",o),e.addEventListener("pointerup",a),this._onDeactivateCallbacks.push(()=>{e.removeEventListener("click",n),e.removeEventListener("pointermove",s),e.removeEventListener("pointerdown",o),e.removeEventListener("pointerup",a)})}this._onViewportResize()}_setCursorRayTransform(e){if(!this.cursorRayObject)return;const n=mo(this._origin,e);this.cursorRayObject.setPositionLocal([0,0,-n/2]),this.cursorRayScalingAxis!=4&&(Ce.fill(1),Ce[this.cursorRayScalingAxis]=n/2,this.cursorRayObject.setScalingLocal(Ce))}_setCursorVisibility(e){this.visible!=e&&(this.visible=e,this.cursorObject&&(e?this.cursorObject.setScalingWorld(this._cursorObjScale):(this.cursorObject.getScalingWorld(this._cursorObjScale),this.cursorObject.scaleLocal([0,0,0]))))}update(){var e;if(this.engine.xr&&this._arTouchDown&&this._input&&this.engine.xr.session.inputSources[0].handedness==="none"&&this.engine.xr.session.inputSources[0].gamepad){const n=this.engine.xr.session.inputSources[0].gamepad.axes;this._direction[0]=n[0],this._direction[1]=-n[1],this._direction[2]=-1,this.applyTransformAndProjectDirection()}else this.engine.xr&&this._input&&this._input.xrInputSource?(this._direction[0]=0,this._direction[1]=0,this._direction[2]=-1,this.applyTransformToDirection()):this._viewComponent&&this.updateDirection();this.rayCast(null,(e=this.engine.xr)==null?void 0:e.frame),this.cursorObject&&(this.hoveringObject&&(this.cursorPos[0]!=0||this.cursorPos[1]!=0||this.cursorPos[2]!=0)?(this._setCursorVisibility(!0),this.cursorObject.setPositionWorld(this.cursorPos),this._setCursorRayTransform(this.cursorPos)):this._setCursorVisibility(!1))}notify(e,n){const s=this.hoveringObject;if(s){const o=this.hoveringObjectTarget;o&&o[e].notify(s,this,n??void 0),this.globalTarget[e].notify(s,this,n??void 0)}}hoverBehaviour(e,n,s,o){const a=!this.hoveringReality&&e.hitCount>0?e.objects[0]:null;a?(!this.hoveringObject||!this.hoveringObject.equals(a))&&(this.hoveringObject&&this.notify("onUnhover",o),this.hoveringObject=a,this.hoveringObjectTarget=this.hoveringObject.getComponent(Wn),this.styleCursor&&(this.engine.canvas.style.cursor="pointer"),this.notify("onHover",o)):this.hoveringObject&&(this.notify("onUnhover",o),this.hoveringObject=null,this.hoveringObjectTarget=null,this.styleCursor&&(this.engine.canvas.style.cursor="default")),this.hoveringObject?(this._isDown!==this._lastIsDown&&this.notify(this._isDown?"onDown":"onUp",o),s&&this.notify("onClick",o)):this.hoveringReality&&(this._isDown!==this._lastIsDown&&(this._isDown?this.hitTestTarget.onDown:this.hitTestTarget.onUp).notify(n,this,o??void 0),s&&this.hitTestTarget.onClick.notify(n,this,o??void 0)),a?(this.hoveringObject?this.hoveringObject.transformPointInverseWorld(Ce,this.cursorPos):Ce.set(this.cursorPos),Ci(this._lastCursorPosOnTarget,Ce)||(this.notify("onMove",o),this._lastCursorPosOnTarget.set(Ce))):this.hoveringReality?Ci(this._lastCursorPosOnTarget,this.cursorPos)||(this.hitTestTarget.onMove.notify(n,this,o??void 0),this._lastCursorPosOnTarget.set(this.cursorPos)):this._lastCursorPosOnTarget.set(this.cursorPos),this._lastIsDown=this._isDown}setupVREvents(e){if(e||console.error("setupVREvents called without a valid session"),!this.active)return;const n=this.onSelect.bind(this);e.addEventListener("select",n);const s=this.onSelectStart.bind(this);e.addEventListener("selectstart",s);const o=this.onSelectEnd.bind(this);e.addEventListener("selectend",o),this._onDeactivateCallbacks.push(()=>{this.engine.xr&&(e.removeEventListener("select",n),e.removeEventListener("selectstart",s),e.removeEventListener("selectend",o))}),this._onViewportResize()}onDeactivate(){this.engine.onXRSessionStart.remove(this._onSessionStartCallback),this.engine.onResize.remove(this._onViewportResize),this._setCursorVisibility(!1),this.hoveringObject&&this.notify("onUnhover",null),this.cursorRayObject&&this.cursorRayObject.setScalingLocal(Lo);for(const e of this._onDeactivateCallbacks)e();this._onDeactivateCallbacks.length=0}onDestroy(){var e;(e=this._hitTestObject)==null||e.destroy()}onSelect(e){e.inputSource.handedness==this.handedness&&this.rayCast(e,e.frame,!0)}onSelectStart(e){this._arTouchDown=!0,e.inputSource.handedness==this.handedness&&(this._isDown=!0,this.rayCast(e,e.frame))}onSelectEnd(e){this._arTouchDown=!1,e.inputSource.handedness==this.handedness&&(this._isDown=!1,this.rayCast(e,e.frame))}onPointerMove(e){e.isPrimary&&(this.updateMousePos(e),this.rayCast(e,null))}onClick(e){this.updateMousePos(e),this.rayCast(e,null,!0)}onPointerDown(e){!e.isPrimary||e.button!==0||(this.updateMousePos(e),this._isDown=!0,this.rayCast(e))}onPointerUp(e){!e.isPrimary||e.button!==0||(this.updateMousePos(e),this._isDown=!1,this.rayCast(e))}updateMousePos(e){this._lastPointerPos[0]=e.clientX,this._lastPointerPos[1]=e.clientY,this.updateDirection()}updateDirection(){const e=this.engine.canvas.getBoundingClientRect(),n=this._lastPointerPos[0]/e.width,s=this._lastPointerPos[1]/e.height;this._direction[0]=n*2-1,this._direction[1]=-s*2+1,this._direction[2]=-1,this.applyTransformAndProjectDirection()}applyTransformAndProjectDirection(){po(this._direction,this._direction,this._projectionMatrix),N(this._direction,this._direction),this.applyTransformToDirection()}applyTransformToDirection(){this.object.transformVectorWorld(this._direction,this._direction),this.object.getPositionWorld(this._origin)}rayCast(e,n=null,s=!1){var d,p;const o=this.rayCastMode==0?this.engine.scene.rayCast(this._origin,this._direction,this._collisionMask):this.engine.physics.rayCast(this._origin,this._direction,this._collisionMask,this.maxDistance);let a=1/0,c=null;(d=this._hitTestLocation)!=null&&d.visible&&(this._hitTestObject.getPositionWorld(this.cursorPos),a=Bs(this.object.getPositionWorld(Ce),this.cursorPos),c=(p=this._hitTestLocation)==null?void 0:p.getHitTestResults(n)[0]);let _=!1;if(o.hitCount>0){const r=o.distances[0];a>=r?this.cursorPos.set(o.locations[0]):_=!0}else a<1/0||this.cursorPos.fill(0);return _&&!this.hoveringReality?this.hitTestTarget.onHover.notify(c,this):!_&&this.hoveringReality&&this.hitTestTarget.onUnhover.notify(c,this),this.hoveringReality=_,this.hoverBehaviour(o,c,s,e),o}}u(he,"TypeName","cursor"),u(he,"Dependencies",[wt]);Pe([j.int(1)],he.prototype,"collisionGroup",void 0);Pe([j.object()],he.prototype,"cursorRayObject",void 0);Pe([j.enum(["x","y","z","none"],"z")],he.prototype,"cursorRayScalingAxis",void 0);Pe([j.object()],he.prototype,"cursorObject",void 0);Pe([j.enum(["input component","left","right","none"],"input component")],he.prototype,"handedness",void 0);Pe([j.enum(["collision","physx"],"collision")],he.prototype,"rayCastMode",void 0);Pe([j.float(100)],he.prototype,"maxDistance",void 0);Pe([j.bool(!0)],he.prototype,"styleCursor",void 0);Pe([j.bool(!1)],he.prototype,"useWebXRHitTest",void 0);var Oo=function(i,t,e,n){var s=arguments.length,o=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,t,e,n);else for(var c=i.length-1;c>=0;c--)(a=i[c])&&(o=(s<3?a(o):s>3?a(t,e,o):a(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};class Vs extends k{constructor(){super(...arguments);u(this,"obj",null)}start(){var n;let e=new Float32Array(3);Us(e,this.object.transformWorld),console.log("Debug object:",this.object.name),console.log("Other object:",(n=this.obj)==null?void 0:n.name),console.log("	translation",e),console.log("	transformWorld",this.object.transformWorld),console.log("	transformLocal",this.object.transformLocal)}}u(Vs,"TypeName","debug-object");Oo([j.object()],Vs.prototype,"obj",void 0);class Oi extends k{start(){this.onSessionStartCallback=this.setFixedFoveation.bind(this)}onActivate(){this.engine.onXRSessionStart.add(this.onSessionStartCallback)}onDeactivate(){this.engine.onXRSessionStart.remove(this.onSessionStartCallback)}setFixedFoveation(){this.engine.xr.baseLayer.fixedFoveation=this.fixedFoveation}}u(Oi,"TypeName","fixed-foveation"),u(Oi,"Properties",{fixedFoveation:{type:b.Float,default:.5}});var ct=function(i,t,e,n){var s=arguments.length,o=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,t,e,n);else for(var c=i.length-1;c>=0;c--)(a=i[c])&&(o=(s<3?a(o):s>3?a(t,e,o):a(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};const Ee=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"],It=B(),Dt=ie(),Ii=B(),Di=B();class De extends k{constructor(){super(...arguments);u(this,"handedness",0);u(this,"jointMesh",null);u(this,"jointMaterial",null);u(this,"handSkin",null);u(this,"deactivateChildrenWithoutPose",!0);u(this,"controllerToDeactivate",null);u(this,"joints",{});u(this,"session",null);u(this,"hasPose",!1);u(this,"_childrenActive",!0)}init(){this.handedness=["left","right"][this.handedness]}start(){if(!("XRHand"in window)){console.warn("WebXR Hand Tracking not supported by this browser."),this.active=!1;return}if(this.handSkin){const s=this.handSkin.jointIds;this.joints[Ee[0]]=this.engine.wrapObject(s[0]);for(let o=0;o<s.length;++o){const a=this.engine.wrapObject(s[o]);this.joints[a.name]=a}return}const e=this.engine.scene.addObjects(Ee.length,this.object,Ee.length);for(let n=0;n<Ee.length;++n){const s=e[n];s.addComponent(_e,{mesh:this.jointMesh,material:this.jointMaterial}),this.joints[Ee[n]]=s,s.name=Ee[n]}}update(e){if(this.engine.xr){if(this.hasPose=!1,this.engine.xr.session.inputSources)for(let n=0;n<this.engine.xr.session.inputSources.length;++n){const s=this.engine.xr.session.inputSources[n];if(!(s!=null&&s.hand)||(s==null?void 0:s.handedness)!=this.handedness)continue;const o=s.hand.get("wrist");if(o){const a=this.engine.xr.frame.getJointPose(o,this.engine.xr.currentReferenceSpace);a&&wn(this.object,a.transform)}this.object.getRotationLocal(Dt),To(Dt,Dt),this.object.getPositionLocal(It),this.joints.wrist.resetTransform();for(let a=0;a<Ee.length;++a){const c=Ee[a],_=this.joints[c];if(!_)continue;let d=null;const p=s.hand.get(c);if(p&&(d=this.engine.xr.frame.getJointPose(p,this.engine.xr.currentReferenceSpace)),d&&(this.hasPose=!0,_.resetPositionRotation(),_.translateLocal([d.transform.position.x-It[0],d.transform.position.y-It[1],d.transform.position.z-It[2]]),_.rotateLocal(Dt),_.rotateObject([d.transform.orientation.x,d.transform.orientation.y,d.transform.orientation.z,d.transform.orientation.w]),!this.handSkin)){const r=d.radius||.007;_.setScalingLocal([r,r,r])}}}!this.hasPose&&this._childrenActive?(this._childrenActive=!1,this.deactivateChildrenWithoutPose&&this.setChildrenActive(!1),this.controllerToDeactivate&&(this.controllerToDeactivate.active=!0,this.setChildrenActive(!0,this.controllerToDeactivate))):this.hasPose&&!this._childrenActive&&(this._childrenActive=!0,this.deactivateChildrenWithoutPose&&this.setChildrenActive(!0),this.controllerToDeactivate&&(this.controllerToDeactivate.active=!1,this.setChildrenActive(!1,this.controllerToDeactivate)))}}setChildrenActive(e,n){n=n||this.object;const s=n.children;for(const o of s)o.active=e,this.setChildrenActive(e,o)}isGrabbing(){return this.joints["index-finger-tip"].getPositionLocal(Ii),this.joints["thumb-tip"].getPositionLocal(Di),go(Ii,Di)<.001}}u(De,"TypeName","hand-tracking");ct([j.enum(["left","right"])],De.prototype,"handedness",void 0);ct([j.mesh()],De.prototype,"jointMesh",void 0);ct([j.material()],De.prototype,"jointMaterial",void 0);ct([j.skin()],De.prototype,"handSkin",void 0);ct([j.bool(!0)],De.prototype,"deactivateChildrenWithoutPose",void 0);ct([j.object()],De.prototype,"controllerToDeactivate",void 0);var dt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Io(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Do={};/*!
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(i){(function(){var t=function(){this.init()};t.prototype={init:function(){var r=this||e;return r._counter=1e3,r._html5AudioPool=[],r.html5PoolSize=10,r._codecs={},r._howls=[],r._muted=!1,r._volume=1,r._canPlayEvent="canplaythrough",r._navigator=typeof window<"u"&&window.navigator?window.navigator:null,r.masterGain=null,r.noAudio=!1,r.usingWebAudio=!0,r.autoSuspend=!0,r.ctx=null,r.autoUnlock=!0,r._setup(),r},volume:function(r){var l=this||e;if(r=parseFloat(r),l.ctx||p(),typeof r<"u"&&r>=0&&r<=1){if(l._volume=r,l._muted)return l;l.usingWebAudio&&l.masterGain.gain.setValueAtTime(r,e.ctx.currentTime);for(var h=0;h<l._howls.length;h++)if(!l._howls[h]._webAudio)for(var f=l._howls[h]._getSoundIds(),w=0;w<f.length;w++){var m=l._howls[h]._soundById(f[w]);m&&m._node&&(m._node.volume=m._volume*r)}return l}return l._volume},mute:function(r){var l=this||e;l.ctx||p(),l._muted=r,l.usingWebAudio&&l.masterGain.gain.setValueAtTime(r?0:l._volume,e.ctx.currentTime);for(var h=0;h<l._howls.length;h++)if(!l._howls[h]._webAudio)for(var f=l._howls[h]._getSoundIds(),w=0;w<f.length;w++){var m=l._howls[h]._soundById(f[w]);m&&m._node&&(m._node.muted=r?!0:m._muted)}return l},stop:function(){for(var r=this||e,l=0;l<r._howls.length;l++)r._howls[l].stop();return r},unload:function(){for(var r=this||e,l=r._howls.length-1;l>=0;l--)r._howls[l].unload();return r.usingWebAudio&&r.ctx&&typeof r.ctx.close<"u"&&(r.ctx.close(),r.ctx=null,p()),r},codecs:function(r){return(this||e)._codecs[r.replace(/^x-/,"")]},_setup:function(){var r=this||e;if(r.state=r.ctx&&r.ctx.state||"suspended",r._autoSuspend(),!r.usingWebAudio)if(typeof Audio<"u")try{var l=new Audio;typeof l.oncanplaythrough>"u"&&(r._canPlayEvent="canplay")}catch{r.noAudio=!0}else r.noAudio=!0;try{var l=new Audio;l.muted&&(r.noAudio=!0)}catch{}return r.noAudio||r._setupCodecs(),r},_setupCodecs:function(){var r=this||e,l=null;try{l=typeof Audio<"u"?new Audio:null}catch{return r}if(!l||typeof l.canPlayType!="function")return r;var h=l.canPlayType("audio/mpeg;").replace(/^no$/,""),f=r._navigator?r._navigator.userAgent:"",w=f.match(/OPR\/(\d+)/g),m=w&&parseInt(w[0].split("/")[1],10)<33,g=f.indexOf("Safari")!==-1&&f.indexOf("Chrome")===-1,y=f.match(/Version\/(.*?) /),v=g&&y&&parseInt(y[1],10)<15;return r._codecs={mp3:!!(!m&&(h||l.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!h,opus:!!l.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!l.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!l.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(l.canPlayType('audio/wav; codecs="1"')||l.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!l.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!l.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(l.canPlayType("audio/x-m4a;")||l.canPlayType("audio/m4a;")||l.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(l.canPlayType("audio/x-m4b;")||l.canPlayType("audio/m4b;")||l.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(l.canPlayType("audio/x-mp4;")||l.canPlayType("audio/mp4;")||l.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!v&&l.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!v&&l.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!l.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(l.canPlayType("audio/x-flac;")||l.canPlayType("audio/flac;")).replace(/^no$/,"")},r},_unlockAudio:function(){var r=this||e;if(!(r._audioUnlocked||!r.ctx)){r._audioUnlocked=!1,r.autoUnlock=!1,!r._mobileUnloaded&&r.ctx.sampleRate!==44100&&(r._mobileUnloaded=!0,r.unload()),r._scratchBuffer=r.ctx.createBuffer(1,1,22050);var l=function(h){for(;r._html5AudioPool.length<r.html5PoolSize;)try{var f=new Audio;f._unlocked=!0,r._releaseHtml5Audio(f)}catch{r.noAudio=!0;break}for(var w=0;w<r._howls.length;w++)if(!r._howls[w]._webAudio)for(var m=r._howls[w]._getSoundIds(),g=0;g<m.length;g++){var y=r._howls[w]._soundById(m[g]);y&&y._node&&!y._node._unlocked&&(y._node._unlocked=!0,y._node.load())}r._autoResume();var v=r.ctx.createBufferSource();v.buffer=r._scratchBuffer,v.connect(r.ctx.destination),typeof v.start>"u"?v.noteOn(0):v.start(0),typeof r.ctx.resume=="function"&&r.ctx.resume(),v.onended=function(){v.disconnect(0),r._audioUnlocked=!0,document.removeEventListener("touchstart",l,!0),document.removeEventListener("touchend",l,!0),document.removeEventListener("click",l,!0),document.removeEventListener("keydown",l,!0);for(var S=0;S<r._howls.length;S++)r._howls[S]._emit("unlock")}};return document.addEventListener("touchstart",l,!0),document.addEventListener("touchend",l,!0),document.addEventListener("click",l,!0),document.addEventListener("keydown",l,!0),r}},_obtainHtml5Audio:function(){var r=this||e;if(r._html5AudioPool.length)return r._html5AudioPool.pop();var l=new Audio().play();return l&&typeof Promise<"u"&&(l instanceof Promise||typeof l.then=="function")&&l.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(r){var l=this||e;return r._unlocked&&l._html5AudioPool.push(r),l},_autoSuspend:function(){var r=this;if(!(!r.autoSuspend||!r.ctx||typeof r.ctx.suspend>"u"||!e.usingWebAudio)){for(var l=0;l<r._howls.length;l++)if(r._howls[l]._webAudio){for(var h=0;h<r._howls[l]._sounds.length;h++)if(!r._howls[l]._sounds[h]._paused)return r}return r._suspendTimer&&clearTimeout(r._suspendTimer),r._suspendTimer=setTimeout(function(){if(r.autoSuspend){r._suspendTimer=null,r.state="suspending";var f=function(){r.state="suspended",r._resumeAfterSuspend&&(delete r._resumeAfterSuspend,r._autoResume())};r.ctx.suspend().then(f,f)}},3e4),r}},_autoResume:function(){var r=this;if(!(!r.ctx||typeof r.ctx.resume>"u"||!e.usingWebAudio))return r.state==="running"&&r.ctx.state!=="interrupted"&&r._suspendTimer?(clearTimeout(r._suspendTimer),r._suspendTimer=null):r.state==="suspended"||r.state==="running"&&r.ctx.state==="interrupted"?(r.ctx.resume().then(function(){r.state="running";for(var l=0;l<r._howls.length;l++)r._howls[l]._emit("resume")}),r._suspendTimer&&(clearTimeout(r._suspendTimer),r._suspendTimer=null)):r.state==="suspending"&&(r._resumeAfterSuspend=!0),r}};var e=new t,n=function(r){var l=this;if(!r.src||r.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}l.init(r)};n.prototype={init:function(r){var l=this;return e.ctx||p(),l._autoplay=r.autoplay||!1,l._format=typeof r.format!="string"?r.format:[r.format],l._html5=r.html5||!1,l._muted=r.mute||!1,l._loop=r.loop||!1,l._pool=r.pool||5,l._preload=typeof r.preload=="boolean"||r.preload==="metadata"?r.preload:!0,l._rate=r.rate||1,l._sprite=r.sprite||{},l._src=typeof r.src!="string"?r.src:[r.src],l._volume=r.volume!==void 0?r.volume:1,l._xhr={method:r.xhr&&r.xhr.method?r.xhr.method:"GET",headers:r.xhr&&r.xhr.headers?r.xhr.headers:null,withCredentials:r.xhr&&r.xhr.withCredentials?r.xhr.withCredentials:!1},l._duration=0,l._state="unloaded",l._sounds=[],l._endTimers={},l._queue=[],l._playLock=!1,l._onend=r.onend?[{fn:r.onend}]:[],l._onfade=r.onfade?[{fn:r.onfade}]:[],l._onload=r.onload?[{fn:r.onload}]:[],l._onloaderror=r.onloaderror?[{fn:r.onloaderror}]:[],l._onplayerror=r.onplayerror?[{fn:r.onplayerror}]:[],l._onpause=r.onpause?[{fn:r.onpause}]:[],l._onplay=r.onplay?[{fn:r.onplay}]:[],l._onstop=r.onstop?[{fn:r.onstop}]:[],l._onmute=r.onmute?[{fn:r.onmute}]:[],l._onvolume=r.onvolume?[{fn:r.onvolume}]:[],l._onrate=r.onrate?[{fn:r.onrate}]:[],l._onseek=r.onseek?[{fn:r.onseek}]:[],l._onunlock=r.onunlock?[{fn:r.onunlock}]:[],l._onresume=[],l._webAudio=e.usingWebAudio&&!l._html5,typeof e.ctx<"u"&&e.ctx&&e.autoUnlock&&e._unlockAudio(),e._howls.push(l),l._autoplay&&l._queue.push({event:"play",action:function(){l.play()}}),l._preload&&l._preload!=="none"&&l.load(),l},load:function(){var r=this,l=null;if(e.noAudio){r._emit("loaderror",null,"No audio support.");return}typeof r._src=="string"&&(r._src=[r._src]);for(var h=0;h<r._src.length;h++){var f,w;if(r._format&&r._format[h])f=r._format[h];else{if(w=r._src[h],typeof w!="string"){r._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}f=/^data:audio\/([^;,]+);/i.exec(w),f||(f=/\.([^.]+)$/.exec(w.split("?",1)[0])),f&&(f=f[1].toLowerCase())}if(f||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),f&&e.codecs(f)){l=r._src[h];break}}if(!l){r._emit("loaderror",null,"No codec support for selected audio sources.");return}return r._src=l,r._state="loading",window.location.protocol==="https:"&&l.slice(0,5)==="http:"&&(r._html5=!0,r._webAudio=!1),new s(r),r._webAudio&&a(r),r},play:function(r,l){var h=this,f=null;if(typeof r=="number")f=r,r=null;else{if(typeof r=="string"&&h._state==="loaded"&&!h._sprite[r])return null;if(typeof r>"u"&&(r="__default",!h._playLock)){for(var w=0,m=0;m<h._sounds.length;m++)h._sounds[m]._paused&&!h._sounds[m]._ended&&(w++,f=h._sounds[m]._id);w===1?r=null:f=null}}var g=f?h._soundById(f):h._inactiveSound();if(!g)return null;if(f&&!r&&(r=g._sprite||"__default"),h._state!=="loaded"){g._sprite=r,g._ended=!1;var y=g._id;return h._queue.push({event:"play",action:function(){h.play(y)}}),y}if(f&&!g._paused)return l||h._loadQueue("play"),g._id;h._webAudio&&e._autoResume();var v=Math.max(0,g._seek>0?g._seek:h._sprite[r][0]/1e3),S=Math.max(0,(h._sprite[r][0]+h._sprite[r][1])/1e3-v),F=S*1e3/Math.abs(g._rate),C=h._sprite[r][0]/1e3,R=(h._sprite[r][0]+h._sprite[r][1])/1e3;g._sprite=r,g._ended=!1;var T=function(){g._paused=!1,g._seek=v,g._start=C,g._stop=R,g._loop=!!(g._loop||h._sprite[r][2])};if(v>=R){h._ended(g);return}var x=g._node;if(h._webAudio){var A=function(){h._playLock=!1,T(),h._refreshBuffer(g);var L=g._muted||h._muted?0:g._volume;x.gain.setValueAtTime(L,e.ctx.currentTime),g._playStart=e.ctx.currentTime,typeof x.bufferSource.start>"u"?g._loop?x.bufferSource.noteGrainOn(0,v,86400):x.bufferSource.noteGrainOn(0,v,S):g._loop?x.bufferSource.start(0,v,86400):x.bufferSource.start(0,v,S),F!==1/0&&(h._endTimers[g._id]=setTimeout(h._ended.bind(h,g),F)),l||setTimeout(function(){h._emit("play",g._id),h._loadQueue()},0)};e.state==="running"&&e.ctx.state!=="interrupted"?A():(h._playLock=!0,h.once("resume",A),h._clearTimer(g._id))}else{var O=function(){x.currentTime=v,x.muted=g._muted||h._muted||e._muted||x.muted,x.volume=g._volume*e.volume(),x.playbackRate=g._rate;try{var L=x.play();if(L&&typeof Promise<"u"&&(L instanceof Promise||typeof L.then=="function")?(h._playLock=!0,T(),L.then(function(){h._playLock=!1,x._unlocked=!0,l?h._loadQueue():h._emit("play",g._id)}).catch(function(){h._playLock=!1,h._emit("playerror",g._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),g._ended=!0,g._paused=!0})):l||(h._playLock=!1,T(),h._emit("play",g._id)),x.playbackRate=g._rate,x.paused){h._emit("playerror",g._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}r!=="__default"||g._loop?h._endTimers[g._id]=setTimeout(h._ended.bind(h,g),F):(h._endTimers[g._id]=function(){h._ended(g),x.removeEventListener("ended",h._endTimers[g._id],!1)},x.addEventListener("ended",h._endTimers[g._id],!1))}catch(Ks){h._emit("playerror",g._id,Ks)}};x.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(x.src=h._src,x.load());var D=window&&window.ejecta||!x.readyState&&e._navigator.isCocoonJS;if(x.readyState>=3||D)O();else{h._playLock=!0,h._state="loading";var z=function(){h._state="loaded",O(),x.removeEventListener(e._canPlayEvent,z,!1)};x.addEventListener(e._canPlayEvent,z,!1),h._clearTimer(g._id)}}return g._id},pause:function(r){var l=this;if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"pause",action:function(){l.pause(r)}}),l;for(var h=l._getSoundIds(r),f=0;f<h.length;f++){l._clearTimer(h[f]);var w=l._soundById(h[f]);if(w&&!w._paused&&(w._seek=l.seek(h[f]),w._rateSeek=0,w._paused=!0,l._stopFade(h[f]),w._node))if(l._webAudio){if(!w._node.bufferSource)continue;typeof w._node.bufferSource.stop>"u"?w._node.bufferSource.noteOff(0):w._node.bufferSource.stop(0),l._cleanBuffer(w._node)}else(!isNaN(w._node.duration)||w._node.duration===1/0)&&w._node.pause();arguments[1]||l._emit("pause",w?w._id:null)}return l},stop:function(r,l){var h=this;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"stop",action:function(){h.stop(r)}}),h;for(var f=h._getSoundIds(r),w=0;w<f.length;w++){h._clearTimer(f[w]);var m=h._soundById(f[w]);m&&(m._seek=m._start||0,m._rateSeek=0,m._paused=!0,m._ended=!0,h._stopFade(f[w]),m._node&&(h._webAudio?m._node.bufferSource&&(typeof m._node.bufferSource.stop>"u"?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0),h._cleanBuffer(m._node)):(!isNaN(m._node.duration)||m._node.duration===1/0)&&(m._node.currentTime=m._start||0,m._node.pause(),m._node.duration===1/0&&h._clearSound(m._node))),l||h._emit("stop",m._id))}return h},mute:function(r,l){var h=this;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"mute",action:function(){h.mute(r,l)}}),h;if(typeof l>"u")if(typeof r=="boolean")h._muted=r;else return h._muted;for(var f=h._getSoundIds(l),w=0;w<f.length;w++){var m=h._soundById(f[w]);m&&(m._muted=r,m._interval&&h._stopFade(m._id),h._webAudio&&m._node?m._node.gain.setValueAtTime(r?0:m._volume,e.ctx.currentTime):m._node&&(m._node.muted=e._muted?!0:r),h._emit("mute",m._id))}return h},volume:function(){var r=this,l=arguments,h,f;if(l.length===0)return r._volume;if(l.length===1||l.length===2&&typeof l[1]>"u"){var w=r._getSoundIds(),m=w.indexOf(l[0]);m>=0?f=parseInt(l[0],10):h=parseFloat(l[0])}else l.length>=2&&(h=parseFloat(l[0]),f=parseInt(l[1],10));var g;if(typeof h<"u"&&h>=0&&h<=1){if(r._state!=="loaded"||r._playLock)return r._queue.push({event:"volume",action:function(){r.volume.apply(r,l)}}),r;typeof f>"u"&&(r._volume=h),f=r._getSoundIds(f);for(var y=0;y<f.length;y++)g=r._soundById(f[y]),g&&(g._volume=h,l[2]||r._stopFade(f[y]),r._webAudio&&g._node&&!g._muted?g._node.gain.setValueAtTime(h,e.ctx.currentTime):g._node&&!g._muted&&(g._node.volume=h*e.volume()),r._emit("volume",g._id))}else return g=f?r._soundById(f):r._sounds[0],g?g._volume:0;return r},fade:function(r,l,h,f){var w=this;if(w._state!=="loaded"||w._playLock)return w._queue.push({event:"fade",action:function(){w.fade(r,l,h,f)}}),w;r=Math.min(Math.max(0,parseFloat(r)),1),l=Math.min(Math.max(0,parseFloat(l)),1),h=parseFloat(h),w.volume(r,f);for(var m=w._getSoundIds(f),g=0;g<m.length;g++){var y=w._soundById(m[g]);if(y){if(f||w._stopFade(m[g]),w._webAudio&&!y._muted){var v=e.ctx.currentTime,S=v+h/1e3;y._volume=r,y._node.gain.setValueAtTime(r,v),y._node.gain.linearRampToValueAtTime(l,S)}w._startFadeInterval(y,r,l,h,m[g],typeof f>"u")}}return w},_startFadeInterval:function(r,l,h,f,w,m){var g=this,y=l,v=h-l,S=Math.abs(v/.01),F=Math.max(4,S>0?f/S:f),C=Date.now();r._fadeTo=h,r._interval=setInterval(function(){var R=(Date.now()-C)/f;C=Date.now(),y+=v*R,y=Math.round(y*100)/100,v<0?y=Math.max(h,y):y=Math.min(h,y),g._webAudio?r._volume=y:g.volume(y,r._id,!0),m&&(g._volume=y),(h<l&&y<=h||h>l&&y>=h)&&(clearInterval(r._interval),r._interval=null,r._fadeTo=null,g.volume(h,r._id),g._emit("fade",r._id))},F)},_stopFade:function(r){var l=this,h=l._soundById(r);return h&&h._interval&&(l._webAudio&&h._node.gain.cancelScheduledValues(e.ctx.currentTime),clearInterval(h._interval),h._interval=null,l.volume(h._fadeTo,r),h._fadeTo=null,l._emit("fade",r)),l},loop:function(){var r=this,l=arguments,h,f,w;if(l.length===0)return r._loop;if(l.length===1)if(typeof l[0]=="boolean")h=l[0],r._loop=h;else return w=r._soundById(parseInt(l[0],10)),w?w._loop:!1;else l.length===2&&(h=l[0],f=parseInt(l[1],10));for(var m=r._getSoundIds(f),g=0;g<m.length;g++)w=r._soundById(m[g]),w&&(w._loop=h,r._webAudio&&w._node&&w._node.bufferSource&&(w._node.bufferSource.loop=h,h&&(w._node.bufferSource.loopStart=w._start||0,w._node.bufferSource.loopEnd=w._stop,r.playing(m[g])&&(r.pause(m[g],!0),r.play(m[g],!0)))));return r},rate:function(){var r=this,l=arguments,h,f;if(l.length===0)f=r._sounds[0]._id;else if(l.length===1){var w=r._getSoundIds(),m=w.indexOf(l[0]);m>=0?f=parseInt(l[0],10):h=parseFloat(l[0])}else l.length===2&&(h=parseFloat(l[0]),f=parseInt(l[1],10));var g;if(typeof h=="number"){if(r._state!=="loaded"||r._playLock)return r._queue.push({event:"rate",action:function(){r.rate.apply(r,l)}}),r;typeof f>"u"&&(r._rate=h),f=r._getSoundIds(f);for(var y=0;y<f.length;y++)if(g=r._soundById(f[y]),g){r.playing(f[y])&&(g._rateSeek=r.seek(f[y]),g._playStart=r._webAudio?e.ctx.currentTime:g._playStart),g._rate=h,r._webAudio&&g._node&&g._node.bufferSource?g._node.bufferSource.playbackRate.setValueAtTime(h,e.ctx.currentTime):g._node&&(g._node.playbackRate=h);var v=r.seek(f[y]),S=(r._sprite[g._sprite][0]+r._sprite[g._sprite][1])/1e3-v,F=S*1e3/Math.abs(g._rate);(r._endTimers[f[y]]||!g._paused)&&(r._clearTimer(f[y]),r._endTimers[f[y]]=setTimeout(r._ended.bind(r,g),F)),r._emit("rate",g._id)}}else return g=r._soundById(f),g?g._rate:r._rate;return r},seek:function(){var r=this,l=arguments,h,f;if(l.length===0)r._sounds.length&&(f=r._sounds[0]._id);else if(l.length===1){var w=r._getSoundIds(),m=w.indexOf(l[0]);m>=0?f=parseInt(l[0],10):r._sounds.length&&(f=r._sounds[0]._id,h=parseFloat(l[0]))}else l.length===2&&(h=parseFloat(l[0]),f=parseInt(l[1],10));if(typeof f>"u")return 0;if(typeof h=="number"&&(r._state!=="loaded"||r._playLock))return r._queue.push({event:"seek",action:function(){r.seek.apply(r,l)}}),r;var g=r._soundById(f);if(g)if(typeof h=="number"&&h>=0){var y=r.playing(f);y&&r.pause(f,!0),g._seek=h,g._ended=!1,r._clearTimer(f),!r._webAudio&&g._node&&!isNaN(g._node.duration)&&(g._node.currentTime=h);var v=function(){y&&r.play(f,!0),r._emit("seek",f)};if(y&&!r._webAudio){var S=function(){r._playLock?setTimeout(S,0):v()};setTimeout(S,0)}else v()}else if(r._webAudio){var F=r.playing(f)?e.ctx.currentTime-g._playStart:0,C=g._rateSeek?g._rateSeek-g._seek:0;return g._seek+(C+F*Math.abs(g._rate))}else return g._node.currentTime;return r},playing:function(r){var l=this;if(typeof r=="number"){var h=l._soundById(r);return h?!h._paused:!1}for(var f=0;f<l._sounds.length;f++)if(!l._sounds[f]._paused)return!0;return!1},duration:function(r){var l=this,h=l._duration,f=l._soundById(r);return f&&(h=l._sprite[f._sprite][1]/1e3),h},state:function(){return this._state},unload:function(){for(var r=this,l=r._sounds,h=0;h<l.length;h++)l[h]._paused||r.stop(l[h]._id),r._webAudio||(r._clearSound(l[h]._node),l[h]._node.removeEventListener("error",l[h]._errorFn,!1),l[h]._node.removeEventListener(e._canPlayEvent,l[h]._loadFn,!1),l[h]._node.removeEventListener("ended",l[h]._endFn,!1),e._releaseHtml5Audio(l[h]._node)),delete l[h]._node,r._clearTimer(l[h]._id);var f=e._howls.indexOf(r);f>=0&&e._howls.splice(f,1);var w=!0;for(h=0;h<e._howls.length;h++)if(e._howls[h]._src===r._src||r._src.indexOf(e._howls[h]._src)>=0){w=!1;break}return o&&w&&delete o[r._src],e.noAudio=!1,r._state="unloaded",r._sounds=[],r=null,null},on:function(r,l,h,f){var w=this,m=w["_on"+r];return typeof l=="function"&&m.push(f?{id:h,fn:l,once:f}:{id:h,fn:l}),w},off:function(r,l,h){var f=this,w=f["_on"+r],m=0;if(typeof l=="number"&&(h=l,l=null),l||h)for(m=0;m<w.length;m++){var g=h===w[m].id;if(l===w[m].fn&&g||!l&&g){w.splice(m,1);break}}else if(r)f["_on"+r]=[];else{var y=Object.keys(f);for(m=0;m<y.length;m++)y[m].indexOf("_on")===0&&Array.isArray(f[y[m]])&&(f[y[m]]=[])}return f},once:function(r,l,h){var f=this;return f.on(r,l,h,1),f},_emit:function(r,l,h){for(var f=this,w=f["_on"+r],m=w.length-1;m>=0;m--)(!w[m].id||w[m].id===l||r==="load")&&(setTimeout((function(g){g.call(this,l,h)}).bind(f,w[m].fn),0),w[m].once&&f.off(r,w[m].fn,w[m].id));return f._loadQueue(r),f},_loadQueue:function(r){var l=this;if(l._queue.length>0){var h=l._queue[0];h.event===r&&(l._queue.shift(),l._loadQueue()),r||h.action()}return l},_ended:function(r){var l=this,h=r._sprite;if(!l._webAudio&&r._node&&!r._node.paused&&!r._node.ended&&r._node.currentTime<r._stop)return setTimeout(l._ended.bind(l,r),100),l;var f=!!(r._loop||l._sprite[h][2]);if(l._emit("end",r._id),!l._webAudio&&f&&l.stop(r._id,!0).play(r._id),l._webAudio&&f){l._emit("play",r._id),r._seek=r._start||0,r._rateSeek=0,r._playStart=e.ctx.currentTime;var w=(r._stop-r._start)*1e3/Math.abs(r._rate);l._endTimers[r._id]=setTimeout(l._ended.bind(l,r),w)}return l._webAudio&&!f&&(r._paused=!0,r._ended=!0,r._seek=r._start||0,r._rateSeek=0,l._clearTimer(r._id),l._cleanBuffer(r._node),e._autoSuspend()),!l._webAudio&&!f&&l.stop(r._id,!0),l},_clearTimer:function(r){var l=this;if(l._endTimers[r]){if(typeof l._endTimers[r]!="function")clearTimeout(l._endTimers[r]);else{var h=l._soundById(r);h&&h._node&&h._node.removeEventListener("ended",l._endTimers[r],!1)}delete l._endTimers[r]}return l},_soundById:function(r){for(var l=this,h=0;h<l._sounds.length;h++)if(r===l._sounds[h]._id)return l._sounds[h];return null},_inactiveSound:function(){var r=this;r._drain();for(var l=0;l<r._sounds.length;l++)if(r._sounds[l]._ended)return r._sounds[l].reset();return new s(r)},_drain:function(){var r=this,l=r._pool,h=0,f=0;if(!(r._sounds.length<l)){for(f=0;f<r._sounds.length;f++)r._sounds[f]._ended&&h++;for(f=r._sounds.length-1;f>=0;f--){if(h<=l)return;r._sounds[f]._ended&&(r._webAudio&&r._sounds[f]._node&&r._sounds[f]._node.disconnect(0),r._sounds.splice(f,1),h--)}}},_getSoundIds:function(r){var l=this;if(typeof r>"u"){for(var h=[],f=0;f<l._sounds.length;f++)h.push(l._sounds[f]._id);return h}else return[r]},_refreshBuffer:function(r){var l=this;return r._node.bufferSource=e.ctx.createBufferSource(),r._node.bufferSource.buffer=o[l._src],r._panner?r._node.bufferSource.connect(r._panner):r._node.bufferSource.connect(r._node),r._node.bufferSource.loop=r._loop,r._loop&&(r._node.bufferSource.loopStart=r._start||0,r._node.bufferSource.loopEnd=r._stop||0),r._node.bufferSource.playbackRate.setValueAtTime(r._rate,e.ctx.currentTime),l},_cleanBuffer:function(r){var l=this,h=e._navigator&&e._navigator.vendor.indexOf("Apple")>=0;if(!r.bufferSource)return l;if(e._scratchBuffer&&r.bufferSource&&(r.bufferSource.onended=null,r.bufferSource.disconnect(0),h))try{r.bufferSource.buffer=e._scratchBuffer}catch{}return r.bufferSource=null,l},_clearSound:function(r){var l=/MSIE |Trident\//.test(e._navigator&&e._navigator.userAgent);l||(r.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var s=function(r){this._parent=r,this.init()};s.prototype={init:function(){var r=this,l=r._parent;return r._muted=l._muted,r._loop=l._loop,r._volume=l._volume,r._rate=l._rate,r._seek=0,r._paused=!0,r._ended=!0,r._sprite="__default",r._id=++e._counter,l._sounds.push(r),r.create(),r},create:function(){var r=this,l=r._parent,h=e._muted||r._muted||r._parent._muted?0:r._volume;return l._webAudio?(r._node=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),r._node.gain.setValueAtTime(h,e.ctx.currentTime),r._node.paused=!0,r._node.connect(e.masterGain)):e.noAudio||(r._node=e._obtainHtml5Audio(),r._errorFn=r._errorListener.bind(r),r._node.addEventListener("error",r._errorFn,!1),r._loadFn=r._loadListener.bind(r),r._node.addEventListener(e._canPlayEvent,r._loadFn,!1),r._endFn=r._endListener.bind(r),r._node.addEventListener("ended",r._endFn,!1),r._node.src=l._src,r._node.preload=l._preload===!0?"auto":l._preload,r._node.volume=h*e.volume(),r._node.load()),r},reset:function(){var r=this,l=r._parent;return r._muted=l._muted,r._loop=l._loop,r._volume=l._volume,r._rate=l._rate,r._seek=0,r._rateSeek=0,r._paused=!0,r._ended=!0,r._sprite="__default",r._id=++e._counter,r},_errorListener:function(){var r=this;r._parent._emit("loaderror",r._id,r._node.error?r._node.error.code:0),r._node.removeEventListener("error",r._errorFn,!1)},_loadListener:function(){var r=this,l=r._parent;l._duration=Math.ceil(r._node.duration*10)/10,Object.keys(l._sprite).length===0&&(l._sprite={__default:[0,l._duration*1e3]}),l._state!=="loaded"&&(l._state="loaded",l._emit("load"),l._loadQueue()),r._node.removeEventListener(e._canPlayEvent,r._loadFn,!1)},_endListener:function(){var r=this,l=r._parent;l._duration===1/0&&(l._duration=Math.ceil(r._node.duration*10)/10,l._sprite.__default[1]===1/0&&(l._sprite.__default[1]=l._duration*1e3),l._ended(r)),r._node.removeEventListener("ended",r._endFn,!1)}};var o={},a=function(r){var l=r._src;if(o[l]){r._duration=o[l].duration,d(r);return}if(/^data:[^;]+;base64,/.test(l)){for(var h=atob(l.split(",")[1]),f=new Uint8Array(h.length),w=0;w<h.length;++w)f[w]=h.charCodeAt(w);_(f.buffer,r)}else{var m=new XMLHttpRequest;m.open(r._xhr.method,l,!0),m.withCredentials=r._xhr.withCredentials,m.responseType="arraybuffer",r._xhr.headers&&Object.keys(r._xhr.headers).forEach(function(g){m.setRequestHeader(g,r._xhr.headers[g])}),m.onload=function(){var g=(m.status+"")[0];if(g!=="0"&&g!=="2"&&g!=="3"){r._emit("loaderror",null,"Failed loading audio file with status: "+m.status+".");return}_(m.response,r)},m.onerror=function(){r._webAudio&&(r._html5=!0,r._webAudio=!1,r._sounds=[],delete o[l],r.load())},c(m)}},c=function(r){try{r.send()}catch{r.onerror()}},_=function(r,l){var h=function(){l._emit("loaderror",null,"Decoding audio data failed.")},f=function(w){w&&l._sounds.length>0?(o[l._src]=w,d(l,w)):h()};typeof Promise<"u"&&e.ctx.decodeAudioData.length===1?e.ctx.decodeAudioData(r).then(f).catch(h):e.ctx.decodeAudioData(r,f,h)},d=function(r,l){l&&!r._duration&&(r._duration=l.duration),Object.keys(r._sprite).length===0&&(r._sprite={__default:[0,r._duration*1e3]}),r._state!=="loaded"&&(r._state="loaded",r._emit("load"),r._loadQueue())},p=function(){if(e.usingWebAudio){try{typeof AudioContext<"u"?e.ctx=new AudioContext:typeof webkitAudioContext<"u"?e.ctx=new webkitAudioContext:e.usingWebAudio=!1}catch{e.usingWebAudio=!1}e.ctx||(e.usingWebAudio=!1);var r=/iP(hone|od|ad)/.test(e._navigator&&e._navigator.platform),l=e._navigator&&e._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),h=l?parseInt(l[1],10):null;if(r&&h&&h<9){var f=/safari/.test(e._navigator&&e._navigator.userAgent.toLowerCase());e._navigator&&!f&&(e.usingWebAudio=!1)}e.usingWebAudio&&(e.masterGain=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),e.masterGain.gain.setValueAtTime(e._muted?0:e._volume,e.ctx.currentTime),e.masterGain.connect(e.ctx.destination)),e._setup()}};i.Howler=e,i.Howl=n,typeof dt<"u"?(dt.HowlerGlobal=t,dt.Howler=e,dt.Howl=n,dt.Sound=s):typeof window<"u"&&(window.HowlerGlobal=t,window.Howler=e,window.Howl=n,window.Sound=s)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var n=this;if(!n.ctx||!n.ctx.listener)return n;for(var s=n._howls.length-1;s>=0;s--)n._howls[s].stereo(e);return n},HowlerGlobal.prototype.pos=function(e,n,s){var o=this;if(!o.ctx||!o.ctx.listener)return o;if(n=typeof n!="number"?o._pos[1]:n,s=typeof s!="number"?o._pos[2]:s,typeof e=="number")o._pos=[e,n,s],typeof o.ctx.listener.positionX<"u"?(o.ctx.listener.positionX.setTargetAtTime(o._pos[0],Howler.ctx.currentTime,.1),o.ctx.listener.positionY.setTargetAtTime(o._pos[1],Howler.ctx.currentTime,.1),o.ctx.listener.positionZ.setTargetAtTime(o._pos[2],Howler.ctx.currentTime,.1)):o.ctx.listener.setPosition(o._pos[0],o._pos[1],o._pos[2]);else return o._pos;return o},HowlerGlobal.prototype.orientation=function(e,n,s,o,a,c){var _=this;if(!_.ctx||!_.ctx.listener)return _;var d=_._orientation;if(n=typeof n!="number"?d[1]:n,s=typeof s!="number"?d[2]:s,o=typeof o!="number"?d[3]:o,a=typeof a!="number"?d[4]:a,c=typeof c!="number"?d[5]:c,typeof e=="number")_._orientation=[e,n,s,o,a,c],typeof _.ctx.listener.forwardX<"u"?(_.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),_.ctx.listener.forwardY.setTargetAtTime(n,Howler.ctx.currentTime,.1),_.ctx.listener.forwardZ.setTargetAtTime(s,Howler.ctx.currentTime,.1),_.ctx.listener.upX.setTargetAtTime(o,Howler.ctx.currentTime,.1),_.ctx.listener.upY.setTargetAtTime(a,Howler.ctx.currentTime,.1),_.ctx.listener.upZ.setTargetAtTime(c,Howler.ctx.currentTime,.1)):_.ctx.listener.setOrientation(e,n,s,o,a,c);else return d;return _},Howl.prototype.init=function(e){return function(n){var s=this;return s._orientation=n.orientation||[1,0,0],s._stereo=n.stereo||null,s._pos=n.pos||null,s._pannerAttr={coneInnerAngle:typeof n.coneInnerAngle<"u"?n.coneInnerAngle:360,coneOuterAngle:typeof n.coneOuterAngle<"u"?n.coneOuterAngle:360,coneOuterGain:typeof n.coneOuterGain<"u"?n.coneOuterGain:0,distanceModel:typeof n.distanceModel<"u"?n.distanceModel:"inverse",maxDistance:typeof n.maxDistance<"u"?n.maxDistance:1e4,panningModel:typeof n.panningModel<"u"?n.panningModel:"HRTF",refDistance:typeof n.refDistance<"u"?n.refDistance:1,rolloffFactor:typeof n.rolloffFactor<"u"?n.rolloffFactor:1},s._onstereo=n.onstereo?[{fn:n.onstereo}]:[],s._onpos=n.onpos?[{fn:n.onpos}]:[],s._onorientation=n.onorientation?[{fn:n.onorientation}]:[],e.call(this,n)}}(Howl.prototype.init),Howl.prototype.stereo=function(e,n){var s=this;if(!s._webAudio)return s;if(s._state!=="loaded")return s._queue.push({event:"stereo",action:function(){s.stereo(e,n)}}),s;var o=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof n>"u")if(typeof e=="number")s._stereo=e,s._pos=[e,0,0];else return s._stereo;for(var a=s._getSoundIds(n),c=0;c<a.length;c++){var _=s._soundById(a[c]);if(_)if(typeof e=="number")_._stereo=e,_._pos=[e,0,0],_._node&&(_._pannerAttr.panningModel="equalpower",(!_._panner||!_._panner.pan)&&t(_,o),o==="spatial"?typeof _._panner.positionX<"u"?(_._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),_._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),_._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):_._panner.setPosition(e,0,0):_._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),s._emit("stereo",_._id);else return _._stereo}return s},Howl.prototype.pos=function(e,n,s,o){var a=this;if(!a._webAudio)return a;if(a._state!=="loaded")return a._queue.push({event:"pos",action:function(){a.pos(e,n,s,o)}}),a;if(n=typeof n!="number"?0:n,s=typeof s!="number"?-.5:s,typeof o>"u")if(typeof e=="number")a._pos=[e,n,s];else return a._pos;for(var c=a._getSoundIds(o),_=0;_<c.length;_++){var d=a._soundById(c[_]);if(d)if(typeof e=="number")d._pos=[e,n,s],d._node&&((!d._panner||d._panner.pan)&&t(d,"spatial"),typeof d._panner.positionX<"u"?(d._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),d._panner.positionY.setValueAtTime(n,Howler.ctx.currentTime),d._panner.positionZ.setValueAtTime(s,Howler.ctx.currentTime)):d._panner.setPosition(e,n,s)),a._emit("pos",d._id);else return d._pos}return a},Howl.prototype.orientation=function(e,n,s,o){var a=this;if(!a._webAudio)return a;if(a._state!=="loaded")return a._queue.push({event:"orientation",action:function(){a.orientation(e,n,s,o)}}),a;if(n=typeof n!="number"?a._orientation[1]:n,s=typeof s!="number"?a._orientation[2]:s,typeof o>"u")if(typeof e=="number")a._orientation=[e,n,s];else return a._orientation;for(var c=a._getSoundIds(o),_=0;_<c.length;_++){var d=a._soundById(c[_]);if(d)if(typeof e=="number")d._orientation=[e,n,s],d._node&&(d._panner||(d._pos||(d._pos=a._pos||[0,0,-.5]),t(d,"spatial")),typeof d._panner.orientationX<"u"?(d._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),d._panner.orientationY.setValueAtTime(n,Howler.ctx.currentTime),d._panner.orientationZ.setValueAtTime(s,Howler.ctx.currentTime)):d._panner.setOrientation(e,n,s)),a._emit("orientation",d._id);else return d._orientation}return a},Howl.prototype.pannerAttr=function(){var e=this,n=arguments,s,o,a;if(!e._webAudio)return e;if(n.length===0)return e._pannerAttr;if(n.length===1)if(typeof n[0]=="object")s=n[0],typeof o>"u"&&(s.pannerAttr||(s.pannerAttr={coneInnerAngle:s.coneInnerAngle,coneOuterAngle:s.coneOuterAngle,coneOuterGain:s.coneOuterGain,distanceModel:s.distanceModel,maxDistance:s.maxDistance,refDistance:s.refDistance,rolloffFactor:s.rolloffFactor,panningModel:s.panningModel}),e._pannerAttr={coneInnerAngle:typeof s.pannerAttr.coneInnerAngle<"u"?s.pannerAttr.coneInnerAngle:e._coneInnerAngle,coneOuterAngle:typeof s.pannerAttr.coneOuterAngle<"u"?s.pannerAttr.coneOuterAngle:e._coneOuterAngle,coneOuterGain:typeof s.pannerAttr.coneOuterGain<"u"?s.pannerAttr.coneOuterGain:e._coneOuterGain,distanceModel:typeof s.pannerAttr.distanceModel<"u"?s.pannerAttr.distanceModel:e._distanceModel,maxDistance:typeof s.pannerAttr.maxDistance<"u"?s.pannerAttr.maxDistance:e._maxDistance,refDistance:typeof s.pannerAttr.refDistance<"u"?s.pannerAttr.refDistance:e._refDistance,rolloffFactor:typeof s.pannerAttr.rolloffFactor<"u"?s.pannerAttr.rolloffFactor:e._rolloffFactor,panningModel:typeof s.pannerAttr.panningModel<"u"?s.pannerAttr.panningModel:e._panningModel});else return a=e._soundById(parseInt(n[0],10)),a?a._pannerAttr:e._pannerAttr;else n.length===2&&(s=n[0],o=parseInt(n[1],10));for(var c=e._getSoundIds(o),_=0;_<c.length;_++)if(a=e._soundById(c[_]),a){var d=a._pannerAttr;d={coneInnerAngle:typeof s.coneInnerAngle<"u"?s.coneInnerAngle:d.coneInnerAngle,coneOuterAngle:typeof s.coneOuterAngle<"u"?s.coneOuterAngle:d.coneOuterAngle,coneOuterGain:typeof s.coneOuterGain<"u"?s.coneOuterGain:d.coneOuterGain,distanceModel:typeof s.distanceModel<"u"?s.distanceModel:d.distanceModel,maxDistance:typeof s.maxDistance<"u"?s.maxDistance:d.maxDistance,refDistance:typeof s.refDistance<"u"?s.refDistance:d.refDistance,rolloffFactor:typeof s.rolloffFactor<"u"?s.rolloffFactor:d.rolloffFactor,panningModel:typeof s.panningModel<"u"?s.panningModel:d.panningModel};var p=a._panner;p||(a._pos||(a._pos=e._pos||[0,0,-.5]),t(a,"spatial"),p=a._panner),p.coneInnerAngle=d.coneInnerAngle,p.coneOuterAngle=d.coneOuterAngle,p.coneOuterGain=d.coneOuterGain,p.distanceModel=d.distanceModel,p.maxDistance=d.maxDistance,p.refDistance=d.refDistance,p.rolloffFactor=d.rolloffFactor,p.panningModel=d.panningModel}return e},Sound.prototype.init=function(e){return function(){var n=this,s=n._parent;n._orientation=s._orientation,n._stereo=s._stereo,n._pos=s._pos,n._pannerAttr=s._pannerAttr,e.call(this),n._stereo?s.stereo(n._stereo):n._pos&&s.pos(n._pos[0],n._pos[1],n._pos[2],n._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var n=this,s=n._parent;return n._orientation=s._orientation,n._stereo=s._stereo,n._pos=s._pos,n._pannerAttr=s._pannerAttr,n._stereo?s.stereo(n._stereo):n._pos?s.pos(n._pos[0],n._pos[1],n._pos[2],n._id):n._panner&&(n._panner.disconnect(0),n._panner=void 0,s._refreshBuffer(n)),e.call(this)}}(Sound.prototype.reset);var t=function(e,n){n=n||"spatial",n==="spatial"?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,typeof e._panner.positionX<"u"?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),typeof e._panner.orientationX<"u"?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}})()})(Do);class Hi extends k{init(){this.origin=new Float32Array(3),this.fwd=new Float32Array(3),this.up=new Float32Array(3)}update(){this.spatial&&(this.object.getTranslationWorld(this.origin),this.object.getForward(this.fwd),this.object.getUp(this.up),Howler.pos(this.origin[0],this.origin[1],this.origin[2]),Howler.orientation(this.fwd[0],this.fwd[1],this.fwd[2],this.up[0],this.up[1],this.up[2]))}}u(Hi,"TypeName","howler-audio-listener"),u(Hi,"Properties",{spatial:{type:b.Bool,default:!0}});class Bi extends k{start(){this.audio=new Howl({src:[this.src],loop:this.loop,volume:this.volume,autoplay:this.autoplay}),this.lastPlayedAudioId=null,this.origin=new Float32Array(3),this.lastOrigin=new Float32Array(3),this.spatial&&this.autoplay&&(this.updatePosition(),this.play())}update(){!this.spatial||!this.lastPlayedAudioId||(this.object.getTranslationWorld(this.origin),(Math.abs(this.lastOrigin[0]-this.origin[0])>.005||Math.abs(this.lastOrigin[1]-this.origin[1])>.005||Math.abs(this.lastOrigin[2]-this.origin[2])>.005)&&this.updatePosition())}updatePosition(){this.audio.pos(this.origin[0],this.origin[1],this.origin[2],this.lastPlayedAudioId),this.lastOrigin.set(this.origin)}play(){this.lastPlayedAudioId&&this.audio.stop(this.lastPlayedAudioId),this.lastPlayedAudioId=this.audio.play(),this.spatial&&this.updatePosition()}stop(){this.lastPlayedAudioId&&(this.audio.stop(this.lastPlayedAudioId),this.lastPlayedAudioId=null)}onDeactivate(){this.stop()}}u(Bi,"TypeName","howler-audio-source"),u(Bi,"Properties",{volume:{type:b.Float,default:1},spatial:{type:b.Bool,default:!0},loop:{type:b.Bool,default:!1},autoplay:{type:b.Bool,default:!1},src:{type:b.String,default:""}});function Ns(i,t,e){if(e!=="auto")return i[e]=t,!0;const n=i.shader;return n==="Flat Opaque Textured"?(i.flatTexture=t,!0):n==="Phong Opaque Textured"||n==="Foliage"||n==="Phong Normalmapped"||n==="Phong Lightmapped"?(i.diffuseTexture=t,!0):n==="Particle"?(i.mainTexture=t,!0):n==="DistanceFieldVector"?(i.vectorTexture=t,!0):n==="Background"||n==="Sky"?(i.texture=t,!0):n==="Physical Opaque Textured"?(i.albedoTexture=t,!0):!1}function Ui(i){return i*Math.PI/180}class Vi extends k{start(){if(!this.material)throw Error("image-texture: material property not set");this.engine.textures.load(this.url,"anonymous").then(t=>{const e=this.material;Ns(e,t,this.textureProperty)||console.error("Shader",e.shader,"not supported by image-texture")}).catch(console.err)}}u(Vi,"TypeName","image-texture"),u(Vi,"Properties",{url:Y.string(),material:Y.material(),textureProperty:Y.string("auto")});var yn=function(i,t,e,n){var s=arguments.length,o=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,t,e,n);else for(var c=i.length-1;c>=0;c--)(a=i[c])&&(o=(s<3?a(o):s>3?a(t,e,o):a(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};const Ni=i=>{i.preventDefault()};class _t extends k{constructor(){super(...arguments);u(this,"sensitity",.25);u(this,"requireMouseDown",!0);u(this,"mouseButtonIndex",0);u(this,"pointerLockOnClick",!1);u(this,"currentRotationY",0);u(this,"currentRotationX",0);u(this,"origin",new Float32Array(3));u(this,"parentOrigin",new Float32Array(3));u(this,"rotationX",0);u(this,"rotationY",0);u(this,"mouseDown",!1);u(this,"requestPointerLock",()=>{const e=this.engine.canvas;e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock()});u(this,"onMouseDown",e=>{if(e.button===this.mouseButtonIndex&&(this.mouseDown=!0,document.body.style.cursor="grabbing",e.button===1))return e.preventDefault(),!1});u(this,"onMouseUp",e=>{e.button===this.mouseButtonIndex&&(this.mouseDown=!1,document.body.style.cursor="initial")});u(this,"onMouseMove",e=>{if(this.active&&(this.mouseDown||!this.requireMouseDown)){this.rotationY=-this.sensitity*e.movementX/100,this.rotationX=-this.sensitity*e.movementY/100,this.currentRotationX+=this.rotationX,this.currentRotationY+=this.rotationY,this.currentRotationX=Math.min(1.507,this.currentRotationX),this.currentRotationX=Math.max(-1.507,this.currentRotationX),this.object.getPositionWorld(this.origin);const n=this.object.parent;n&&(n.getPositionWorld(this.parentOrigin),Q(this.origin,this.origin,this.parentOrigin)),this.object.resetPositionRotation(),this.object.rotateAxisAngleRadLocal([1,0,0],this.currentRotationX),this.object.rotateAxisAngleRadLocal([0,1,0],this.currentRotationY),this.object.translateLocal(this.origin)}})}onActivate(){document.addEventListener("mousemove",this.onMouseMove);const e=this.engine.canvas;this.pointerLockOnClick&&e.addEventListener("mousedown",this.requestPointerLock),this.requireMouseDown&&(this.mouseButtonIndex===2&&e.addEventListener("contextmenu",Ni,!1),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("mouseup",this.onMouseUp))}onDeactivate(){document.removeEventListener("mousemove",this.onMouseMove);const e=this.engine.canvas;this.pointerLockOnClick&&e.removeEventListener("mousedown",this.requestPointerLock),this.requireMouseDown&&(this.mouseButtonIndex===2&&e.removeEventListener("contextmenu",Ni,!1),e.removeEventListener("mousedown",this.onMouseDown),e.removeEventListener("mouseup",this.onMouseUp))}}u(_t,"TypeName","mouse-look");yn([j.float(.25)],_t.prototype,"sensitity",void 0);yn([j.bool(!0)],_t.prototype,"requireMouseDown",void 0);yn([j.int()],_t.prototype,"mouseButtonIndex",void 0);yn([j.bool(!1)],_t.prototype,"pointerLockOnClick",void 0);var Ho=function(i,t,e,n){var s=arguments.length,o=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,t,e,n);else for(var c=i.length-1;c>=0;c--)(a=i[c])&&(o=(s<3?a(o):s>3?a(t,e,o):a(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};class Ws extends k{constructor(){super(...arguments);u(this,"height",1.75);u(this,"onSessionStartCallback");u(this,"onSessionEndCallback")}start(){this.object.resetPositionRotation(),this.object.translateLocal([0,this.height,0]),this.onSessionStartCallback=this.onXRSessionStart.bind(this),this.onSessionEndCallback=this.onXRSessionEnd.bind(this)}onActivate(){this.engine.onXRSessionStart.add(this.onSessionStartCallback),this.engine.onXRSessionEnd.add(this.onSessionEndCallback)}onDeactivate(){this.engine.onXRSessionStart.remove(this.onSessionStartCallback),this.engine.onXRSessionEnd.remove(this.onSessionEndCallback)}onXRSessionStart(){var n;const e=(n=this.engine.xr)==null?void 0:n.currentReferenceSpaceType;e!=="local"&&e!=="viewer"&&this.object.resetPositionRotation()}onXRSessionEnd(){var n;const e=(n=this.engine.xr)==null?void 0:n.currentReferenceSpaceType;e!=="local"&&e!=="viewer"&&(this.object.resetPositionRotation(),this.object.translateLocal([0,this.height,0]))}}u(Ws,"TypeName","player-height");Ho([j.float(1.75)],Ws.prototype,"height",void 0);class Wi extends k{start(){this.onSessionStartCallback=this.setTargetFramerate.bind(this)}onActivate(){this.engine.onXRSessionStart.add(this.onSessionStartCallback)}onDeactivate(){this.engine.onXRSessionStart.remove(this.onSessionStartCallback)}setTargetFramerate(t){if(t.supportedFrameRates&&t.updateTargetFrameRate){const e=this.engine.xr.session.supportedFrameRates;e.sort((n,s)=>Math.abs(n-this.framerate)-Math.abs(s-this.framerate)),this.engine.xr.session.updateTargetFrameRate(e[0])}}}u(Wi,"TypeName","target-framerate"),u(Wi,"Properties",{framerate:{type:b.Float,default:90}});class $i extends k{init(){if(this._prevThumbstickAxis=new Float32Array(2),this._tempVec=new Float32Array(3),this._tempVec0=new Float32Array(3),this._currentIndicatorRotation=0,this.input=this.object.getComponent("input"),!this.input){console.error(this.object.name,"generic-teleport-component.js: input component is required on the object");return}if(!this.teleportIndicatorMeshObject){console.error(this.object.name,"generic-teleport-component.js: Teleport indicator mesh is missing");return}if(!this.camRoot){console.error(this.object.name,"generic-teleport-component.js: camRoot not set");return}this.isIndicating=!1,this.indicatorHidden=!0,this.hitSpot=new Float32Array(3),this._hasHit=!1,this._extraRotation=0,this._currentStickAxes=new Float32Array(2)}start(){if(this.cam&&(this.isMouseIndicating=!1,canvas.addEventListener("mousedown",this.onMouseDown.bind(this)),canvas.addEventListener("mouseup",this.onMouseUp.bind(this))),this.handedness==0){const t=this.object.getComponent("input");t?(this.handedness=t.handedness,this.input=t):console.warn("teleport component on object",this.object.name,'was configured with handedness "input component", but object has no input component.')}else this.handedness=["left","right"][this.handedness-1];this.onSessionStartCallback=this.setupVREvents.bind(this),this.teleportIndicatorMeshObject.active=!1}onActivate(){this.engine.onXRSessionStart.add(this.onSessionStartCallback)}onDeactivate(){this.engine.onXRSessionStart.remove(this.onSessionStartCallback)}_getCamRotation(){return this.eyeLeft.getForward(this._tempVec),this._tempVec[1]=0,N(this._tempVec,this._tempVec),Math.atan2(this._tempVec[0],this._tempVec[2])}update(){let t=0;if(this.gamepad&&this.gamepad.axes&&(this._currentStickAxes[0]=this.gamepad.axes[2],this._currentStickAxes[1]=this.gamepad.axes[3],t=Math.abs(this._currentStickAxes[0])+Math.abs(this._currentStickAxes[1])),!this.isIndicating&&this._prevThumbstickAxis[1]>=this.thumbstickActivationThreshhold&&this._currentStickAxes[1]<this.thumbstickActivationThreshhold?this.isIndicating=!0:this.isIndicating&&t<this.thumbstickDeactivationThreshhold&&(this.isIndicating=!1,this.teleportIndicatorMeshObject.active=!1,this._hasHit&&this._teleportPlayer(this.hitSpot,this._extraRotation)),this.isIndicating&&this.teleportIndicatorMeshObject&&this.input){const e=this._tempVec0;this.object.getPositionWorld(e);const n=this.object.getForwardWorld(this._tempVec);let s=this.rayHit=this.rayCastMode==0?this.engine.scene.rayCast(e,n,1<<this.floorGroup):this.engine.physics.rayCast(e,n,1<<this.floorGroup,this.maxDistance);s.hitCount>0?(this.indicatorHidden=!1,this._extraRotation=Math.PI+Math.atan2(this._currentStickAxes[0],this._currentStickAxes[1]),this._currentIndicatorRotation=this._getCamRotation()+(this._extraRotation-Math.PI),this.teleportIndicatorMeshObject.resetPositionRotation(),this.teleportIndicatorMeshObject.rotateAxisAngleRad([0,1,0],this._currentIndicatorRotation),this.teleportIndicatorMeshObject.translate(s.locations[0]),this.teleportIndicatorMeshObject.translate([0,this.indicatorYOffset,0]),this.teleportIndicatorMeshObject.active=!0,this.hitSpot.set(s.locations[0]),this._hasHit=!0):(this.indicatorHidden||(this.teleportIndicatorMeshObject.active=!1,this.indicatorHidden=!0),this._hasHit=!1)}else this.teleportIndicatorMeshObject&&this.isMouseIndicating&&this.onMousePressed();this._prevThumbstickAxis.set(this._currentStickAxes)}setupVREvents(t){if(this.session=t,t.addEventListener("end",(function(){this.gamepad=null,this.session=null}).bind(this)),t.inputSources&&t.inputSources.length)for(let e=0;e<t.inputSources.length;e++){let n=t.inputSources[e];n.handedness==this.handedness&&(this.gamepad=n.gamepad)}t.addEventListener("inputsourceschange",(function(e){if(e.added&&e.added.length)for(let n=0;n<e.added.length;n++){let s=e.added[n];s.handedness==this.handedness&&(this.gamepad=s.gamepad)}}).bind(this))}onMouseDown(){this.isMouseIndicating=!0}onMouseUp(){this.isMouseIndicating=!1,this.teleportIndicatorMeshObject.active=!1,this._hasHit&&this._teleportPlayer(this.hitSpot,0)}onMousePressed(){let t=[0,0,0];this.cam.getPositionWorld(t);const e=this.cam.getForward(this._tempVec);let n=this.rayHit=this.rayCastMode==0?this.engine.scene.rayCast(t,e,1<<this.floorGroup):this.engine.physics.rayCast(t,e,1<<this.floorGroup,this.maxDistance);n.hitCount>0?(this.indicatorHidden=!1,e[1]=0,N(e,e),this._currentIndicatorRotation=-Math.sign(e[2])*Math.acos(e[0])-Math.PI*.5,this.teleportIndicatorMeshObject.resetPositionRotation(),this.teleportIndicatorMeshObject.rotateAxisAngleRad([0,1,0],this._currentIndicatorRotation),this.teleportIndicatorMeshObject.translate(n.locations[0]),this.teleportIndicatorMeshObject.active=!0,this.hitSpot=n.locations[0],this._hasHit=!0):(this.indicatorHidden||(this.teleportIndicatorMeshObject.active=!1,this.indicatorHidden=!0),this._hasHit=!1)}_teleportPlayer(t,e){this.camRoot.rotateAxisAngleRad([0,1,0],e);const n=this._tempVec,s=this._tempVec0;this.session?(this.eyeLeft.getPositionWorld(n),this.eyeRight.getPositionWorld(s),He(n,n,s),Re(n,n,.5)):this.cam.getPositionWorld(n),this.camRoot.getPositionWorld(s),Q(n,s,n),n[0]+=t[0],n[1]=t[1],n[2]+=t[2],this.camRoot.setPositionWorld(n)}}u($i,"TypeName","teleport"),u($i,"Properties",{teleportIndicatorMeshObject:{type:b.Object},camRoot:{type:b.Object},cam:{type:b.Object},eyeLeft:{type:b.Object},eyeRight:{type:b.Object},handedness:{type:b.Enum,values:["input component","left","right","none"],default:"input component"},floorGroup:{type:b.Int,default:1},thumbstickActivationThreshhold:{type:b.Float,default:-.7},thumbstickDeactivationThreshhold:{type:b.Float,default:.3},indicatorYOffset:{type:b.Float,default:.01},rayCastMode:{type:b.Enum,values:["collision","physx"],default:"collision"},maxDistance:{type:b.Float,default:100}});const Ht=B(),re=B(),pt=B();class zi extends k{init(){this.points=new Array(this.segments+1);for(let t=0;t<this.points.length;++t)this.points[t]=B();this.currentPointOffset=0,this.up=[0,1,0],this.timeTillNext=this.interval}start(){this.trailContainer=this.engine.scene.addObject(),this.meshComp=this.trailContainer.addComponent("mesh"),this.meshComp.material=this.material;const t=2*this.points.length;this.indexData=new Uint32Array(6*this.segments);for(let e=0,n=0;e<t-2;e+=2,n+=6)this.indexData.subarray(n,n+6).set([e+1,e+0,e+2,e+2,e+3,e+1]);this.mesh=new xt(this.engine,{vertexCount:t,indexData:this.indexData,indexType:le.UnsignedInt}),this.meshComp.mesh=this.mesh}updateVertices(){const t=this.mesh.attribute(me.Position),e=this.mesh.attribute(me.TextureCoordinate),n=this.mesh.attribute(me.Normal);Qt(Ht,0,0,0);for(let s=0;s<this.points.length;++s){const o=this.points[(this.currentPointIndex+s+1)%this.points.length],a=this.points[(this.currentPointIndex+s+2)%this.points.length];s!==this.points.length-1&&Q(Ht,a,o),$e(re,this.up,Ht),N(re,re);const c=1-this.timeTillNext/this.interval,_=(s-c)/this.segments;Re(re,re,(this.taper?_:1)*this.width/2),t.set(s*2,[o[0]-re[0],o[1]-re[1],o[2]-re[2]]),t.set(s*2+1,[o[0]+re[0],o[1]+re[1],o[2]+re[2]]),n&&($e(pt,Ht,re),N(pt,pt),n.set(s*2,pt),n.set(s*2+1,pt)),e&&(e.set(s*2,[0,_]),e.set(s*2+1,[1,_]))}this.mesh.update()}resetTrail(){this.object.getTranslationWorld(this.points[0]);for(let t=1;t<this.points.length;++t)oe(this.points[t],this.points[0]);this.currentPointIndex=0,this.timeTillNext=this.interval}update(t){this.timeTillNext-=t,t>this.resetThreshold&&this.resetTrail(),this.timeTillNext<0&&(this.currentPointIndex=(this.currentPointIndex+1)%this.points.length,this.timeTillNext=this.timeTillNext%this.interval+this.interval),this.object.getTranslationWorld(this.points[this.currentPointIndex]),this.updateVertices()}onActivate(){this.resetTrail()}onDestroy(){this.trailContainer.destroy(),this.mesh.destroy()}}u(zi,"TypeName","trail"),u(zi,"Properties",{material:{type:b.Material},segments:{type:b.Int,default:50},interval:{type:b.Float,default:.1},width:{type:b.Float,default:1},taper:{type:b.Bool,default:!0},resetThreshold:{type:b.Float,default:.5}});function Ze(i,t,e){return Math.max(t,Math.min(i,e))}const Pn=new Float32Array(3),Bo=new Float32Array(4),Xi=new Float32Array(3),Bt=new Float32Array(3),Qe=new Float32Array(3),Ye=new Float32Array(3),qi=new Float32Array(8),Gi=new Float32Array(8),Zi=new Float32Array(8),Uo=function(){const i=new Float32Array(3),t=new Float32Array(3),e=new Float32Array(3),n=new Float32Array(3),s=new Float32Array(3),o=new Float32Array(3),a=new Float32Array(3),c=new Float32Array(3);return function(_,d,p,r,l,h,f){e.set(p);const w=We(e);Q(i,p,r);const m=We(i);i.set(l);const g=Ze(We(i),h,w+m-h);t.set(r),Re(n,p,-1),Q(s,r,p),N(t,t),N(e,e),N(n,n),N(s,s),N(i,i);const y=Math.acos(Ze(ke(t,e),-1,1)),v=Math.acos(Ze(ke(n,s),-1,1)),S=Math.acos(Ze(ke(t,i),-1,1)),F=Math.acos(Ze((m*m-w*w-g*g)/(-2*w*g),-1,1)),C=Math.acos(Ze((g*g-w*w-m*m)/(-2*w*m),-1,1));f&&(Q(e,f,p),N(e,e)),$e(o,t,e),N(o,o),$e(a,r,l),N(a,a),d.transformVectorInverseLocal(c,o),_.rotateAxisAngleRadObject(a,S),_.rotateAxisAngleRadObject(o,F-y),d.rotateAxisAngleRadObject(o,C-v)}}();class Qi extends k{constructor(){super(...arguments);u(this,"time",0)}start(){this.root.getTransformLocal(qi),this.middle.getTransformLocal(Gi),this.end.getTransformLocal(Zi)}update(e){this.time+=e,this.root.setTransformLocal(qi),this.middle.setTransformLocal(Gi),this.end.setTransformLocal(Zi),this.root.getScalingWorld(Pn),this.middle.getPositionLocal(Xi),this.end.getPositionLocal(Bt),this.middle.transformPointLocal(Bt,Bt),this.helper&&(this.helper.getPositionWorld(Ye),this.root.transformPointInverseWorld(Ye,Ye),Ei(Ye,Ye,Pn)),this.target.getPositionWorld(Qe),this.root.transformPointInverseWorld(Qe,Qe),Ei(Qe,Qe,Pn),Uo(this.root,this.middle,Xi,Bt,Qe,.01,this.helper?Ye:null,this.time),this.copyTargetRotation&&this.end.setRotationWorld(this.target.getRotationWorld(Bo))}}u(Qi,"TypeName","two-joint-ik-solver"),u(Qi,"Properties",{root:Y.object(),middle:Y.object(),end:Y.object(),target:Y.object(),copyTargetRotation:Y.bool(!0),helper:Y.object()});class Yi extends k{init(){if(!this.material)throw Error("video-texture: material property not set");this.loaded=!1,this.frameUpdateRequested=!0}start(){if(this.video=document.createElement("video"),this.video.src=this.url,this.video.crossOrigin="anonymous",this.video.playsInline=!0,this.video.loop=this.loop,this.video.muted=this.muted,this.video.addEventListener("playing",()=>{this.loaded=!0}),this.autoplay){const t=()=>{this.video.play(),window.removeEventListener("click",t),window.removeEventListener("touchstart",t)};window.addEventListener("click",t),window.addEventListener("touchstart",t)}}applyTexture(){const t=this.material,e=t.shader,n=this.texture=new nn(this.engine,this.video);Ns(t,n,this.textureProperty)||console.error("Shader",e,"not supported by video-texture"),"requestVideoFrameCallback"in this.video?this.video.requestVideoFrameCallback(this.updateVideo.bind(this)):this.video.addEventListener("timeupdate",()=>{this.frameUpdateRequested=!0})}update(t){this.loaded&&this.frameUpdateRequested&&(this.texture?this.texture.update():this.applyTexture(),this.frameUpdateRequested=!1)}updateVideo(){this.frameUpdateRequested=!0,this.video.requestVideoFrameCallback(this.updateVideo.bind(this))}}u(Yi,"TypeName","video-texture"),u(Yi,"Properties",{url:Y.string(),material:Y.material(),loop:Y.bool(!0),autoplay:Y.bool(!0),muted:Y.bool(!0),textureProperty:Y.string("auto")});class $n extends k{start(){this.components=[],this.getComponents(this.object),this.onXRSessionEnd(),this.onSessionStartCallback=this.onXRSessionStart.bind(this),this.onSessionEndCallback=this.onXRSessionEnd.bind(this)}onActivate(){this.engine.onXRSessionStart.add(this.onSessionStartCallback),this.engine.onXRSessionEnd.add(this.onSessionEndCallback)}onDeactivate(){this.engine.onXRSessionStart.remove(this.onSessionStartCallback),this.engine.onXRSessionEnd.remove(this.onSessionEndCallback)}getComponents(t){const e=t.getComponents().filter(n=>n.type!=="vr-mode-active-switch");if(this.components=this.components.concat(e),this.affectChildren){let n=t.children;for(let s=0;s<n.length;++s)this.getComponents(n[s])}}setComponentsActive(t){const e=this.components;for(let n=0;n<e.length;++n)e[n].active=t}onXRSessionStart(){this.setComponentsActive(this.activateComponents==0)}onXRSessionEnd(){this.setComponentsActive(this.activateComponents!=0)}}u($n,"TypeName","vr-mode-active-switch"),u($n,"Properties",{activateComponents:{type:b.Enum,values:["in VR","in non-VR"],default:"in VR"},affectChildren:{type:b.Bool,default:!0}});var si={exports:{}};si.exports=vn;si.exports.default=vn;function vn(i,t,e){e=e||2;var n=t&&t.length,s=n?t[0]*e:i.length,o=$s(i,0,s,e,!0),a=[];if(!o||o.next===o.prev)return a;var c,_,d,p,r,l,h;if(n&&(o=zo(i,t,o,e)),i.length>80*e){c=d=i[0],_=p=i[1];for(var f=e;f<s;f+=e)r=i[f],l=i[f+1],r<c&&(c=r),l<_&&(_=l),r>d&&(d=r),l>p&&(p=l);h=Math.max(d-c,p-_),h=h!==0?32767/h:0}return At(o,a,e,c,_,h,0),a}function $s(i,t,e,n,s){var o,a;if(s===qn(i,t,e,n)>0)for(o=t;o<e;o+=n)a=Ji(o,i[o],i[o+1],a);else for(o=e-n;o>=t;o-=n)a=Ji(o,i[o],i[o+1],a);return a&&bn(a,a.next)&&(Tt(a),a=a.next),a}function Xe(i,t){if(!i)return i;t||(t=i);var e=i,n;do if(n=!1,!e.steiner&&(bn(e,e.next)||$(e.prev,e,e.next)===0)){if(Tt(e),e=t=e.prev,e===e.next)break;n=!0}else e=e.next;while(n||e!==t);return t}function At(i,t,e,n,s,o,a){if(i){!a&&o&&Qo(i,n,s,o);for(var c=i,_,d;i.prev!==i.next;){if(_=i.prev,d=i.next,o?No(i,n,s,o):Vo(i)){t.push(_.i/e|0),t.push(i.i/e|0),t.push(d.i/e|0),Tt(i),i=d.next,c=d.next;continue}if(i=d,i===c){a?a===1?(i=Wo(Xe(i),t,e),At(i,t,e,n,s,o,2)):a===2&&$o(i,t,e,n,s,o):At(Xe(i),t,e,n,s,o,1);break}}}}function Vo(i){var t=i.prev,e=i,n=i.next;if($(t,e,n)>=0)return!1;for(var s=t.x,o=e.x,a=n.x,c=t.y,_=e.y,d=n.y,p=s<o?s<a?s:a:o<a?o:a,r=c<_?c<d?c:d:_<d?_:d,l=s>o?s>a?s:a:o>a?o:a,h=c>_?c>d?c:d:_>d?_:d,f=n.next;f!==t;){if(f.x>=p&&f.x<=l&&f.y>=r&&f.y<=h&&Ke(s,c,o,_,a,d,f.x,f.y)&&$(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function No(i,t,e,n){var s=i.prev,o=i,a=i.next;if($(s,o,a)>=0)return!1;for(var c=s.x,_=o.x,d=a.x,p=s.y,r=o.y,l=a.y,h=c<_?c<d?c:d:_<d?_:d,f=p<r?p<l?p:l:r<l?r:l,w=c>_?c>d?c:d:_>d?_:d,m=p>r?p>l?p:l:r>l?r:l,g=zn(h,f,t,e,n),y=zn(w,m,t,e,n),v=i.prevZ,S=i.nextZ;v&&v.z>=g&&S&&S.z<=y;){if(v.x>=h&&v.x<=w&&v.y>=f&&v.y<=m&&v!==s&&v!==a&&Ke(c,p,_,r,d,l,v.x,v.y)&&$(v.prev,v,v.next)>=0||(v=v.prevZ,S.x>=h&&S.x<=w&&S.y>=f&&S.y<=m&&S!==s&&S!==a&&Ke(c,p,_,r,d,l,S.x,S.y)&&$(S.prev,S,S.next)>=0))return!1;S=S.nextZ}for(;v&&v.z>=g;){if(v.x>=h&&v.x<=w&&v.y>=f&&v.y<=m&&v!==s&&v!==a&&Ke(c,p,_,r,d,l,v.x,v.y)&&$(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;S&&S.z<=y;){if(S.x>=h&&S.x<=w&&S.y>=f&&S.y<=m&&S!==s&&S!==a&&Ke(c,p,_,r,d,l,S.x,S.y)&&$(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function Wo(i,t,e){var n=i;do{var s=n.prev,o=n.next.next;!bn(s,o)&&zs(s,n,n.next,o)&&St(s,o)&&St(o,s)&&(t.push(s.i/e|0),t.push(n.i/e|0),t.push(o.i/e|0),Tt(n),Tt(n.next),n=i=o),n=n.next}while(n!==i);return Xe(n)}function $o(i,t,e,n,s,o){var a=i;do{for(var c=a.next.next;c!==a.prev;){if(a.i!==c.i&&Ko(a,c)){var _=Xs(a,c);a=Xe(a,a.next),_=Xe(_,_.next),At(a,t,e,n,s,o,0),At(_,t,e,n,s,o,0);return}c=c.next}a=a.next}while(a!==i)}function zo(i,t,e,n){var s=[],o,a,c,_,d;for(o=0,a=t.length;o<a;o++)c=t[o]*n,_=o<a-1?t[o+1]*n:i.length,d=$s(i,c,_,n,!1),d===d.next&&(d.steiner=!0),s.push(Jo(d));for(s.sort(Xo),o=0;o<s.length;o++)e=qo(s[o],e);return e}function Xo(i,t){return i.x-t.x}function qo(i,t){var e=Go(i,t);if(!e)return t;var n=Xs(e,i);return Xe(n,n.next),Xe(e,e.next)}function Go(i,t){var e=t,n=i.x,s=i.y,o=-1/0,a;do{if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){var c=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(c<=n&&c>o&&(o=c,a=e.x<e.next.x?e:e.next,c===n))return a}e=e.next}while(e!==t);if(!a)return null;var _=a,d=a.x,p=a.y,r=1/0,l;e=a;do n>=e.x&&e.x>=d&&n!==e.x&&Ke(s<p?n:o,s,d,p,s<p?o:n,s,e.x,e.y)&&(l=Math.abs(s-e.y)/(n-e.x),St(e,i)&&(l<r||l===r&&(e.x>a.x||e.x===a.x&&Zo(a,e)))&&(a=e,r=l)),e=e.next;while(e!==_);return a}function Zo(i,t){return $(i.prev,i,t.prev)<0&&$(t.next,i,i.next)<0}function Qo(i,t,e,n){var s=i;do s.z===0&&(s.z=zn(s.x,s.y,t,e,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==i);s.prevZ.nextZ=null,s.prevZ=null,Yo(s)}function Yo(i){var t,e,n,s,o,a,c,_,d=1;do{for(e=i,i=null,o=null,a=0;e;){for(a++,n=e,c=0,t=0;t<d&&(c++,n=n.nextZ,!!n);t++);for(_=d;c>0||_>0&&n;)c!==0&&(_===0||!n||e.z<=n.z)?(s=e,e=e.nextZ,c--):(s=n,n=n.nextZ,_--),o?o.nextZ=s:i=s,s.prevZ=o,o=s;e=n}o.nextZ=null,d*=2}while(a>1);return i}function zn(i,t,e,n,s){return i=(i-e)*s|0,t=(t-n)*s|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,i|t<<1}function Jo(i){var t=i,e=i;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==i);return e}function Ke(i,t,e,n,s,o,a,c){return(s-a)*(t-c)>=(i-a)*(o-c)&&(i-a)*(n-c)>=(e-a)*(t-c)&&(e-a)*(o-c)>=(s-a)*(n-c)}function Ko(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!ea(i,t)&&(St(i,t)&&St(t,i)&&ta(i,t)&&($(i.prev,i,t.prev)||$(i,t.prev,t))||bn(i,t)&&$(i.prev,i,i.next)>0&&$(t.prev,t,t.next)>0)}function $(i,t,e){return(t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y)}function bn(i,t){return i.x===t.x&&i.y===t.y}function zs(i,t,e,n){var s=Vt($(i,t,e)),o=Vt($(i,t,n)),a=Vt($(e,n,i)),c=Vt($(e,n,t));return!!(s!==o&&a!==c||s===0&&Ut(i,e,t)||o===0&&Ut(i,n,t)||a===0&&Ut(e,i,n)||c===0&&Ut(e,t,n))}function Ut(i,t,e){return t.x<=Math.max(i.x,e.x)&&t.x>=Math.min(i.x,e.x)&&t.y<=Math.max(i.y,e.y)&&t.y>=Math.min(i.y,e.y)}function Vt(i){return i>0?1:i<0?-1:0}function ea(i,t){var e=i;do{if(e.i!==i.i&&e.next.i!==i.i&&e.i!==t.i&&e.next.i!==t.i&&zs(e,e.next,i,t))return!0;e=e.next}while(e!==i);return!1}function St(i,t){return $(i.prev,i,i.next)<0?$(i,t,i.next)>=0&&$(i,i.prev,t)>=0:$(i,t,i.prev)<0||$(i,i.next,t)<0}function ta(i,t){var e=i,n=!1,s=(i.x+t.x)/2,o=(i.y+t.y)/2;do e.y>o!=e.next.y>o&&e.next.y!==e.y&&s<(e.next.x-e.x)*(o-e.y)/(e.next.y-e.y)+e.x&&(n=!n),e=e.next;while(e!==i);return n}function Xs(i,t){var e=new Xn(i.i,i.x,i.y),n=new Xn(t.i,t.x,t.y),s=i.next,o=t.prev;return i.next=t,t.prev=i,e.next=s,s.prev=e,n.next=e,e.prev=n,o.next=n,n.prev=o,n}function Ji(i,t,e,n){var s=new Xn(i,t,e);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function Tt(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Xn(i,t,e){this.i=i,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}vn.deviation=function(i,t,e,n){var s=t&&t.length,o=s?t[0]*e:i.length,a=Math.abs(qn(i,0,o,e));if(s)for(var c=0,_=t.length;c<_;c++){var d=t[c]*e,p=c<_-1?t[c+1]*e:i.length;a-=Math.abs(qn(i,d,p,e))}var r=0;for(c=0;c<n.length;c+=3){var l=n[c]*e,h=n[c+1]*e,f=n[c+2]*e;r+=Math.abs((i[l]-i[f])*(i[h+1]-i[l+1])-(i[l]-i[h])*(i[f+1]-i[l+1]))}return a===0&&r===0?0:Math.abs((r-a)/a)};function qn(i,t,e,n){for(var s=0,o=t,a=e-n;o<e;o+=n)s+=(i[a]-i[o])*(i[o+1]+i[a+1]),a=o;return s}vn.flatten=function(i){for(var t=i[0][0].length,e={vertices:[],holes:[],dimensions:t},n=0,s=0;s<i.length;s++){for(var o=0;o<i[s].length;o++)for(var a=0;a<t;a++)e.vertices.push(i[s][o][a]);s>0&&(n+=i[s-1].length,e.holes.push(n))}return e};var na=si.exports;const ia=Io(na);var qs=function(i,t,e,n){var s=arguments.length,o=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,t,e,n);else for(var c=i.length-1;c>=0;c--)(a=i[c])&&(o=(s<3?a(o):s>3?a(t,e,o):a(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};const ce=new Float32Array(3);function sa(i,t){if(t.length==0)return i;let e=Math.abs(t[0].x),n=Math.abs(t[0].z);for(let s=1;s<t.length;++s)e=Math.max(e,Math.abs(t[s].x)),n=Math.max(n,Math.abs(t[s].z));i[0]=e,i[1]=0,i[2]=n}function Ki(i,t,e=null){const n=t.length,s=new Float32Array(n*2);for(let p=0,r=0;p<n;++p,r+=2)s[r]=t[p].x,s[r+1]=t[p].z;const o=ia(s),a=e||new xt(i,{vertexCount:n,indexType:le.UnsignedByte,indexData:o});if(a.vertexCount!==n)return console.warn("vertexCount of meshToUpdate did not match required vertexCount"),a;const c=a.attribute(me.Position),_=a.attribute(me.TextureCoordinate),d=a.attribute(me.Normal);ce[1]=0;for(let p=0,r=0;p<n;++p,r+=2)ce[0]=s[r],ce[2]=s[r+1],c.set(p,ce);if(_==null||_.set(0,s),d){ce[0]=0,ce[1]=1,ce[2]=0;for(let p=0;p<n;++p)d.set(p,ce)}return e&&a.update(),a}var un,Gs,dn,Zs,pn,Qs,fn,Ys;class ri extends k{constructor(){super(...arguments);G(this,un);G(this,dn);G(this,pn);G(this,fn);u(this,"planeMaterial",null);u(this,"collisionMask",-1);u(this,"planes",new Map);u(this,"planeObjects",new Map);u(this,"onPlaneFound",new H);u(this,"onPlaneLost",new H)}update(){var n;if(!((n=this.engine.xr)!=null&&n.frame))return;if(this.engine.xr.frame.detectedPlanes===void 0){console.error("plane-detection: WebXR feature not available."),this.active=!1;return}const e=this.engine.xr.frame.detectedPlanes;for(const[s,o]of this.planes)e.has(s)||K(this,un,Gs).call(this,s);e.forEach(s=>{this.planes.has(s)?s.lastChangedTime>this.planes.get(s)&&K(this,pn,Qs).call(this,s):K(this,dn,Zs).call(this,s),K(this,fn,Ys).call(this,s)})}}un=new WeakSet,Gs=function(e){this.planes.delete(e);const n=this.planeObjects.get(e);this.onPlaneLost.notify(e,n),n.objectId>0&&n.destroy()},dn=new WeakSet,Zs=function(e){this.planes.set(e,e.lastChangedTime);const n=this.engine.scene.addObject(this.object);this.planeObjects.set(e,n),this.planeMaterial&&n.addComponent(_e,{mesh:Ki(this.engine,e.polygon),material:this.planeMaterial}),this.collisionMask>=0&&(sa(ce,e.polygon),ce[1]=.025,n.addComponent(Oe,{group:this.collisionMask,collider:ot.Box,extents:ce})),this.onPlaneFound.notify(e,n)},pn=new WeakSet,Qs=function(e){this.planes.set(e,e.lastChangedTime);const n=this.planeObjects.get(e).getComponent(_e);n&&Ki(this.engine,e.polygon,n.mesh)},fn=new WeakSet,Ys=function(e){const n=this.planeObjects.get(e),s=this.engine.xr.frame.getPose(e.planeSpace,this.engine.xr.currentReferenceSpace);if(!s){n.active=!1;return}wn(n,s.transform)},u(ri,"TypeName","plane-detection");qs([j.material()],ri.prototype,"planeMaterial",void 0);qs([j.int()],ri.prototype,"collisionMask",void 0);const ra={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]},oa={PositiveX:[1,0,0],NegativeX:[-1,0,0],PositiveY:[0,1,0],NegativeY:[0,-1,0],PositiveZ:[0,0,1],NegativeZ:[0,0,-1]};class es extends k{constructor(){super(...arguments);u(this,"meta",null);u(this,"bones",{hips:null,spine:null,chest:null,upperChest:null,neck:null,head:null,leftEye:null,rightEye:null,jaw:null,leftUpperLeg:null,leftLowerLeg:null,leftFoot:null,leftToes:null,rightUpperLeg:null,rightLowerLeg:null,rightFoot:null,rightToes:null,leftShoulder:null,leftUpperArm:null,leftLowerArm:null,leftHand:null,rightShoulder:null,rightUpperArm:null,rightLowerArm:null,rightHand:null,leftThumbMetacarpal:null,leftThumbProximal:null,leftThumbDistal:null,leftIndexProximal:null,leftIndexIntermediate:null,leftIndexDistal:null,leftMiddleProximal:null,leftMiddleIntermediate:null,leftMiddleDistal:null,leftRingProximal:null,leftRingIntermediate:null,leftRingDistal:null,leftLittleProximal:null,leftLittleIntermediate:null,leftLittleDistal:null,rightThumbMetacarpal:null,rightThumbProximal:null,rightThumbDistal:null,rightIndexProximal:null,rightIndexIntermediate:null,rightIndexDistal:null,rightMiddleProximal:null,rightMiddleIntermediate:null,rightMiddleDistal:null,rightRingProximal:null,rightRingIntermediate:null,rightRingDistal:null,rightLittleProximal:null,rightLittleIntermediate:null,rightLittleDistal:null});u(this,"restPose",{});u(this,"_nodeConstraints",[]);u(this,"_springChains",[]);u(this,"_sphereColliders",[]);u(this,"_capsuleColliders",[]);u(this,"_firstPersonAnnotations",[]);u(this,"_lookAt",null);u(this,"_initialized",!1)}init(){this._tempV3=B(),this._tempV3A=B(),this._tempV3B=B(),this._tempQuat=ie(),this._tempQuatA=ie(),this._tempQuatB=ie(),this._tempMat4A=lo(),this._tempQuat2=ki(),this._tailToShape=B(),this._headToTail=B(),this._inertia=B(),this._stiffness=B(),this._external=B(),this._rightVector=Qt(B(),1,0,0),this._upVector=Qt(B(),0,1,0),this._forwardVector=Qt(B(),0,0,1),this._identityQuat=ji(ie()),this._rad2deg=180/Math.PI}start(){if(!this.src){console.error("vrm: src property not set");return}this.engine.scene.append(this.src,{loadGltfExtensions:!0}).then(({root:e,extensions:n})=>{e.children.forEach(s=>s.parent=this.object),this._initializeVrm(n),e.destroy()})}_initializeVrm(e){if(this._initialized)throw Error("VRM component has already been initialized");const n=e.root.VRMC_vrm;if(!n)throw Error("Missing VRM extensions");if(n.specVersion!=="1.0")throw Error(`Unsupported VRM version, only 1.0 is supported, but encountered '${n.specVersion}'`);this.meta=n.meta,this._parseHumanoid(n.humanoid,e),n.firstPerson&&this._parseFirstPerson(n.firstPerson,e),n.lookAt&&this._parseLookAt(n.lookAt),this._findAndParseNodeConstraints(e);const s=e.root.VRMC_springBone;s&&this._parseAndInitializeSpringBones(s,e),this._initialized=!0}_parseHumanoid(e,n){for(const s in e.humanBones){if(!(s in this.bones)){console.warn(`Unrecognized bone '${s}'`);continue}const o=e.humanBones[s].node,a=n.idMapping[o];this.bones[s]=this.engine.wrapObject(a),this.restPose[s]=Ot(ie(),this.bones[s].rotationLocal)}}_parseFirstPerson(e,n){for(const s of e.meshAnnotations){const o={node:this.engine.wrapObject(n.idMapping[s.node]),firstPerson:!0,thirdPerson:!0};switch(s.type){case"firstPersonOnly":o.thirdPerson=!1;break;case"thirdPersonOnly":o.firstPerson=!1;break;case"both":break;case"auto":console.warn("First person mesh annotation type 'auto' is not supported, treating as 'both'!");break;default:console.error(`Invalid mesh annotation type '${s.type}'`);break}this._firstPersonAnnotations.push(o)}}_parseLookAt(e){if(e.type!=="bone"){console.warn(`Unsupported lookAt type '${e.type}', only 'bone' is supported`);return}const n=s=>({inputMaxValue:s.inputMaxValue,outputScale:s.outputScale});this._lookAt={offsetFromHeadBone:e.offsetFromHeadBone||[0,0,0],horizontalInner:n(e.rangeMapHorizontalInner),horizontalOuter:n(e.rangeMapHorizontalOuter),verticalDown:n(e.rangeMapVerticalDown),verticalUp:n(e.rangeMapVerticalUp)}}_findAndParseNodeConstraints(e){const n=s=>{const o=e.node[s.objectId];if(o&&"VRMC_node_constraint"in o){const c=o.VRMC_node_constraint.constraint;let _,d;if("roll"in c?(_="roll",d=ra[c.roll.rollAxis]):"aim"in c?(_="aim",d=oa[c.aim.aimAxis]):"rotation"in c&&(_="rotation"),_){const p=this.engine.wrapObject(e.idMapping[c[_].source]);this._nodeConstraints.push({type:_,source:p,destination:s,axis:d,weight:c[_].weight,destinationRestLocalRotation:Ot(ie(),s.rotationLocal),sourceRestLocalRotation:Ot(ie(),p.rotationLocal),sourceRestLocalRotationInv:Lt(ie(),p.rotationLocal)})}else console.warn("Unrecognized or invalid VRMC_node_constraint, ignoring it")}for(const a of s.children)n(a)};n(this.object)}_parseAndInitializeSpringBones(e,n){const s=(e.colliders||[]).map((a,c)=>{const _="capsule"in a.shape?"capsule":"sphere";return{id:c,object:this.engine.wrapObject(n.idMapping[a.node]),shape:{isCapsule:_==="capsule",radius:a.shape[_].radius,offset:a.shape[_].offset,tail:a.shape[_].tail},cache:{head:B(),tail:B()}}});this._sphereColliders=s.filter(a=>!a.shape.isCapsule),this._capsuleColliders=s.filter(a=>a.shape.isCapsule);const o=(e.colliderGroups||[]).map(a=>({name:a.name,colliders:a.colliders.map(c=>s[c])}));for(const a of e.springs){const c=[];for(const d of a.joints){const p={hitRadius:0,stiffness:1,gravityPower:0,gravityDir:[0,-1,0],dragForce:.5,node:null,state:null};Object.assign(p,d),p.node=this.engine.wrapObject(n.idMapping[p.node]),c.push(p)}const _=(a.colliderGroups||[]).flatMap(d=>o[d].colliders);this._springChains.push({name:a.name,center:a.center?this.engine.wrapObject(n.idMapping[a.center]):null,joints:c,sphereColliders:_.filter(d=>!d.shape.isCapsule),capsuleColliders:_.filter(d=>d.shape.isCapsule)})}for(const a of this._springChains)for(let c=0;c<a.joints.length-1;++c){const _=a.joints[c],d=a.joints[c+1],p=_.node.getTranslationWorld(B()),r=d.node.getTranslationWorld(B()),l=Hs(this._tempV3A,p,r),h={prevTail:r,currentTail:oe(B(),r),initialLocalRotation:Ot(ie(),_.node.rotationLocal),initialLocalTransformInvert:jo(ki(),_.node.transformLocal),boneAxis:N(B(),d.node.getTranslationLocal(this._tempV3)),boneLength:Math.max(.01,We(l)),prevTailCenter:null,currentTailCenter:null};a.center&&(h.prevTailCenter=a.center.transformPointInverseWorld(B(),r),h.currentTailCenter=oe(B(),r)),_.state=h}}update(e){this._initialized&&(this._resolveLookAt(),this._resolveConstraints(),this._updateSpringBones(e))}_rangeMap(e,n){const s=e.inputMaxValue,o=e.outputScale;return Math.min(n,s)/s*o}_resolveLookAt(){if(!this._lookAt||!this.lookAtTarget)return;const e=this.bones.head.transformPointWorld(this._tempV3A,this._lookAt.offsetFromHeadBone),n=this.lookAtTarget.getTranslationWorld(this._tempV3B),s=Q(this._tempV3A,n,e);N(s,s),this.bones.head.parent.transformVectorInverseWorld(s);const o=ke(s,this._forwardVector),a=ke(s,this._rightVector),c=Math.atan2(a,o)*this._rad2deg,_=Math.sqrt(a*a+o*o),d=ke(s,this._upVector);let p=Math.atan2(-d,_)*this._rad2deg;if(p>0?p=this._rangeMap(this._lookAt.verticalDown,p):p=-this._rangeMap(this._lookAt.verticalUp,-p),this.bones.leftEye){let r=c;r>0?r=this._rangeMap(this._lookAt.horizontalInner,r):r=-this._rangeMap(this._lookAt.horizontalOuter,-r);const l=Ri(this._tempQuatA,p,r,0);this.bones.leftEye.rotationLocal=Be(l,this.restPose.leftEye,l)}if(this.bones.rightEye){let r=c;r>0?r=this._rangeMap(this._lookAt.horizontalOuter,r):r=-this._rangeMap(this._lookAt.horizontalInner,-r);const l=Ri(this._tempQuatA,p,r,0);this.bones.rightEye.rotationLocal=Be(l,this.restPose.rightEye,l)}}_resolveConstraints(){for(const e of this._nodeConstraints)this._resolveConstraint(e)}_resolveConstraint(e){const n=e.destinationRestLocalRotation,s=e.sourceRestLocalRotationInv,o=ji(this._tempQuatA);switch(e.type){case"roll":{const a=Be(this._tempQuatA,s,e.source.rotationLocal),c=Be(this._tempQuatA,e.sourceRestLocalRotation,a);we(c,c,s);const _=Lt(this._tempQuatB,n),d=Be(this._tempQuatB,_,c);Be(d,d,n);const p=Je(this._tempV3A,e.axis,d),r=Mn(this._tempQuatA,e.axis,p);we(o,n,Lt(this._tempQuat,r)),we(o,o,d)}break;case"aim":{const a=e.destination.parent.rotationWorld,c=Je(this._tempV3A,e.axis,n);Je(c,c,a);const _=e.source.getTranslationWorld(this._tempV3B);Q(_,_,e.destination.getTranslationWorld(this._tempV3)),N(_,_);const d=Mn(this._tempQuatA,c,_);we(o,Lt(this._tempQuat,a),d),we(o,o,a),we(o,o,n)}break;case"rotation":{const a=we(o,s,e.source.rotationLocal);we(o,n,a)}break}Yt(o,n,o,e.weight),e.destination.rotationLocal=o}_updateSpringBones(e){this._sphereColliders.forEach(({object:n,shape:s,cache:o})=>{const a=oe(o.head,s.offset);n.transformVectorWorld(a),He(o.head,n.getTranslationWorld(this._tempV3),a)}),this._capsuleColliders.forEach(({object:n,shape:s,cache:o})=>{const a=n.getTranslationWorld(this._tempV3A),c=oe(o.head,s.offset);n.transformVectorWorld(c),He(o.head,a,c);const _=oe(o.tail,s.tail);n.transformVectorWorld(_),He(o.tail,a,_)}),this._springChains.forEach(n=>{for(let s=0;s<n.joints.length-1;++s){const o=n.joints[s],a=o.node.parent?o.node.parent.rotationWorld:this._identityQuat,c=this._inertia;n.center?(Q(c,o.state.currentTailCenter,o.state.prevTailCenter),n.center.transformVectorWorld(c)):Q(c,o.state.currentTail,o.state.prevTail),Re(c,c,1-o.dragForce);const _=oe(this._stiffness,o.state.boneAxis);Je(_,_,o.state.initialLocalRotation),Je(_,_,a),Re(_,_,e*o.stiffness);const d=Re(this._external,o.gravityDir,e*o.gravityPower),p=oe(this._tempV3A,o.state.currentTail);He(p,p,c),He(p,p,_),He(p,p,d);const r=o.node.getTranslationWorld(this._tempV3B);Q(p,p,r),N(p,p),ut(p,r,p,o.state.boneLength);for(const{shape:f,cache:w}of n.sphereColliders){let m=this._tailToShape;const g=w.head;m=Q(m,p,g);const y=f.radius+o.hitRadius,v=We(m)-y;v<0&&(N(m,m),ut(p,p,m,-v),Q(p,p,r),N(p,p),ut(p,r,p,o.state.boneLength))}for(const{shape:f,cache:w}of n.capsuleColliders){let m=this._tailToShape;const g=w.head,y=w.tail;m=Q(m,p,g);const v=Q(this._headToTail,y,g),S=ke(v,m);Fi(v)<=S?Q(m,p,y):S>0&&(Re(v,v,S/Fi(v)),Q(m,m,v));const F=f.radius+o.hitRadius,C=We(m)-F;C<0&&(N(m,m),ut(p,p,m,-C),Q(p,p,r),N(p,p),ut(p,r,p,o.state.boneLength))}oe(o.state.prevTail,o.state.currentTail),oe(o.state.currentTail,p),n.center&&(oe(o.state.prevTailCenter,o.state.currentTailCenter),oe(o.state.currentTailCenter,p),n.center.transformPointInverseWorld(o.state.currentTailCenter)),o.node.parent.transformPointInverseWorld(p);const l=Co(this._tempQuat2,p);Eo(l,o.state.initialLocalTransformInvert,l),Us(p,l),N(p,p);const h=Mn(this._tempQuatA,o.state.boneAxis,p);o.node.rotationLocal=we(this._tempQuatA,o.state.initialLocalRotation,h)}})}set firstPerson(e){this._firstPersonAnnotations.forEach(n=>{const s=e==n.firstPerson||e!=n.thirdPerson;n.node.getComponents("mesh").forEach(o=>{o.active=s})})}}u(es,"TypeName","vrm"),u(es,"Properties",{src:{type:b.String},lookAtTarget:{type:b.Object}});const J=new Float32Array(3);class Gn extends k{init(){this.up=!1,this.right=!1,this.down=!1,this.left=!1,window.addEventListener("keydown",this.press.bind(this)),window.addEventListener("keyup",this.release.bind(this))}start(){this.headObject=this.headObject||this.object}update(){fo(J),this.up&&(J[2]-=1),this.down&&(J[2]+=1),this.left&&(J[0]-=1),this.right&&(J[0]+=1),N(J,J),J[0]*=this.speed,J[2]*=this.speed,Je(J,J,this.headObject.transformWorld),this.lockY&&(J[1]=0,N(J,J),Re(J,J,this.speed)),this.object.translateLocal(J)}press(t){t.keyCode===38||t.keyCode===87||t.keyCode===90?this.up=!0:t.keyCode===39||t.keyCode===68?this.right=!0:t.keyCode===40||t.keyCode===83?this.down=!0:(t.keyCode===37||t.keyCode===65||t.keyCode===81)&&(this.left=!0)}release(t){t.keyCode===38||t.keyCode===87||t.keyCode===90?this.up=!1:t.keyCode===39||t.keyCode===68?this.right=!1:t.keyCode===40||t.keyCode===83?this.down=!1:(t.keyCode===37||t.keyCode===65||t.keyCode===81)&&(this.left=!1)}}u(Gn,"TypeName","wasd-controls"),u(Gn,"Properties",{speed:{type:b.Float,default:.1},lockY:{type:b.Bool,default:!1},headObject:{type:b.Object}});var qe=function(i,t,e,n){var s=arguments.length,o=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,t,e,n);else for(var c=i.length-1;c>=0;c--)(a=i[c])&&(o=(s<3?a(o):s>3?a(t,e,o):a(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};const ts=B(),Nt=ie(),aa=new Float32Array(4),la=new Float32Array(4),ca=new Float32Array(3),_a=new Float32Array(3),Js=["left","right"],et=class et extends k{constructor(){super(...arguments);u(this,"_gamepadObjects",{});u(this,"_controllerModel",null);u(this,"_defaultControllerComponents");u(this,"_handedness");u(this,"_profileJSON",null);u(this,"_buttons",[]);u(this,"_axes",[]);u(this,"gamepad");u(this,"onModelLoaded",new H);u(this,"url");u(this,"toFilter",new Set(["vr-mode-active-mode-switch"]));u(this,"handedness",0);u(this,"defaultBasePath");u(this,"customBasePath");u(this,"defaultController");u(this,"trackedHand");u(this,"mapToDefaultController");u(this,"addVrModeSwitch")}onActivate(){var n;this._handedness=Js[this.handedness];const e="Hand"+this._handedness.charAt(0).toUpperCase()+this._handedness.slice(1);this.trackedHand=this.trackedHand??((n=this.object.parent)==null?void 0:n.findByNameRecursive(e)[0]),this.defaultController=this.defaultController||this.object.children[0],this._defaultControllerComponents=this._getComponents(this.defaultController),this.engine.onXRSessionStart.add(()=>{var s;(s=this.engine.xr)==null||s.session.addEventListener("inputsourceschange",this._onInputSourcesChange.bind(this))})}onDeactivate(){var e,n;(n=(e=this.engine.xr)==null?void 0:e.session)==null||n.removeEventListener("inputsourceschange",this._onInputSourcesChange.bind(this))}_setHandTrackingControllers(e){const n=this.trackedHand.getComponent(De);n&&(n.controllerToDeactivate=e)}_getComponents(e){const n=[];if(e==null)return n;const s=[e];for(;s.length>0;){const o=s.pop(),a=o.getComponents().filter(_=>!this.toFilter.has(_.type));n.push(...a);const c=o.children;for(let _=c.length-1;_>=0;--_)s.push(c[_])}return n}_setComponentsActive(e){const n=this._defaultControllerComponents;if(n!=null)for(let s=0;s<n.length;++s)n[s].active=e}_onInputSourcesChange(e){this._isModelLoaded()&&!this.mapToDefaultController&&this._setComponentsActive(!1),e.added.forEach(n=>{if(n.hand!=null||this._handedness!=n.handedness)return;this.gamepad=n.gamepad;const s=this.customBasePath!==""?this.customBasePath:this.defaultBasePath+n.profiles[0];this.url=s+"/profile.json",this._profileJSON=et.Cache.get(this.url)??null,this._profileJSON==null&&fetch(this.url).then(o=>o.json()).then(o=>{this._profileJSON=o,et.Cache.set(this.url,this._profileJSON),this._isModelLoaded()||this._loadAndMapGamepad(s)}).catch(o=>{console.error(`Failed to load profile from ${this.url}. Reason:`,o)})})}_isModelLoaded(){return this._controllerModel!==null}async _loadAndMapGamepad(e){const n=e+"/"+this._handedness+".glb";if(this._controllerModel=this.defaultController,!this.mapToDefaultController){try{this._controllerModel=await this.engine.scene.append(n)}catch(s){console.error("Failed to load i-p controller model. Reason:",s,`Continuing with ${this._handedness} default controller.`),this._setComponentsActive(!0)}this._controllerModel.parent=this.object,this._controllerModel.setPositionLocal([0,0,0]),this._setComponentsActive(!1),this.addVrModeSwitch&&this._controllerModel.addComponent($n),this.onModelLoaded.notify()}this._cacheGamepadObjectsFromProfile(this._profileJSON,this._controllerModel),this._setHandTrackingControllers(this._controllerModel),this.update=()=>this._mapGamepadInput()}_cacheGamepadObjectsFromProfile(e,n){const s=e.layouts[this._handedness].components;if(s){this._buttons=[],this._axes=[];for(const o in s){const a=s[o].visualResponses;for(const c in a){const _=a[c],d=_.valueNodeName,p=_.minNodeName,r=_.maxNodeName;this._gamepadObjects[d]=n.findByNameRecursive(d)[0],this._gamepadObjects[p]=n.findByNameRecursive(p)[0],this._gamepadObjects[r]=n.findByNameRecursive(r)[0];const l=a[c].componentProperty,h={target:this._gamepadObjects[d],min:this._gamepadObjects[p],max:this._gamepadObjects[r],id:s[o].gamepadIndices[l]};switch(l){case"button":this._buttons.push(h);break;case"xAxis":case"yAxis":this._axes.push(h);break}}}}}_assignTransform(e,n,s,o){uo(ts,n.getPositionWorld(ca),s.getPositionWorld(_a),o),e.setPositionWorld(ts),Po(Nt,n.getRotationWorld(aa),s.getRotationWorld(la),o),ii(Nt,Nt),e.setRotationWorld(Nt)}_mapGamepadInput(){for(const e of this._buttons){const n=this.gamepad.buttons[e.id].value;this._assignTransform(e.target,e.min,e.max,n)}for(const e of this._axes){const s=(this.gamepad.axes[e.id]+1)/2;this._assignTransform(e.target,e.min,e.max,s)}}};u(et,"TypeName","input-profile"),u(et,"Cache",new Map);let Me=et;qe([j.enum(Js,0)],Me.prototype,"handedness",void 0);qe([j.string("https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@latest/dist/profiles/")],Me.prototype,"defaultBasePath",void 0);qe([j.string()],Me.prototype,"customBasePath",void 0);qe([j.object()],Me.prototype,"defaultController",void 0);qe([j.object()],Me.prototype,"trackedHand",void 0);qe([j.bool(!1)],Me.prototype,"mapToDefaultController",void 0);qe([j.bool(!0)],Me.prototype,"addVrModeSwitch",void 0);var ge=function(i,t,e,n){var s=arguments.length,o=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,e):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,t,e,n);else for(var c=i.length-1;c>=0;c--)(a=i[c])&&(o=(s<3?a(o):s>3?a(t,e,o):a(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};const ns=i=>{i.preventDefault()},Wt=[0,0,0];class de extends k{constructor(){super(...arguments);u(this,"mouseButtonIndex",0);u(this,"radial",5);u(this,"minElevation",0);u(this,"maxElevation",89.99);u(this,"minZoom",.01);u(this,"maxZoom",10);u(this,"xSensitivity",.5);u(this,"ySensitivity",.5);u(this,"zoomSensitivity",.02);u(this,"damping",.9);u(this,"_mouseDown",!1);u(this,"_origin",[0,0,0]);u(this,"_azimuth",0);u(this,"_polar",45);u(this,"_initialPinchDistance",0);u(this,"_touchStartX",0);u(this,"_touchStartY",0);u(this,"_azimuthSpeed",0);u(this,"_polarSpeed",0);u(this,"_onMouseDown",e=>{if(e.button===this.mouseButtonIndex&&(this._mouseDown=!0,document.body.style.cursor="grabbing",e.button===1))return e.preventDefault(),!1});u(this,"_onMouseUp",e=>{e.button===this.mouseButtonIndex&&(this._mouseDown=!1,document.body.style.cursor="initial")});u(this,"_onMouseMove",e=>{this.active&&this._mouseDown&&this.active&&this._mouseDown&&(this._azimuthSpeed=-(e.movementX*this.xSensitivity),this._polarSpeed=e.movementY*this.ySensitivity)});u(this,"_onMouseScroll",e=>{e.preventDefault(),this.radial*=1-e.deltaY*this.zoomSensitivity*-.001,this.radial=Math.min(this.maxZoom,Math.max(this.minZoom,this.radial)),this._updateCamera()});u(this,"_onTouchStart",e=>{e.touches.length===1?(e.preventDefault(),this._touchStartX=e.touches[0].clientX,this._touchStartY=e.touches[0].clientY,this._mouseDown=!0):e.touches.length===2&&(this._initialPinchDistance=this._getDistanceBetweenTouches(e.touches),e.preventDefault())});u(this,"_onTouchMove",e=>{if(!(!this.active||!this._mouseDown)){if(e.preventDefault(),e.touches.length===1){const n=e.touches[0].clientX-this._touchStartX,s=e.touches[0].clientY-this._touchStartY;this._azimuthSpeed=-(n*this.xSensitivity),this._polarSpeed=s*this.ySensitivity,this._touchStartX=e.touches[0].clientX,this._touchStartY=e.touches[0].clientY}else if(e.touches.length===2){const n=this._getDistanceBetweenTouches(e.touches),s=this._initialPinchDistance/n;this.radial*=s,this.radial=Math.min(this.maxZoom,Math.max(this.minZoom,this.radial)),this._updateCamera(),this._initialPinchDistance=n}}});u(this,"_onTouchEnd",e=>{e.touches.length<2&&(this._mouseDown=!1),e.touches.length===1&&(this._touchStartX=e.touches[0].clientX,this._touchStartY=e.touches[0].clientY)})}start(){this.object.getPositionWorld(this._origin),this._updateCamera()}onActivate(){const e=this.engine.canvas;e.addEventListener("mousemove",this._onMouseMove),this.mouseButtonIndex===2&&e.addEventListener("contextmenu",ns,{passive:!1}),e.addEventListener("mousedown",this._onMouseDown),e.addEventListener("mouseup",this._onMouseUp),e.addEventListener("wheel",this._onMouseScroll,{passive:!1}),e.addEventListener("touchstart",this._onTouchStart,{passive:!1}),e.addEventListener("touchmove",this._onTouchMove,{passive:!1}),e.addEventListener("touchend",this._onTouchEnd)}onDeactivate(){const e=this.engine.canvas;e.removeEventListener("mousemove",this._onMouseMove),this.mouseButtonIndex===2&&e.removeEventListener("contextmenu",ns),e.removeEventListener("mousedown",this._onMouseDown),e.removeEventListener("mouseup",this._onMouseUp),e.removeEventListener("wheel",this._onMouseScroll),e.removeEventListener("touchstart",this._onTouchStart),e.removeEventListener("touchmove",this._onTouchMove),e.removeEventListener("touchend",this._onTouchEnd),this._mouseDown=!1,this._initialPinchDistance=0,this._touchStartX=0,this._touchStartY=0,this._azimuthSpeed=0,this._polarSpeed=0}update(){this._mouseDown||(this._azimuthSpeed*=this.damping,this._polarSpeed*=this.damping,Math.abs(this._azimuthSpeed)<.01&&(this._azimuthSpeed=0),Math.abs(this._polarSpeed)<.01&&(this._polarSpeed=0)),this._azimuth+=this._azimuthSpeed,this._polar+=this._polarSpeed,this._polar=Math.min(this.maxElevation,Math.max(this.minElevation,this._polar)),(this._azimuthSpeed!==0||this._polarSpeed!==0)&&this._updateCamera()}_updateCamera(){const e=Ui(this._azimuth),n=Ui(this._polar);Wt[0]=this.radial*Math.sin(e)*Math.cos(n),Wt[1]=this.radial*Math.sin(n),Wt[2]=this.radial*Math.cos(e)*Math.cos(n),this.object.setPositionWorld(Wt),this.object.translateWorld(this._origin),this.object.lookAt(this._origin)}_getDistanceBetweenTouches(e){const n=e[0].clientX-e[1].clientX,s=e[0].clientY-e[1].clientY;return Math.sqrt(n*n+s*s)}}u(de,"TypeName","orbital-camera");ge([j.int()],de.prototype,"mouseButtonIndex",void 0);ge([j.float(5)],de.prototype,"radial",void 0);ge([j.float()],de.prototype,"minElevation",void 0);ge([j.float(89.99)],de.prototype,"maxElevation",void 0);ge([j.float()],de.prototype,"minZoom",void 0);ge([j.float(10)],de.prototype,"maxZoom",void 0);ge([j.float(.5)],de.prototype,"xSensitivity",void 0);ge([j.float(.5)],de.prototype,"ySensitivity",void 0);ge([j.float(.02)],de.prototype,"zoomSensitivity",void 0);ge([j.float(.9)],de.prototype,"damping",void 0);async function ha(){const i={ProjectName:"React",RuntimeBaseName:"WonderlandRuntime",WebXRRequiredFeatures:["local"],WebXROptionalFeatures:["local","hand-tracking","hit-test"]},t={physx:!1,loader:!1,xrFramebufferScaleFactor:1,xrOfferSession:{mode:"auto",features:i.WebXRRequiredFeatures,optionalFeatures:i.WebXROptionalFeatures},canvas:"canvas"},e=await js(i.RuntimeBaseName,t);Object.assign(e,no),window.WL=e,e.onSceneLoaded.once(()=>{const o=document.getElementById("version");o&&setTimeout(()=>o.remove(),2e3)});function n(o){e.requestXRSession(o,i.WebXRRequiredFeatures,i.WebXROptionalFeatures).catch(a=>console.error(a))}function s(){const o=document.getElementById("ar-button");o&&(o.dataset.supported=e.arSupported,o.addEventListener("click",()=>n("immersive-ar")));const a=document.getElementById("vr-button");a&&(a.dataset.supported=e.vrSupported,a.addEventListener("click",()=>n("immersive-vr")))}return document.readyState==="loading"?window.addEventListener("load",s):s(),e.registerComponent(_t),e.registerComponent(Gn),e.scene.load(`${i.ProjectName}.bin`).catch(o=>{console.error(o),window.alert(`Failed to load ${i.ProjectName}.bin:`,o)}),e}var ua=0;function te(i,t,e,n,s,o){var a,c,_={};for(c in t)c=="ref"?a=t[c]:_[c]=t[c];var d={type:i,props:_,key:e,ref:a,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:--ua,__i:-1,__u:0,__source:s,__self:o};if(typeof i=="function"&&(a=i.defaultProps))for(c in a)_[c]===void 0&&(_[c]=a[c]);return U.vnode&&U.vnode(d),d}class da extends mt{componentDidMount(){ha().then(t=>{t.onSceneLoaded.once(()=>{this.setState({engine:t}),this.update(t,this.props)})})}update(t,e){const s=t.scene.findByName("Cube")[0].getComponent("mesh");s.material.diffuseColor=e.cubeColor}render({className:t}){return te("canvas",{class:t,id:"canvas"})}componentDidUpdate(t){this.state.engine&&this.update(this.state.engine,t)}}const pa=()=>{const[i,t]=hr({color:[1,1,0,1]});function e(){t({color:[Math.random(),Math.random(),Math.random(),1]})}return te(Pt,{children:[te("div",{children:te("a",{href:"https://wonderlandengine.com/showcase",target:"_blank",children:te("img",{src:fr,class:"logo wonderland",alt:"Wonderland Engine logo"})})}),te("h1",{children:"React Example"}),te("div",{class:"card",children:[te(da,{className:"wonderland-app",cubeColor:i.color}),te("button",{onClick:e,children:"Toggle Cube Color"}),te("p",{children:["Edit ",te("code",{children:"src/app.jsx"})," and save to test HMR."]})]}),te("p",{class:"read-the-docs",children:"Click on Wonderland Engine logo to learn more."})]})};cr(te(pa,{}),document.getElementById("app"));
